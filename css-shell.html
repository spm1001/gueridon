<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>CSS Shell Test</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="/style.css">
<style>
  /* === Proposed CSS fixes for shell state === */

  /* Body-scroll layout: body grows with content, enabling Safari Full Page
     screenshots (which capture document scroll height, not element scroll).
     No calc(100dvh + 1px) needed â€” body naturally exceeds viewport when
     content is long, so the iOS viewport lie doesn't matter. */
  body {
    height: auto;
    min-height: 100dvh;
  }
  .messages {
    overflow-y: visible;
    flex: 1 0 auto; /* grow, don't shrink, content-sized basis */
  }
  .input-area {
    position: sticky;
    bottom: 0;
    z-index: 10;
  }

  /* 2. Show + and / buttons in shell state (CSS default visible) */
  .btn-slash, .btn-file {
    display: flex !important;
  }

  /* 3. Draw button symbols with CSS â€” no font metrics, geometrically centred */
  .btn-file, .btn-slash {
    position: relative;
    font-size: 0; /* hide text content */
  }
  /* + : horizontal bar */
  .btn-file::before {
    content: '';
    position: absolute;
    width: 14px; height: 1.5px;
    background: currentColor;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
  }
  /* + : vertical bar */
  .btn-file::after {
    content: '';
    position: absolute;
    width: 1.5px; height: 14px;
    background: currentColor;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
  }
  /* / : diagonal stroke */
  .btn-slash::before {
    content: '';
    position: absolute;
    width: 1.5px; height: 14px;
    background: currentColor;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) rotate(20deg);
  }

  /* 3. Folder lozenge: show app name when label is empty */
  .btn-lozenge.folder .label:empty::before {
    content: 'GuÃ©ridon';
    color: var(--text-dim);
  }

  /* 4. Equal spacing: 8px above textarea, 8px below textarea to btn-bar,
     8px between buttons â€” uniform rhythm */
  .input-area {
    gap: 8px; /* up from 6px, matches btn-bar gap and padding-top */
  }

  /* 5. Context lozenge: show default when percentage is empty */
  .btn-lozenge.context .pct:empty::before {
    content: '0%';
    color: var(--text-dim);
  }
</style>
</head>
<body>

  <!-- Messages area â€” body-scroll layout, overflow visible -->
  <div class="messages" id="messages">
    <div class="msg-system">CSS-only shell â€” body-scroll proof-of-concept</div>
    <pre id="diag" style="font-family:var(--mono);font-size:0.72rem;color:var(--text-dim);line-height:1.8;padding:12px;background:var(--surface);border-radius:8px;white-space:pre-wrap;"></pre>

    <!-- Dummy messages to create scrollable content -->
    <div class="msg-user">Can you help me refactor this module?</div>
    <div class="msg-assistant"><p>Sure, I'll take a look at the code and suggest improvements.</p></div>
    <div class="msg-user">The scroll should now be on the document body, not the messages container.</div>
    <div class="msg-assistant"><p>That's correct. With <code>overflow-y: visible</code> on <code>.messages</code> and <code>height: auto</code> on <code>body</code>, the document itself scrolls. This enables Safari's "Full Page" screenshot to capture the entire conversation.</p></div>
    <div class="msg-user">What about the input area?</div>
    <div class="msg-assistant"><p>The input area uses <code>position: sticky; bottom: 0</code> so it stays pinned to the bottom of the viewport as you scroll through messages. It's the same pattern as many chat apps.</p></div>
    <div class="msg-user">And the keyboard on iOS?</div>
    <div class="msg-assistant"><p>iOS keyboard animation fires scroll events that can fight sticky positioning. The scroll-lock guard (800ms window) suppresses these during programmatic scrolls. Without it, keyboard open/close resets <code>userScrolledUp</code> mid-animation.</p></div>
    <div class="msg-user">One more message to ensure we have enough content to scroll.</div>
    <div class="msg-assistant"><p>This should be plenty. Try scrolling â€” the input bar should stay fixed at the bottom. On iOS, try a Full Page screenshot in Safari â€” it should now capture all messages, not just one viewport.</p></div>
    <div class="msg-user">Adding a few more for good measure.</div>
    <div class="msg-assistant"><p>Padding the conversation with enough content to force body scroll on most phone screens. The key visual test: does the input area stick? Does scroll feel natural?</p></div>
  </div>

  <script>
  // Diagnostic readouts â€” updates live on resize/viewport change
  function measure() {
    const d = document.getElementById('diag');
    const vv = window.visualViewport;
    const standalone = window.matchMedia('(display-mode: standalone)').matches;
    const bodyCS = getComputedStyle(document.body);
    const htmlCS = getComputedStyle(document.documentElement);

    d.textContent = [
      `mode:        ${standalone ? 'STANDALONE' : 'browser'}`,
      `screen.h:    ${screen.height}px`,
      `innerHeight: ${window.innerHeight}px`,
      `vv.height:   ${vv ? vv.height + 'px' : 'n/a'}`,
      `vv.offsetTop:${vv ? vv.offsetTop + 'px' : 'n/a'}`,
      `body.h (computed): ${bodyCS.height}`,
      `html.h (computed): ${htmlCS.height}`,
      `body.clientH: ${document.body.clientHeight}px`,
      `html.clientH: ${document.documentElement.clientHeight}px`,
      `body.offsetH: ${document.body.offsetHeight}px`,
      `body.scrollH: ${document.body.scrollHeight}px`,
      `devicePixelRatio: ${window.devicePixelRatio}`,
      `gap (screen - body): ${screen.height - document.body.offsetHeight}px`,
      ``,
      `safe-area-top:    ${getComputedStyle(document.documentElement).getPropertyValue('--safe-top')}`,
      `safe-area-bottom: ${getComputedStyle(document.documentElement).getPropertyValue('--safe-bottom')}`,
      `sat (measured):   ${getComputedStyle(document.querySelector('.messages')).paddingTop}`,
    ].join('\n');
  }

  measure();
  window.addEventListener('resize', measure);
  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', measure);
    window.visualViewport.addEventListener('scroll', measure);
  }
  // Also re-measure after a beat (iOS sometimes settles late)
  setTimeout(measure, 500);
  </script>

  <div class="input-area">
    <textarea class="input-field" placeholder="Message Claude..." rows="1" autocomplete="off" autocorrect="off" spellcheck="false"></textarea>
    <div class="staged-deposits" id="stagedDeposits"></div>
    <div class="btn-bar">
      <button class="btn-circle btn-file" aria-label="Attach" id="fileBtn">+</button>
      <button class="btn-circle btn-slash" aria-label="Commands" id="slashBtn">/</button>
      <button class="btn-lozenge folder" id="folderBtn"><span class="label" id="project"></span></button>
      <button class="btn-lozenge context" id="contextBtn"><span class="pct" id="contextPct"></span><span class="push-denied" id="pushDenied" title="Notifications blocked">ðŸ”‡</span></button>
      <button class="btn-circle btn-send" aria-label="Send" id="sendBtn">&#x2191;</button>
    </div>
  </div>

</body>
</html>
