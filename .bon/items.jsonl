{"id": "gdn-bazewe", "type": "action", "title": "Idle timer doesn't kill Claude mid-work", "brief": {"why": "5-minute idle timer fires purely on time, regardless of whether CC is actively streaming. Phone drops WiFi for 5 min during a long tool-use response → CC killed, response lost. Timer should only count down when Claude is idle AND no clients connected.", "what": "1. Bridge tracks streaming state (CC stdout activity) 2. Idle timer only starts when CC is idle AND clients.size === 0 3. Reset timer on any CC stdout activity", "done": "Claude doing a 10-minute tool-use sequence survives phone being away the whole time. Timer only fires after Claude finishes AND 5 min pass with no clients."}, "status": "done", "parent": "gdn-hatiho", "order": 9, "created_at": "2026-02-09T21:05:27Z", "created_by": "spm1001", "waiting_for": "After minimum tier. See docs/lifecycle-map.md medium tier.", "done_at": "2026-02-10T13:56:16Z"}
{"id": "gdn-bazogu", "type": "action", "title": "Check if auto_connect changed the stale session race (facipe interaction)", "brief": {"why": "Before tetini, page load connected via legacy ?session= path. Now it uses auto_connect + connectFolder — different code paths. facipe (page load bypasses picker) may be partially fixed or manifest differently.", "what": "1. Clear localStorage, reload page — should show picker (no auto-connect without stored folder) 2. Connect to folder, reload — should auto-connect (correct) 3. Compare with pre-tetini behaviour to see if facipe is resolved or changed", "done": "facipe status is known: either closed as side-effect of tetini, or updated with new reproduction steps"}, "status": "done", "parent": "gdn-cejaba", "order": 23, "created_at": "2026-02-09T23:23:11Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:59:36Z"}
{"id": "gdn-besuse", "type": "outcome", "title": "Bridge handles real-world conditions without surprises", "brief": {"why": "Bridge is the single chokepoint between mobile clients and CC processes. Bugs here are invisible, hard to reproduce, and affect every session.", "what": "1. Fix spawnCC cwd bug 2. Clean up reset()/session message handling 3. Audit session-mode operations 4. Buffer user messages for replay 5. Fix reconnect folder status 6. Diagnose context burn 7. Extract IO handlers 8. Integration tests for idle guards, replay, smoke test, Test 7 fix", "done": "No garbled output, no zombie sessions, reconnect works reliably, integration tests prove it end-to-end."}, "status": "open", "order": 9, "created_at": "2026-02-10T20:11:39Z", "created_by": "spm1001"}
{"id": "gdn-bezuwu", "type": "action", "title": "Reconnected session shows stale status in folder list", "brief": {"why": "After reconnecting to a session (replay from buffer), the folder list still shows the old status (paused/closed) instead of green/active. Technically correct — CC process hasn't respawned yet due to lazy loading — but misleading. User sees their conversation but the status dot says otherwise.", "what": "1. Trace folder list status derivation on reconnect — does activeByFolder get updated when replaying from buffer without a CC process? 2. Add a third visual state for 'has history, sleeping' (e.g. blue dot) — distinct from active (green) and paused (amber) 3. Eager spawn on reconnect to existing session (user is coming back to continue work) 4. Lazy spawn on fresh folder (no history, no reason to start CC until first prompt) 5. Update folder list status to reflect the eager/lazy split", "done": "Folder list status accurately reflects session state after reconnect. No misleading stale indicators."}, "status": "done", "parent": "gdn-besuse", "order": 5, "created_at": "2026-02-10T09:05:44Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add clientCount to SessionProcessInfo and update getActiveSessions filter", "Update bridge.ts wrapper to pass clients.size", "Update tests with clientCount fixtures and new cases", "Verify all tests pass"], "current": 4}, "done_at": "2026-02-12T19:20:09Z"}
{"id": "gdn-bikale", "type": "action", "title": "Resumed sessions still show orange dot in folder list", "brief": {"why": "After resuming a paused (orange dot) session, the folder list still shows it as paused/orange even though it is now live again. The folder state doesn't update to reflect that the session has been reconnected and the CC process is running.", "what": "1. Check what triggers folder status refresh — is it only on connectFolder or does it poll? 2. After resume, folder state should transition from paused to active 3. May need to emit a status update event when session reconnects", "done": "Folder list shows correct status (green/active) after resuming a previously paused session"}, "status": "done", "parent": "gdn-hatiho", "order": 14, "created_at": "2026-02-10T08:49:43Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:52:34Z"}
{"id": "gdn-bojijo", "type": "action", "title": "Context gauge accuracy — verify against /context", "brief": {"why": "Gauge shows 36% but no way to cross-check from -p mode. If the percentage is wrong, users make bad decisions about session length. The gauge was the first feature built and hasn't been validated against CC's own /context output since.", "what": "1. Manually compare gauge % with /context output in a desktop CC session on the same folder 2. Check contextWindow source — is it hardcoded, inferred from model name, or reported by CC? 3. Check if usage survives replay (should it? probably not — replay doesn't consume new tokens) 4. If CC reports contextWindow in result events, use that; if not, document the assumption", "done": "Gauge percentage matches /context within 5%. Source of contextWindow value is documented."}, "status": "open", "parent": "gdn-paciju", "order": 3, "created_at": "2026-02-10T09:10:37Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-bubasa", "type": "action", "title": "Integration test for idle guards in test-bridge.ts", "brief": {"why": "checkIdle is tested as pure function (21 tests) but the wiring in bridge.ts (scheduleIdleCheck → checkIdle → kill/recheck) is only testable with a running bridge. Same gap pattern as other bridge IO.", "what": "1. Add test: send prompt, disconnect WS, wait past IDLE_TIMEOUT_MS, verify CC still alive (mid-turn) 2. Add test: CC finishes turn, verify grace period, then kill 3. Add test: safety cap kills after MAX_IDLE_MS", "done": "test-bridge.ts has 3 idle guard integration tests that pass against running bridge"}, "status": "open", "parent": "gdn-besuse", "order": 9, "created_at": "2026-02-10T05:57:04Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-bujove", "type": "outcome", "title": "Opening the app and picking a folder just works", "brief": {"why": "4 actions spanning folder selector UI and bridge — dashboard status, new folder creation, close trigger, and service worker. All about the first-and-last thing you interact with.", "what": "1. Folder list shows live session status 2. New folder creation with fun names 3. Mobile close trigger and nudge 4. Service worker caches app shell for offline", "done": "App loads offline, folder list is a dashboard, new folders are fun, sessions close gracefully"}, "status": "open", "order": 12, "created_at": "2026-02-10T20:11:42Z", "created_by": "spm1001"}
{"id": "gdn-burera", "type": "action", "title": "Idle guards: don't kill CC while it's working", "brief": {"why": "Bridge kills CC after 5min of no WS clients regardless of whether CC is mid-turn. Long tool executions get killed.", "what": "1. IdleGuard interface + checkIdle pure function in bridge-logic.ts 2. ActiveTurnGuard with staleness detection 3. Grace period after work completes 4. Wire into bridge.ts replacing old single-timer 5. Tests", "done": "CC survives idle timeout when mid-turn. Stale CC (10min no output) gets killed. Grace period grants 5min after work finishes. Safety cap at 30min. 21 tests pass."}, "status": "done", "parent": "gdn-cejaba", "order": 25, "created_at": "2026-02-10T05:56:42Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T05:56:46Z"}
{"id": "gdn-cahato", "type": "action", "title": "New folder creation with fun names", "brief": {"why": "Sometimes you start fresh — new project, new experiment. 'New folder' creates ~/Repos/<name>, git inits it, and starts a session there. Auto-naming removes friction and adds character.", "what": "1. Add 'New folder' option to folder selector 2. Generate fun name (adjective-noun, alliterative, or similar) 3. mkdir ~/Repos/<name> && git init 4. Connect to new folder automatically", "done": "Tapping 'New folder' creates a git-initialised directory with a fun auto-generated name and starts a session in it."}, "status": "done", "parent": "gdn-bujove", "order": 2, "created_at": "2026-02-08T22:13:16Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-cahoci", "type": "action", "title": "Message queueing — bridge as postmaster", "brief": {"why": "If Claude is mid-turn, user messages are rejected. Would be great to queue them so Claude gets the message when it surfaces.", "what": "1. Bridge accepts prompt messages while CC is mid-turn 2. Queue on session object 3. Flush queue when result event fires 4. Client shows queued status", "done": "User can type a follow-up while Claude is working. It arrives as soon as Claude finishes."}, "status": "done", "parent": "gdn-lefoze", "order": 2, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Bridge accepts prompt messages while CC is mid-turn", "Queue on session object", "Flush queue when result event fires", "Client shows queued status"], "current": 4, "session": "/home/modha/Repos/gueridon"}, "updated_at": "2026-02-15T20:52:41Z", "done_at": "2026-02-15T20:52:41Z"}
{"id": "gdn-cawuge", "type": "action", "title": "Context fuel gauge and compaction visibility", "brief": {"why": "Mobile sessions run long without visibility into context usage. Users need a glanceable indicator (not a command to type) and notification when compaction happens, so they can manage session length.", "what": "1. Track usage from CC result events in adapter (input_tokens / contextWindow = percent) 2. Build context gauge component with color thresholds (>70% yellow, >90% red) 3. Detect compaction (input_tokens drop between turns) and surface as notification 4. Use hybrid estimation from pi-mono: last known usage + chars/4 for trailing messages", "done": "Context percentage visible in mobile UI, updates after each turn, yellow/red thresholds work, compaction events shown as notifications"}, "status": "done", "parent": "gdn-cejaba", "order": 5, "created_at": "2026-02-08T10:31:56Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-08T17:57:19Z"}
{"id": "gdn-cejaba", "type": "outcome", "title": "Access Claude Code from mobile with full harness", "brief": {"why": "Claude Code is terminal-only. Full experience (MCPs, CLAUDE.md, skills, tools) needs to be accessible from phone/tablet on home network, using MAX subscription instead of API billing.", "what": "1. ClaudeCodeAgent adapter implementing pi-web-ui Agent interface 2. JSONL event mapper (CC events → pi AgentEvents) 3. Node.js bridge server (WebSocket ↔ stdio) 4. Web app shell with pi-web-ui components 5. Directory picker for session launch 6. Tool execution viewer 7. AskUserQuestion mobile rendering", "done": "Can use guéridon daily on my phone: repeatable test workflow, clean mobile UI, connection failures handled gracefully, image input works, can create new folders. Core loop is reliable enough for real work."}, "status": "done", "order": 1, "created_at": "2026-02-08T10:31:43Z", "created_by": "spm1001", "done_at": "2026-02-10T20:12:07Z"}
{"id": "gdn-celuko", "type": "action", "title": "Resolve artifacts tool mismatch", "brief": {"why": "ChatPanel.setAgent() injects an artifacts tool via toolsFactory. CC doesn't know about this tool — it uses Write for artifacts. The artifacts panel will show UI that doesn't map to CC's capabilities.", "what": "1. Check if CC supports an artifacts-equivalent tool or if Write is the only path 2. If CC handles artifacts differently, map to appropriate UI rendering 3. If no CC artifacts support, remove artifacts tool injection and document why", "done": "Artifacts either render correctly through CC's tool output, or the artifacts path is cleanly removed with a note explaining CC's approach"}, "status": "open", "parent": "gdn-paciju", "order": 5, "created_at": "2026-02-08T17:58:07Z", "created_by": "spm1001", "waiting_for": "Deferred: CC uses Write for artifacts, text chat works fine without artifacts panel. Revisit when core mobile flow is solid."}
{"id": "gdn-cewibe", "type": "action", "title": "Jump to top and jump to bottom tappable controls", "brief": {"why": "Long conversations on mobile need quick navigation — no keyboard shortcuts available, scrolling through a long session is tedious", "what": "1. Floating jump-to-bottom button (appears when scrolled up) 2. Jump-to-top gesture or button 3. Keep controls minimal and out of the way", "done": "Tappable controls for top/bottom navigation, unobtrusive when not needed"}, "status": "done", "parent": "gdn-situwu", "order": 5, "created_at": "2026-02-10T08:18:40Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-cocara", "type": "action", "title": "Parallel tool call failures don't cascade", "brief": {"why": "When CC runs parallel tool calls and one fails, the bridge marks siblings as errored too. Claude loses valid results, wastes tokens re-running them, and can't tell real failures from collateral damage.", "what": "1. Investigate how CC reports parallel tool results in stream-json 2. Check whether the sibling poisoning is bridge-side or CC-side 3. If bridge-side, ensure each tool result is forwarded independently 4. If CC-side, document as upstream limitation", "done": "Investigated in wt-sleuthing session b535b0c5. Confirmed CC-side behaviour — bridge forwards each tool result independently, but CC itself emits <tool_use_error>Sibling tool call errored</tool_use_error>. Upstream limitation, not bridge-side."}, "status": "done", "parent": "gdn-zewumo", "order": 1, "created_at": "2026-02-11T07:58:54Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:34:53Z"}
{"id": "gdn-cofuci", "type": "action", "title": "Mobile close trigger and closure nudge", "brief": {"why": "Desktop /close is typed. Mobile needs a tap-friendly equivalent. The fuel gauge already tracks context — when it hits amber/red, nudge the user to wrap up rather than letting the session die ungracefully.", "what": "1. Add close/wrap-up button in UI (perhaps in gauge area when amber/red) 2. On tap, send a close-session prompt to CC (e.g. '/close' or structured close request) 3. When gauge hits amber, show nudge toast: 'Context getting low — consider wrapping up' 4. On explicit close, write handoff and return to lobby", "done": "User can tap to close a session. Amber gauge shows closure nudge. Closing writes a handoff and returns to folder list."}, "status": "open", "parent": "gdn-bujove", "order": 3, "created_at": "2026-02-08T22:13:27Z", "created_by": "spm1001", "waiting_for": "Deferred: Can close by switching folders or closing tab. Close trigger + nudge is polish for after core flow is reliable."}
{"id": "gdn-cogoga", "type": "action", "title": "Wire showError to all bridge error paths", "brief": {"why": "showError (persistent banner) only fires on onFolderConnectFailed. Process exits, bridge errors, and early exit diagnostics still go to console.error or showToast. Users don't see these on mobile.", "what": "1. Audit all onBridgeError, onProcessExit, and error event paths in main.ts 2. Route connection-class errors to showError with appropriate action buttons 3. Keep transient info (compaction, image format) on showToast", "done": "All user-relevant errors show as persistent banners. Console-only errors are limited to debug-level issues."}, "status": "done", "parent": "gdn-situwu", "order": 14, "created_at": "2026-02-15T20:29:31Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Audit all onBridgeError, onProcessExit, and error event paths in main.ts", "Route connection-class errors to showError with appropriate action buttons", "Keep transient info (compaction, image format) on showToast"], "current": 3, "session": "/home/modha/Repos/gueridon"}, "updated_at": "2026-02-15T21:04:06Z", "done_at": "2026-02-15T21:04:06Z"}
{"id": "gdn-dacega", "type": "action", "title": "Build test catches transitive dependency failures", "brief": {"why": "npm run build would have caught the @smithy import failure from session 3. Currently no build-time test exists — transitive dependency issues only surface when someone manually runs a production build.", "what": "1. Add a vitest test that runs npm run build and asserts exit code 0 2. Consider adding to a pre-commit hook or CI", "done": "npm test includes a build check. Transitive import failures are caught automatically."}, "status": "done", "parent": "gdn-vevoca", "order": 7, "created_at": "2026-02-09T09:44:44Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add a vitest test that runs npm run build and asserts exit code 0", "Consider adding to a pre-commit hook or CI"], "current": 2}, "done_at": "2026-02-09T09:55:09Z"}
{"id": "gdn-dadupo", "type": "action", "title": "User-friendly docs for other people and their Claudes", "brief": {"why": "Can't ship without docs. Current CLAUDE.md is internal. Other users need setup instructions, architecture overview, and troubleshooting.", "what": "1. Write README.md with quick start, prerequisites, deployment 2. Simplify CLAUDE.md for external consumption 3. Add troubleshooting section", "done": "A new user can clone, deploy, and use Guéridon from README alone"}, "status": "open", "parent": "gdn-lefoze", "order": 1, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-darovu", "type": "action", "title": "Teletype text appearance animation during Claude thinking", "brief": {"why": "StreamingMessageContainer renders every partial update as it arrives from CC, causing a teletype effect that's painful to watch on mobile. Content should appear in readable chunks, not character-by-character.", "what": "Superseded by gdn-hanaje (Coalesce CC partials before forwarding to clients). Root cause identified as bridge-side transport issue, not client-side rendering. The teletype effect is caused by the bridge forwarding every CC stdout line as a separate ws.send() at token rate — on mobile/cellular, network delivery is lumpy, producing visible text dribble. Fix is tick-based conflation in the bridge, not animation in the client.", "done": "Streaming text appears in readable chunks. No visible character-by-character teletype effect."}, "status": "done", "parent": "gdn-situwu", "order": 3, "created_at": "2026-02-10T08:18:31Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T21:42:41Z"}
{"id": "gdn-dejave", "type": "action", "title": "Typing indicator in bridge protocol", "brief": {"why": "Claude can't tell if the human is mid-thought or has walked away. Short messages could be 'quick ack, more coming' or 'that's everything'. Native CC has input indicators. The bridge could surface composing state to Claude via a protocol message.", "what": "1. Add composing/idle state to bridge protocol (client sends typing start/stop) 2. Decide whether to surface this to CC (via system message? via tool result metadata?) 3. Keep it lightweight — no heartbeat overhead", "done": "Claude can distinguish 'user is typing' from 'user is waiting for me'. No false positives from idle connections."}, "status": "open", "parent": "gdn-zewumo", "order": 4, "created_at": "2026-02-11T07:59:23Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-dicire", "type": "outcome", "title": "Bridge classifies and surfaces slash commands systematically", "brief": {"why": "Slash commands are handled ad-hoc: /exit has a one-off interceptor, local commands were silently dropped (now fixed), and the bridge has no awareness of what commands exist. CC already provides the data (slash_commands and skills arrays in init events) — we just need to use it.", "what": "1. Command registry pure functions in bridge-logic.ts 2. Wire registry into bridge session from init events 3. Forward command list to clients via new bridge message 4. Store command list in adapter for future autocomplete", "done": "Bridge logs command classification on init, client receives commandList message with categories, all existing tests pass plus new registry tests"}, "status": "open", "order": 16, "created_at": "2026-02-12T06:57:57Z", "created_by": "spm1001"}
{"id": "gdn-donave", "type": "action", "title": "Merge idle-guards + keduci-zaseze + facipe-bazogu into main", "brief": {"why": "Three worktree branches diverged from main. All touch bridge.ts and bridge-logic.ts. Session interface changes (idle guards adds fields, removes idleTimer) need manual resolution.", "what": "1. Merge keduci-zaseze into main (largest diff, most active) 2. Merge idle-guards (Session interface conflict expected) 3. Merge facipe-bazogu 4. Run full test suite after each merge 5. Remove worktrees (git worktree remove)", "done": "main has all three branches merged, 280+ tests pass, worktrees cleaned up"}, "status": "done", "parent": "gdn-cejaba", "order": 26, "created_at": "2026-02-10T05:56:56Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Merge keduci-zaseze into main (largest diff, most active)", "Merge idle-guards (Session interface conflict expected)", "Merge facipe-bazogu", "Run full test suite after each merge", "Remove worktrees (git worktree remove)"], "current": 5}, "done_at": "2026-02-10T07:50:25Z"}
{"id": "gdn-dozosa", "type": "outcome", "title": "returnToLobby unit test in ws-transport.test.ts", "brief": {"why": "returnToLobby had a WS onclose race that created duplicate connections. Fixed by detaching handlers before close. Without a test, this could regress.", "what": "Add test: returnToLobby detaches old WS handlers, creates single new connection, deferred connectFolder fires on lobby", "done": "ws-transport.test.ts covers returnToLobby lifecycle including handler detach"}, "status": "done", "order": 7, "created_at": "2026-02-09T15:00:11Z", "created_by": "spm1001", "done_at": "2026-02-09T15:46:40Z"}
{"id": "gdn-facipe", "type": "action", "title": "Page load bypasses folder picker — silently connects to stale session", "brief": {"why": "Every page load auto-connects to whatever folder was last active instead of showing the folder picker. Users opening guéridon fresh expect to choose. Flagged in two handoffs but never tracked.", "what": "1. Trace why WS connects with ?session= on fresh page load 2. Check if bridge sends 'connected' on stale session 3. Decide: should fresh load always go to lobby, or only when no active session?", "done": "Fresh page load shows folder picker (or intentional auto-reconnect with clear UX)"}, "status": "done", "parent": "gdn-cejaba", "order": 22, "created_at": "2026-02-09T22:47:47Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:59:36Z"}
{"id": "gdn-febuhu", "type": "action", "title": "Scroll to bottom on resume and new messages", "brief": {"why": "On session resume the conversation stays at current scroll position instead of jumping to the latest message — user has to manually scroll down to see where they left off", "what": "1. Auto-scroll to bottom on session resume/replay complete 2. Auto-scroll on new assistant message chunks during streaming 3. Respect user intent — if user has scrolled up to read, don't yank them down", "done": "Resume pins to bottom, streaming follows bottom, manual scroll-up is respected"}, "status": "done", "parent": "gdn-situwu", "order": 4, "created_at": "2026-02-10T08:18:36Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-fepegi", "type": "action", "title": "Worktree merge strategy and conflict hotspots", "brief": {"why": "Five worktrees (bridge, render, adapter, folder, cli) branching from same commit will diverge. package.json, vite.config.ts, and src/main.ts are touched by multiple workstreams. Bridge and folder worktrees have highest conflict risk since bujove (lifecycle) touches transport and besuse (bridge) touches the server side of the same connection.", "what": "1. Document merge order (independent branches first, conflicting ones last). 2. Identify shared files that need coordination. 3. Establish merge cadence — merge early, merge often. 4. Arc items committed only on main.", "done": "Documented merge strategy. First round of merges succeeds without surprise conflicts."}, "status": "done", "parent": "gdn-besuse", "order": 19, "created_at": "2026-02-11T13:57:26Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-figina", "type": "action", "title": "Multi-WS sessions with broadcast", "brief": {"why": "Multiple browser tabs can connect to the same folder. They should share a CC process and all receive events. Currently Session.ws is a single WebSocket.", "what": "1. Change Session.ws from WebSocket|null to Set<WebSocket> 2. Add reverse map ws→sessionId for disconnect lookups 3. All sendToClient calls become broadcast to Set 4. Idle timer starts when Set empties (all tabs gone) 5. Ping/pong remains per-WebSocket 6. connectFolder checks activeByFolder — if session exists, join it", "done": "Two WS connections to same folder share one CC process. Both receive streamed events. Disconnecting one doesn't kill the session. Disconnecting both starts idle timer."}, "status": "done", "parent": "gdn-zovogo", "order": 3, "created_at": "2026-02-09T06:15:26Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Change Session.ws from WebSocket|null to Set<WebSocket>", "Add reverse map ws→sessionId for disconnect lookups", "All sendToClient calls become broadcast to Set", "Idle timer starts when Set empties (all tabs gone)", "Ping/pong remains per-WebSocket", "connectFolder checks activeByFolder — if session exists, join it"], "current": 6}, "done_at": "2026-02-09T07:17:19Z"}
{"id": "gdn-fiheju", "type": "action", "title": "Move isStreaming management into stream event handlers", "brief": {"why": "isStreaming is only set by prompt() — not by stream events. During replay, no prompt() is called, so endReplay() has to manually set isStreaming=true when streamMessage exists. This workaround will be confusing if someone later refactors the streaming pipeline.", "what": "1. Set isStreaming=true in startStreamMessage() (stream_event message_start handler) 2. Remove the isStreaming=true from prompt() since stream events will handle it 3. Remove the workaround in endReplay() 4. Verify all tests pass", "done": "isStreaming is managed by stream events, not prompt(). endReplay workaround removed."}, "status": "done", "parent": "gdn-paciju", "order": 1, "created_at": "2026-02-09T23:23:19Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:25:49Z"}
{"id": "gdn-fosoci", "type": "action", "title": "Clean up agent_end emit in reset() and async session message handling", "brief": {"why": "reset() emits agent_end to trigger UI sync — semantically loose, could cause bugs if agent_end gets specific behavior later. handleSessionMessage is async with a .catch() band-aid instead of a proper queue like lobby messages use.", "what": "1. Consider a dedicated 'agent_reset' event type instead of reusing agent_end 2. Add session message queue pattern matching lobby handler 3. Review subscription handler for agent_end-specific side effects", "done": "reset() uses purpose-built event, session messages have proper async error handling"}, "status": "done", "parent": "gdn-besuse", "order": 2, "created_at": "2026-02-09T22:48:09Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:14:27Z"}
{"id": "gdn-fuhola", "type": "action", "title": "Folder scan module with filesystem state derivation", "brief": {"why": "The bridge needs to enumerate ~/Repos/ folders and determine each one's session state (active/paused/closed/fresh) without maintaining a registry. CC already stores session files at ~/.claude/projects/<encoded>/ and handoffs at ~/.claude/handoffs/<encoded>/.", "what": "1. Create server/folders.ts with encodePath(), getLatestSession(), getLatestHandoff(), scanFolders() 2. Scan ~/Repos/ dirs, stat each for type 3. For each: check CC projects dir for .jsonl files (paused), check handoffs for .md files (closed) 4. State logic: active from runtime map, paused wins over closed, fresh if neither 5. Sort: active > paused > closed > fresh 6. Test standalone with a script that logs the enriched list", "done": "scanFolders() returns correct state for guéridon (paused), a fresh repo (fresh), and folders with handoffs (closed). Standalone test script verifies."}, "status": "done", "parent": "gdn-zovogo", "order": 1, "created_at": "2026-02-09T06:15:11Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create server/folders.ts with encodePath(), getLatestSession(), getLatestHandoff(), scanFolders()", "Scan ~/Repos/ dirs, stat each for type", "For each: check CC projects dir for .jsonl files (paused), check handoffs for .md files (closed)", "State logic: active from runtime map, paused wins over closed, fresh if neither", "Sort: active > paused > closed > fresh", "Test standalone with a script that logs the enriched list"], "current": 6}, "done_at": "2026-02-09T06:17:17Z"}
{"id": "gdn-fuveso", "type": "action", "title": "Safari Reader Mode shows stale content after session switch", "brief": {"why": "Safari Reader Mode captures a snapshot of the DOM. Switching sessions changes the underlying content but Reader Mode retains its cached snapshot. Re-entering Reader Mode after a session switch shows the old session's content instead of the current one.", "what": "1. Investigate whether this is a Safari Reader Mode caching behaviour we can influence (meta tags, DOM mutation signals) 2. Check if there is a way to invalidate Reader Mode cache on session switch (document.title change, significant DOM restructure) 3. If Safari-side and unfixable, document as known limitation", "done": "Re-entering Reader Mode after a session switch shows current session content, OR documented as unfixable Safari behaviour with workaround noted."}, "status": "done", "parent": "gdn-cejaba", "order": 28, "created_at": "2026-02-10T08:49:12Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:52:32Z"}
{"id": "gdn-gabeda", "type": "action", "title": "Force refresh on mobile shows nothing when Tailscale tunnel is down", "brief": {"why": "When the DERP relay drops, the phone cannot reach kube at all — not just WS but HTTP too. Force refresh shows a blank page or spinner because the page itself cannot load. There is no offline fallback or service worker caching the app shell.", "what": "1. Add a service worker that caches the app shell (index.html + assets) — page loads even offline 2. App shows a clear offline/connecting state instead of blank 3. WS reconnect runs in background, UI updates when connection returns", "done": "Force refresh on mobile loads the app shell immediately even when kube is unreachable, shows a clear connecting state, and reconnects when Tailscale recovers"}, "status": "open", "parent": "gdn-bujove", "order": 4, "created_at": "2026-02-10T08:50:07Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-geduzo", "type": "action", "title": "Lit component smoke tests for GueridonInterface", "brief": {"why": "Nothing tests that the UI actually renders. A future Claude could break prop passing to message-list or streaming-message-container and every test would pass green. jsdom is already installed but unused.", "what": "1. Set up Lit test helpers with jsdom environment in vitest 2. Test GueridonInterface: create element, feed a text CC event sequence, assert assistant-message element exists in DOM 3. Test connection status rendering (connected/disconnected) 4. Test error state rendering", "done": "At least one test creates GueridonInterface in jsdom and verifies rendered output after feeding CC events. Catches wiring bugs between adapter state and Lit templates."}, "status": "done", "parent": "gdn-cejaba", "order": 13, "created_at": "2026-02-09T10:15:18Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Set up Lit test helpers with jsdom environment in vitest", "Test GueridonInterface: create element, feed a text CC event sequence, assert assistant-message element exists in DOM", "Test connection status rendering (connected/disconnected)", "Test error state rendering"], "current": 4}, "done_at": "2026-02-09T10:39:19Z"}
{"id": "gdn-gitaju", "type": "action", "title": "Wire command registry into bridge session", "brief": {"why": "The registry exists as pure functions but nothing uses it yet. The bridge needs to build the registry when it receives the init event from CC and store it on the session.", "what": "1. Add commandRegistry field to Session interface (initially null) 2. In wireProcessToSession stdout handler, detect system/init events and build registry on first init 3. Log classification counts for debugging 4. No behavioural change to existing flows", "done": "Bridge logs 'command registry built: X commands (Y local, Z skills, W builtin-api)' on session start"}, "status": "open", "parent": "gdn-dicire", "order": 2, "created_at": "2026-02-12T06:58:14Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-gocuze", "type": "action", "title": "Pull-to-refresh shows empty content when scrolling up in resumed session", "brief": {"why": "After resuming a paused session (orange dot), scrolling up to earlier messages triggers a pull-to-refresh gesture and shows no content above. It resolves itself but is disorienting — suggests the message history isn't fully loaded or the scroll container doesn't know its bounds.", "what": "1. Check if messageBuffer replay populates the full scroll container or loads lazily 2. Check if the scroll container height is set correctly after replay 3. May need to pin scrollHeight after replay completes", "done": "Scrolling up in a resumed session shows full message history without empty gaps or pull-to-refresh artifacts"}, "status": "done", "parent": "gdn-situwu", "order": 6, "created_at": "2026-02-10T08:49:39Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T20:20:48Z"}
{"id": "gdn-goloki", "type": "action", "title": "Context gauge feeds back to Claude, not just the human", "brief": {"why": "Claude can't see how much context it's consuming. It reads large files without knowing the cost, can't make economical choices about what to inline vs deposit to file. The human sees the fuel gauge but Claude is flying blind.", "what": "1. Include context usage in a system-level signal Claude can see (e.g. append-system-prompt with current usage, or inject into tool results) 2. Design so it's ambient — not a separate tool call Claude has to make 3. Consider: should it be in every result, or only when crossing thresholds (80%, 90%)?", "done": "Claude can reference its own context usage during a session. Makes economical choices about file reads and tool calls based on remaining capacity."}, "status": "open", "parent": "gdn-zewumo", "order": 3, "created_at": "2026-02-11T07:59:14Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-govuca", "type": "action", "title": "Bridge buffers output while phone is away, replays on reconnect", "brief": {"why": "Events emitted while no WS clients are connected are permanently lost. A 30-second WiFi dropout mid-response means a hole in the conversation. The session JSONL has the full record but there's no replay mechanism.", "what": "1. Ring buffer per session in bridge (last N events) 2. On WS reconnect, replay buffered events before live stream 3. Client requests catch-up with sequence numbers to avoid duplicates", "done": "Lock phone for 30s while Claude is streaming. Unlock. See the full response, no gaps."}, "status": "done", "parent": "gdn-hatiho", "order": 8, "created_at": "2026-02-09T21:05:18Z", "created_by": "spm1001", "waiting_for": "After minimum tier (susuna, murimo, weletu done). See docs/lifecycle-map.md medium tier.", "done_at": "2026-02-10T13:56:16Z"}
{"id": "gdn-gudube", "type": "action", "title": "Add command registry types and builder to bridge-logic.ts", "brief": {"why": "Need pure, testable foundation for classifying slash commands from CC init data. The init event gives us slash_commands (all) and skills (user only) — set difference reveals built-ins.", "what": "1. Add CommandCategory type (local/skill/builtin-api/bridge-only) 2. Add SlashCommandInfo and CommandRegistry types 3. Add LOCAL_BUILTINS set (context, cost) and BRIDGE_ONLY set (exit, quit) 4. Implement buildCommandRegistry() that classifies from two string arrays 5. Implement classify(text) method that extracts command name from prompt string 6. Write tests: classification logic, classify() with args/case/unknown, edge cases", "done": "buildCommandRegistry correctly classifies all command categories, classify() handles /command args format, comprehensive tests in bridge-logic.test.ts"}, "status": "open", "parent": "gdn-dicire", "order": 1, "created_at": "2026-02-12T06:58:07Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-gukivo", "type": "action", "title": "Investigate image input via CC stdin content arrays", "brief": {"why": "ChatPanel lets users attach images but adapter strips them to text-only. CC stdin format uses string content — unknown whether content arrays with image blocks work.", "what": "1. Test CC stdin with content array containing image_url block (base64 data URI) 2. If CC accepts it, add image encoding in WSTransport.send() or agent.prompt() 3. Wire paperclip button to file picker → base64 → content array 4. Test round-trip: attach image, verify CC receives and responds to it", "done": "User can tap paperclip, select an image, and CC receives it as input. Response references image content."}, "status": "done", "parent": "gdn-paciju", "order": 4, "created_at": "2026-02-08T19:04:28Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T08:06:31Z"}
{"id": "gdn-guruno", "type": "action", "title": "AskUserQuestion mobile interception", "brief": {"why": "In -p mode, AskUserQuestion fires as a tool_use event with full question/options structure BEFORE the error result. Bridge should intercept this, render as tappable buttons on mobile, and send the user's answer as the next message.", "what": "1. Bridge detects tool_use with name AskUserQuestion 2. Forward question/options to browser as a special event 3. Render as tappable button UI (not in chat flow) 4. User tap sends answer as next prompt 5. Coach CC via --append-system-prompt that AskUserQuestion errors are expected", "done": "AskUserQuestion renders as tappable buttons on mobile, user's selection flows back as a message"}, "status": "done", "parent": "gdn-cejaba", "order": 10, "created_at": "2026-02-08T17:57:57Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Bridge detects tool_use with name AskUserQuestion", "Forward question/options to browser as a special event", "Render as tappable button UI (not in chat flow)", "User tap sends answer as next prompt", "Coach CC via --append-system-prompt that AskUserQuestion errors are expected"], "current": 5}, "done_at": "2026-02-08T19:24:07Z"}
{"id": "gdn-hanaje", "type": "action", "title": "Coalesce CC partials before forwarding to clients", "brief": {"why": "Bridge forwards every CC stdout line as a separate ws.send() at token rate. On mobile/cellular this causes: (a) text dribbling in word-by-word (teletype), (b) garbled bursts after network stalls, (c) no backpressure when client can't keep up. All three are the same root cause.", "what": "1. Add tick-based conflation in wireProcessToSession — hold latest partial per message, flush on 250ms timer. 2. Non-partial events (result, error, processExit) flush immediately. 3. Check ws.bufferedAmount before sending; skip partials for saturated clients. 4. Cap messageBuffer size (prevents unbounded memory on long sessions).", "done": "Text arrives in readable chunks (~4/sec) on both localhost and cellular. No garbled bursts after network stalls. messageBuffer has a size cap."}, "status": "done", "parent": "gdn-besuse", "order": 15, "created_at": "2026-02-10T21:42:47Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-hatiho", "type": "outcome", "title": "Sessions feel natural on mobile — walk away and come back without losing work", "brief": {"why": "Mobile sessions currently have no identity (random UUIDs), no closure ritual, and no handoff. When a session dies the next Claude starts blind. Desktop rituals (/open, /close, arc, handoffs) need mobile equivalents so sessions survive the context boundary.", "what": "1. Bridge session registry + folder list endpoint 2. Folder chooser UI with search 3. Deterministic session IDs from folder path 4. Handoff/paused state display in chooser 5. Resume flow (paused → unfreeze, closed → fresh with handoff) 6. New folder creation with fun names 7. Mobile /close trigger 8. Closure nudge from fuel gauge", "done": "Tab resume is instant (visibilitychange). Page refresh preserves conversation. Medium tier: bridge buffers output while phone is away, idle timer doesn't kill working Claude, folder list shows Claude status. Ambitious: push notification when Claude finishes."}, "status": "done", "order": 2, "created_at": "2026-02-08T19:50:33Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T20:12:07Z"}
{"id": "gdn-hemute", "type": "action", "title": "Integration test for listFolders protocol", "brief": {"why": "The folder list API (listFolders/folderList) needs an integration test that verifies the WS protocol end-to-end. Currently test-bridge.ts covers prompt/abort but nothing folder-related.", "what": "1. Add listFolders test to scripts/test-bridge.ts (or new script) 2. Connect WS without ?session= (lobby mode) 3. Send listFolders, verify folderList response shape 4. Verify known folders appear with correct states 5. Send connectFolder, verify connected response with sessionId", "done": "Test script passes: connects, lists folders, gets enriched list back, connects to a folder. Can run against live bridge."}, "status": "done", "parent": "gdn-zovogo", "order": 5, "created_at": "2026-02-09T06:22:37Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T07:20:15Z"}
{"id": "gdn-hikosa", "type": "action", "title": "Folder list is a dashboard showing what each Claude is doing", "brief": {"why": "Folder picker is currently just a chooser — tap and dismiss. But with multiple sessions, you need to see which Claudes need attention. The bridge already knows whether CC is running; surfacing it turns the picker into a status screen.", "what": "1. Bridge tracks per-session state: not-started, working, finished-waiting, idle 2. Extend folderList message with session activity status 3. Folder selector shows status badges: working, needs input, idle 4. User opens folder list to check on things, not just to switch", "done": "Open folder list, see 'working' on one folder and 'finished — waiting for you' on another. Status updates live while dialog is open."}, "status": "done", "parent": "gdn-bujove", "order": 1, "created_at": "2026-02-09T21:05:35Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-hoduji", "type": "outcome", "title": "UX testing harness for phone-driven iteration", "brief": {"why": "Need to iterate on mobile UI with agent driving changes and user viewing on phone. Mock bridge + Vite HMR + screenshot pipeline enables this.", "what": "Already built: mock bridge on :3001 (scripts/mock-bridge.ts), Vite dev on :5173 with --host, Taildrive share for screenshots. Phone connects to kube:5173, saves screenshots to ~/Repos/scratch/ via Taildrive.", "done": "Agent can edit UI, user sees changes on phone in seconds, screenshots flow back for agent to look_at. Done."}, "status": "done", "order": 19, "created_at": "2026-02-15T19:31:03Z", "created_by": "spm1001", "done_at": "2026-02-15T19:31:08Z"}
{"id": "gdn-hugoso", "type": "action", "title": "Clearer working indicator when Claude is processing", "brief": {"why": "Coming back to the app, no visual signal that Claude is mid-turn. Red stop button exists but is subtle.", "what": "1. Add shimmer/pulse animation to input bar or status area during streaming 2. Consider pulsing dot or spinner near folder name", "done": "Glancing at the app instantly tells you whether Claude is working"}, "status": "done", "parent": "gdn-situwu", "order": 12, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T19:46:10Z"}
{"id": "gdn-jebudo", "type": "outcome", "title": "Folder dialog flash — find and fix root cause", "brief": {"why": "Dialog flashes open then immediately closes on page load. onSessionId fires right after onFolderList, closing the dialog before user can interact. Guarded with pendingFolderConnect flag (symptom suppressed) but root cause unknown. console.trace debug instrumentation still in folder-selector.ts.", "what": "1. Add instrumentation logging to trace exact sequence: WS open → lobbyConnected → folderList → connectFolder → connected → onSessionId 2. Reproduce the flash by opening the app fresh 3. Identify which event fires the spurious dialog close 4. Fix root cause (likely: remove the guard, fix the event ordering) 5. Remove console.trace debug instrumentation from folder-selector.ts", "done": "Opening the app shows folder dialog and it stays open until user selects. No flash. console.trace removed."}, "status": "done", "order": 6, "created_at": "2026-02-09T15:00:04Z", "created_by": "spm1001", "done_at": "2026-02-09T16:49:21Z"}
{"id": "gdn-jegosi", "type": "action", "title": "Folder lifecycle in main.ts is an explicit state machine, not callback soup", "brief": {"why": "main.ts folder switching uses shared mutable flags (pendingFolderConnect, deferredFolderPath) across multiple callbacks. The deferred connect pattern — detect mid-session, returnToLobby, wait for lobby callback, connect folder — is a three-step dance across two callbacks. This is where the dialog flash bug lives and where the returnToLobby WS race lived. Both were fixed with guards but the shape invites the next bug.", "what": "1. Define folder lifecycle states (idle, selecting, switching, connecting, connected) as a union type 2. Extract folder state machine from main.ts — transitions replace the pendingFolderConnect/deferredFolderPath flags 3. Each transition has a single handler — no split logic across onSessionId/onLobbyConnected/onFolderList callbacks 4. Unit test the state machine: transitions, guards, edge cases (double-click, rapid switch)", "done": "main.ts folder lifecycle uses typed states and transitions. pendingFolderConnect and deferredFolderPath flags are gone. State machine has unit tests."}, "status": "done", "parent": "gdn-hatiho", "order": 7, "created_at": "2026-02-09T16:04:03Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Write folder-lifecycle.ts — types + initial() + transition()", "Write folder-lifecycle.test.ts — pure function tests for all transitions", "Rewrite main.ts to use dispatch/executeEffect pattern", "Remove console.trace from folder-selector.ts (line 53)", "Run full test suite + build, verify jebudo flash is structurally prevented"], "current": 5}, "done_at": "2026-02-09T16:49:10Z"}
{"id": "gdn-jijina", "type": "action", "title": "Add error handling to lobby message queue", "brief": {"why": "lobbyQueue chains .then() with no .catch(). If handleLobbyMessage rejects, every subsequent lobby message for that connection silently never executes. The session handler at line 708 has .catch() but the lobby doesn't.", "what": "Add .catch() to lobbyQueue chain matching session handler pattern.", "done": "lobbyQueue has error handling. A failing lobby message doesn't kill the connection."}, "status": "done", "parent": "gdn-besuse", "order": 16, "created_at": "2026-02-10T21:42:48Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:32:24Z"}
{"id": "gdn-jimozo", "type": "action", "title": "End-to-end adapter sequence test", "brief": {"why": "Individual event handlers are tested but the full composition isn't. A prompt→stream→tool_use→tool_result→text_response→result sequence through handleCCEvent would catch ordering bugs and state leaks between phases.", "what": "1. Create a test that feeds a complete multi-turn CC event sequence 2. Assert intermediate state at each phase (isStreaming, pendingToolCalls, messages array) 3. Cover: text-only turn, tool-use turn, AskUserQuestion turn", "done": "At least one full-sequence test exercises the adapter from prompt to result, verifying state at each transition."}, "status": "done", "parent": "gdn-vevoca", "order": 8, "created_at": "2026-02-09T09:44:52Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create a test that feeds a complete multi-turn CC event sequence", "Assert intermediate state at each phase (isStreaming, pendingToolCalls, messages array)", "Cover: text-only turn, tool-use turn, AskUserQuestion turn"], "current": 3}, "done_at": "2026-02-09T09:55:18Z"}
{"id": "gdn-jiwize", "type": "action", "title": "Build bridge server", "brief": {"why": "The bridge server is what makes the adapter functional — it spawns and manages claude -p processes, pipes stdin/stdout as JSONL, and exposes a WebSocket endpoint for the browser.", "what": "1. Node.js WebSocket server (ws package) 2. Process-per-session: spawn claude -p with required flags on WS connect 3. Pipe WS messages to CC stdin as stream-json input format 4. Parse CC stdout JSONL and forward events over WS 5. Session management: idle timeout, kill, --resume on reconnect 6. Handle process lifecycle (exit, crash, restart)", "done": "Bridge server runs, browser can connect via WS, typing in ChatPanel sends to CC and streamed response renders in the UI"}, "status": "done", "parent": "gdn-cejaba", "order": 7, "created_at": "2026-02-08T17:54:50Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Node.js WebSocket server (ws package)", "Process-per-session: spawn claude -p with required flags on WS connect", "Pipe WS messages to CC stdin as stream-json input format", "Parse CC stdout JSONL and forward events over WS", "Session management: idle timeout, kill, --resume on reconnect", "Handle process lifecycle (exit, crash, restart)"], "current": 6}, "done_at": "2026-02-08T18:17:48Z"}
{"id": "gdn-jopavo", "type": "action", "title": "Visual e2e test: send message, refresh page, verify messages reappear", "brief": {"why": "Unit tests prove the replay machinery works but we haven't verified the full send→refresh→replay path end-to-end. The replay path is the kind of thing that breaks silently.", "what": "1. Use test-bridge.ts or webctl: connect to folder, send message, wait for response 2. Refresh page (webctl navigate) 3. Verify conversation messages reappear without opening folder picker", "done": "Automated test in scripts/test-bridge.ts passes: refresh preserves conversation"}, "status": "done", "parent": "gdn-hatiho", "order": 10, "created_at": "2026-02-09T23:23:03Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Use test-bridge.ts or webctl: connect to folder, send message, wait for response", "Refresh page (webctl navigate)", "Verify conversation messages reappear without opening folder picker"], "current": 3}, "done_at": "2026-02-09T23:35:55Z"}
{"id": "gdn-judonu", "type": "action", "title": "Export adapter pure helpers to eliminate as-any test casts", "brief": {"why": "49 adapter tests access mapContentBlocks/mapUsage/mapStopReason via (agent as any). TypeScript can't see through the cast — rename a method and tests break at runtime with 'undefined is not a function' instead of a compile error.", "what": "1. Extract mapContentBlocks, mapUsage, mapStopReason, emptyUsage as exported pure functions (not class methods) 2. Update ClaudeCodeAgent to call the exported functions 3. Update 49 tests to import functions directly instead of (agent as any).methodName 4. Verify all tests pass with no as-any casts on these helpers", "done": "Zero as-any casts for adapter helper access in test files. Renaming a helper function causes a compile error, not a runtime mystery."}, "status": "done", "parent": "gdn-paciju", "order": 2, "created_at": "2026-02-09T10:15:08Z", "created_by": "spm1001", "waiting_for": "Deferred: Developer hygiene, no user impact. Revisit when doing adapter work.", "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-keseho", "type": "action", "title": "Font sizes match for folder name and context percentage", "brief": {"why": "Folder name and context % in input bar are different sizes — looks unpolished", "what": "1. Find the size mismatch in gueridon-interface.ts input bar template 2. Unify to same text-xs or text-sm", "done": "Folder label and context percentage are visually balanced in the input bar"}, "status": "done", "parent": "gdn-situwu", "order": 10, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T19:46:10Z"}
{"id": "gdn-kijoni", "type": "outcome", "title": "Plan mode surfaces in Guéridon UI", "brief": {"why": "We discovered CC emits plan mode events (EnterPlanMode/ExitPlanMode) in stream-json. Guéridon currently renders these as raw JSON blobs — visible but unusable on mobile. This is part of a broader class: several CC tool calls (ExitPlanMode, EnterPlanMode, AskUserQuestion, possibly TodoWrite) produce structured output that the client shows as collapsed JSON rather than rich UI. A systematic approach to tool output rendering would solve plan mode and future tools in one go.", "what": "1. Capture CC plan mode events empirically (what JSONL does EnterPlanMode/ExitPlanMode produce?) 2. Identify the broader class of tool calls whose output is rendered as raw JSON in Guéridon — ExitPlanMode, EnterPlanMode, AskUserQuestion all have this problem. Enumerate which tools produce structured output that needs custom rendering 3. Design a general tool-output renderer registry (not one-off components per tool) 4. Design plan mode UI treatment — how should the plan file content be displayed, and how does the user approve/reject from mobile? 5. Implement plan mode state tracking in the adapter 6. Build UI components for plan display and approval interaction 7. Handle the read-only constraint (plan mode restricts CC to read-only tools)", "done": "User can trigger a plan-worthy prompt from Guéridon, see the plan rendered in the UI, and tap to approve or reject — full round-trip works from mobile"}, "status": "open", "order": 15, "created_at": "2026-02-12T06:57:46Z", "created_by": "spm1001"}
{"id": "gdn-kikowe", "type": "action", "title": "Remote webctl — CC on Kube controls Mac's Chrome", "brief": {"why": "webctl + chrome-log is a powerful workflow for browsing as the authenticated user. Currently requires CC and Chrome on the same machine. Tailscale serve can bridge the gap.", "what": "1. Update webctl config on Kube: cdp_endpoint → sameers-macbook-air Tailscale hostname 2. Test webctl navigate + snapshot from Kube to Mac's Chrome 3. Test chrome-log capture from remote CDP 4. Document any latency or reliability issues", "done": "From a Gueridon session on Kube, webctl navigate/snapshot/click works against Chrome running on Mac. chrome-log captures traffic."}, "status": "open", "parent": "gdn-musimu", "order": 3, "created_at": "2026-02-11T07:50:05Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-kodelu", "type": "action", "title": "Wire vendor drift detection into update-all.sh", "brief": {"why": "No mechanism exists to detect when our 6 vendored pi-web-ui files change upstream. update-all.sh runs daily in HEAVY tier — perfect place for a git diff check.", "what": "1. Create src/vendor/.provenance.json with commit hash and file mapping 2. Add note to src/vendor/README.md pointing to provenance file 3. Add HEAVY section 7 to update-all.sh: fetch upstream, diff 6 files, append to news 4. Test with simulated drift (old commit) then verify clean run", "done": "update-all.sh detects drift when gitCommit is set to an old commit, reports it in ~/.claude/.update-news, and logs clean when no drift exists"}, "status": "done", "parent": "gdn-zigepu", "order": 1, "created_at": "2026-02-09T20:10:25Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create src/vendor/.provenance.json with commit hash and file mapping", "Add note to src/vendor/README.md pointing to provenance file", "Add HEAVY section 7 to update-all.sh: fetch upstream, diff 6 files, append to news", "Test with simulated drift (old commit) then verify clean run"], "current": 4}, "done_at": "2026-02-09T20:12:19Z"}
{"id": "gdn-kopiki", "type": "action", "title": "pi-web-ui element dependency tree is mapped and all needed elements registered", "brief": {"why": "MessageList renders <user-message>, <assistant-message> etc. as custom elements. Each may render further elements (e.g. <markdown-block>). If ANY element in the chain isn't imported/registered, content is invisible. Currently playing whack-a-mole with missing registrations.", "what": "1. Grep all @customElement and customElements.define in pi-mono/packages/web-ui/src 2. Build dependency tree: which elements create which other elements in their render() 3. Import all needed elements in gueridon-interface.ts (or a dedicated registrations file) 4. Verify with browser DevTools that all elements upgrade", "done": "Send a message in browser, user bubble appears with text, assistant response streams and renders"}, "status": "done", "parent": "gdn-cejaba", "order": 15, "created_at": "2026-02-09T13:35:29Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Grep all @customElement and customElements.define in pi-mono/packages/web-ui/src", "Build dependency tree: which elements create which other elements in their render()", "Import all needed elements in gueridon-interface.ts (or a dedicated registrations file)", "Verify with browser DevTools that all elements upgrade"], "current": 4}, "done_at": "2026-02-09T14:42:23Z"}
{"id": "gdn-kugeto", "type": "action", "title": "Bridge uses --allowed-tools whitelist instead of --dangerously-skip-permissions", "brief": {"why": "Bridge currently uses --dangerously-skip-permissions which bypasses all safety. --allowed-tools is additive auto-approve — CC still has all tools but approved ones don't prompt. Safer posture, same UX.", "what": "1. Map which tools Guéridon sessions actually need auto-approved (Bash, Read, Write, Edit, Glob, Grep, WebFetch, Task) 2. Replace --dangerously-skip-permissions with --allowed-tools list in buildCCArgs 3. Test that approved tools run without prompt 4. Test that unapproved tools still work (just prompt)", "done": "Bridge spawns CC with --allowed-tools whitelist. No --dangerously-skip-permissions. All current functionality works."}, "status": "open", "parent": "gdn-zewumo", "order": 7, "created_at": "2026-02-12T19:36:11Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-kurato", "type": "action", "title": "State derivation unit test — closed wins over paused", "brief": {"why": "The closed-wins-over-paused logic and resume guard are regression-prone. Someone reading the code might think 'paused should win' without understanding session files persist forever. The resume bug (resuming closed sessions) was found by the user in live use.", "what": "1. Mock fs for folders with: both session+handoff (closed), session only (paused), handoff only (closed), neither (fresh) 2. Assert state derivation correctness 3. Test connectFolder: closed folder gets fresh UUID, paused folder reuses session ID", "done": "Tests cover all state derivation paths and the resume guard. Regression on closed-wins-over-paused would fail a test."}, "status": "done", "parent": "gdn-vevoca", "order": 6, "created_at": "2026-02-09T08:03:34Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T09:43:56Z"}
{"id": "gdn-lafetu", "type": "action", "title": "Test whether --allowed-tools propagates to Task subagents", "brief": {"why": "If --allowed-tools only applies to the parent CC process and not Task subagents, a subagent could route around denied tools. Risk identified during --allowed-tools investigation in wt-sleuthing session 6fe4b50f.", "what": "1. Spawn CC with --allowed-tools Bash only 2. Ask CC to use Task tool to run a Bash command 3. Check if subagent auto-approves or prompts 4. Document propagation behaviour in empirical-verification.md", "done": "Propagation behaviour documented. If it doesn't propagate, noted as risk in decisions.md."}, "status": "open", "parent": "gdn-zewumo", "order": 8, "created_at": "2026-02-12T19:36:19Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-lalepa", "type": "action", "title": "Context injection to Claude at usage thresholds", "brief": {"why": "Claude can't see context pressure. At 50/80/90% it should get a gentle system-level hint to be economical.", "what": "1. Track threshold crossings in adapter 2. Inject via --append-system-prompt or similar at 50%, 80%, 90% 3. Message content guides Claude to write to files, be concise", "done": "Claude receives ambient context pressure signals at thresholds without the user asking"}, "status": "open", "parent": "gdn-zewumo", "order": 10, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-laneve", "type": "action", "title": "Verify double-render fix visually", "brief": {"why": "Patched AgentInterface to clear streaming container on message_end (not just agent_end) to fix duplicate message display. Committed but never tested live.", "what": "1. Start bridge + dev server 2. Send a multi-turn conversation 3. Watch for duplicate messages during turn transitions 4. Verify streaming container clears when message completes", "done": "No visible duplicate messages during streaming→complete transition across 3+ turns."}, "status": "done", "parent": "gdn-cejaba", "order": 12, "created_at": "2026-02-08T22:19:14Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Start bridge + dev server", "Send a multi-turn conversation", "Watch for duplicate messages during turn transitions", "Verify streaming container clears when message completes"], "current": 4}, "done_at": "2026-02-08T22:45:12Z"}
{"id": "gdn-lefoze", "type": "outcome", "title": "Guéridon is ready for other people to use", "brief": {"why": "The app works for us but isn't shippable: YOLO permissions, no docs, rough UI edges. Need to close the gap between 'works for me' and 'works for anyone.'", "what": "1. User-friendly docs/README (gdn-dadupo) 2. Permissions via --allowed-tools (gdn-kugeto) 3. UI polish: connection status (gdn-mezajo), font sizes (gdn-keseho), tap focus (gdn-vipita), working indicator (gdn-hugoso), message queueing (gdn-cahoci) 4. Notifications (research brief at docs/research-brief-notifications.md) 5. Swipe to delete folders (gdn-letahe) 6. Context injection at thresholds (gdn-lalepa)", "done": "Someone else's Claude can set up and use Guéridon from the README alone. No --dangerously-skip-permissions."}, "status": "open", "order": 18, "created_at": "2026-02-15T19:30:26Z", "created_by": "spm1001", "updated_at": "2026-02-15T19:32:30Z"}
{"id": "gdn-lenuge", "type": "action", "title": "Build ClaudeCodeAgent adapter", "brief": {"why": "The adapter is the core translation layer between CC stream-json events and pi-web-ui's Agent interface. All context about the Agent contract and event mapping is warm in this session.", "what": "1. Subclass Agent from pi-agent-core 2. Override prompt() to send via transport (WebSocket later) 3. Build CC event handler that translates stream-json events to pi AgentEvents and state changes 4. Wire into main.ts replacing stub Agent 5. Verify ChatPanel still renders with adapter", "done": "ClaudeCodeAgent class exists, handles all CC event types from event-mapping.md, ChatPanel renders with it (non-functional until bridge exists)"}, "status": "done", "parent": "gdn-cejaba", "order": 6, "created_at": "2026-02-08T11:22:57Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Subclass Agent from pi-agent-core", "Override prompt() to send via transport (WebSocket later)", "Build CC event handler that translates stream-json events to pi AgentEvents and state changes", "Wire into main.ts replacing stub Agent", "Verify ChatPanel still renders with adapter"], "current": 5}, "done_at": "2026-02-08T11:25:39Z"}
{"id": "gdn-letahe", "type": "action", "title": "Swipe to delete folder/conversation", "brief": {"why": "No way to clean up the folder list on mobile. Long swipe gesture is natural for deletion.", "what": "1. Add swipe-to-delete gesture on folder list items 2. Only allow deletion for user-created folders (not system ones) 3. Confirmation before delete 4. Bridge endpoint to close/clean session", "done": "Can swipe to remove a folder from the list on mobile. Confirmation prevents accidents."}, "status": "done", "parent": "gdn-bujove", "order": 6, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T20:20:48Z"}
{"id": "gdn-lihibi", "type": "action", "title": "Build WebSocket transport for browser", "brief": {"why": "The adapter has a CCTransport interface but no implementation. The browser needs a WebSocket client that connects to the bridge and satisfies CCTransport.", "what": "1. Implement CCTransport over WebSocket 2. Auto-reconnect with exponential backoff 3. Wire into ClaudeCodeAgent.connectTransport() in main.ts 4. Connection status indicator in UI", "done": "Browser connects to bridge on page load, messages flow both directions, reconnects after disconnect"}, "status": "done", "parent": "gdn-cejaba", "order": 8, "created_at": "2026-02-08T17:55:00Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Implement CCTransport over WebSocket", "Auto-reconnect with exponential backoff", "Wire into ClaudeCodeAgent.connectTransport() in main.ts", "Connection status indicator in UI"], "current": 4}, "done_at": "2026-02-08T18:41:59Z"}
{"id": "gdn-likira", "type": "action", "title": "Transport folder API and lobby handling", "brief": {"why": "The browser-side WSTransport needs methods to request the folder list and connect to a folder. It also needs to handle the lobby state where no session exists yet.", "what": "1. Add listFolders() and connectFolder(path) methods to WSTransport 2. Add onFolderList callback in options 3. Handle folderList message type in handleMessage 4. Handle connected with null sessionId (lobby mode) — don't fire onSessionId until connectFolder completes 5. Update docs/bridge-protocol.md with new message types and lobby flow", "done": "Transport can request folder list and receive it via callback. connectFolder triggers session establishment. Protocol docs updated."}, "status": "done", "parent": "gdn-zovogo", "order": 4, "created_at": "2026-02-09T06:15:34Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add listFolders() and connectFolder(path) methods to WSTransport", "Add onFolderList callback in options", "Handle folderList message type in handleMessage", "Handle connected with null sessionId (lobby mode) — don't fire onSessionId until connectFolder completes", "Update docs/bridge-protocol.md with new message types and lobby flow"], "current": 5}, "done_at": "2026-02-09T07:19:52Z"}
{"id": "gdn-mapubi", "type": "action", "title": "Mine persistent-assistant for reusable patterns", "brief": {"why": "DB's persistent-assistant (Telegram harness) has solved permission routing, tool result synthesis, and structured question handling — problems we're working on in Guéridon. Cross-reference with existing items like summarizeToolInput.", "what": "1. Read persistent-assistant codebase (permission routing, tool result flow) 2. Identify patterns applicable to Guéridon bridge 3. Cross-reference with open arc items (nakoko, goloki, dejave) 4. File specific extraction actions if patterns are reusable", "done": "Reusable patterns identified and either adopted or filed as specific actions."}, "status": "open", "parent": "gdn-zewumo", "order": 9, "created_at": "2026-02-12T19:36:28Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-mazeni", "type": "action", "title": "Folder selector dialog replaces model chooser", "brief": {"why": "pi-web-ui orchestration layer (ChatPanel, AgentInterface, MessageEditor) is full of abstractions we don't need (model selector, thinking level, cost tracking) and blocks input area customisation. Own the orchestration, consume the rendering (MessageList, StreamingMessageContainer) — the seam is clean (12 props + 1 imperative method).", "what": "1. Write GueridonInterface skeleton — Lit component rendering message-list + streaming-container + basic textarea, event translation loop, replace ChatPanel in main.ts 2. Build custom input bar — image upload placeholder, folder button with CWD display (truncated), inline context gauge %, send/abort button 3. Write FolderSelector dialog — centered modal with search and state dots, reuse folder-chooser rendering 4. Wire folder button to dialog to transport, auto-open on first load 5. Move connection status below chat input 6. Remove old code — ChatPanel/AppStorage setup, context-gauge.ts, full-screen folder-chooser.ts", "done": "GueridonInterface renders messages correctly. Custom input bar has folder button + gauge + send. Folder dialog opens from button and auto-opens on first load. Connection status at bottom. No ChatPanel/AgentInterface/MessageEditor dependency. No as-any casts for customStats."}, "status": "done", "parent": "gdn-hatiho", "order": 5, "created_at": "2026-02-09T07:54:25Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Write GueridonInterface skeleton — Lit component rendering message-list + streaming-container + basic textarea, event translation loop, replace ChatPanel in main.ts", "Build custom input bar — image upload placeholder, folder button with CWD display (truncated), inline context gauge %, send/abort button", "Write FolderSelector dialog — centered modal with search and state dots, reuse folder-chooser rendering", "Wire folder button to dialog to transport, auto-open on first load", "Move connection status below chat input", "Remove old code — ChatPanel/AppStorage setup, context-gauge.ts, full-screen folder-chooser.ts"], "current": 6}, "done_at": "2026-02-09T08:38:20Z"}
{"id": "gdn-mevama", "type": "action", "title": "DERP relay causes frequent WS disconnects on mobile cellular", "brief": {"why": "Phone connects to kube via Tailscale DERP relay (not direct) on cellular. Relay path is fragile — pong timeouts at 10s cause disconnects every few minutes. Mac SSH over the same bearer is stable because TCP handles relay hiccups better than WS.", "what": "1. Increase pong timeout from 10s to 30s (quick win for relay latency spikes) 2. Consider making WS reconnect invisible — suppress disconnect flash if reconnect succeeds within N seconds 3. Investigate Tailscale direct connection failures on mobile carriers (UDP hole punching)", "done": "Mobile sessions on cellular stay connected for 10+ minutes without visible interruption"}, "status": "done", "parent": "gdn-hatiho", "order": 12, "created_at": "2026-02-10T08:47:34Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:59:46Z"}
{"id": "gdn-mezajo", "type": "action", "title": "Connection status uses input bar hints instead of misleading green dot", "brief": {"why": "Green dot is misleading — suggests Claude is active when it just means WS connected. Placeholder text and send button states are better signalling surfaces.", "what": "1. Remove green dot 2. Use textarea placeholder for status (e.g. 'Connecting...', 'Message Claude...') 3. Send button: black arrow=send, red square=stop, pulsing green=reconnecting", "done": "Connection state is communicated through input bar elements, not a separate dot"}, "status": "done", "parent": "gdn-situwu", "order": 9, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T19:46:10Z"}
{"id": "gdn-modesu", "type": "action", "title": "Verify main.ts auto_connect doesn't conflict with transport reconnect", "brief": {"why": "main.ts has an auto_connect path (localStorage → connectFolder on lobbyConnected). Transport now auto-sends connectFolder on reconnect and suppresses onLobbyConnected. Code reading confirms no conflict, but should verify with a manual test: connect to folder, force-refresh, confirm no double connectFolder in bridge logs.", "what": "1. Connect to folder on kube via mobile 2. Force-refresh page 3. Check bridge logs for connectFolder messages — should see exactly one per reconnect 4. Test returnToLobby then reconnect — should see lobby then auto_connect from localStorage", "done": "Manual test confirms single connectFolder on reconnect and correct auto_connect on fresh load"}, "status": "done", "parent": "gdn-besuse", "order": 14, "created_at": "2026-02-10T21:06:17Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:32:24Z"}
{"id": "gdn-muloda", "type": "action", "title": "Folder scan unit tests with mocked fs", "brief": {"why": "server/folders.ts has pure functions and mockable fs calls — high value, low effort. The regex-based handoff parsing is fragile and untested against edge cases.", "what": "1. Create server/folders.test.ts 2. Test encodePath edge cases (slashes, dots, spaces, root) 3. Test getLatestSession with vi.mock('node:fs/promises') — ENOENT, empty dir, picks newest, ignores non-jsonl 4. Test getLatestHandoff — well-formed, malformed, missing dir 5. Test scanFolders — state derivation for all four states, sort order, hidden dirs skipped, activeProcesses map", "done": "All tests pass. Covers encodePath, getLatestSession, getLatestHandoff, scanFolders with mocked filesystem."}, "status": "done", "parent": "gdn-vevoca", "order": 2, "created_at": "2026-02-09T06:38:47Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create server/folders.test.ts", "Test encodePath edge cases (slashes, dots, spaces, root)", "Test getLatestSession with vi.mock('node:fs/promises') — ENOENT, empty dir, picks newest, ignores non-jsonl", "Test getLatestHandoff — well-formed, malformed, missing dir", "Test scanFolders — state derivation for all four states, sort order, hidden dirs skipped, activeProcesses map"], "current": 5}, "done_at": "2026-02-09T09:24:47Z"}
{"id": "gdn-murimo", "type": "action", "title": "Trim desktop chrome for mobile — keep useful controls", "brief": {"why": "Pi-web-ui's button row has desktop-oriented controls (thinking toggle, model selector, attachment button, Anthropic logo) that eat vertical space on mobile. Some are useful to wire up (attachment for image input?), model selector is irrelevant (CC handles model selection server-side).", "what": "1. Audit which pi-web-ui button-row controls are still relevant after owning the shell 2. Remove irrelevant controls (model selector, Anthropic logo) 3. Keep/adapt useful ones (attachment → paperclip already exists) 4. Ensure input area is optimised for mobile viewport", "done": "Input area uses only mobile-relevant controls. No desktop-only chrome consuming vertical space."}, "status": "done", "parent": "gdn-cejaba", "order": 2, "created_at": "2026-02-08T22:19:25Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Audit which pi-web-ui button-row controls are still relevant after owning the shell", "Remove irrelevant controls (model selector, Anthropic logo)", "Keep/adapt useful ones (attachment → paperclip already exists)", "Ensure input area is optimised for mobile viewport"], "current": 4}, "done_at": "2026-02-09T21:37:18Z"}
{"id": "gdn-musimu", "type": "outcome", "title": "Mac is a viewport into Kube, not a separate dev environment", "brief": {"why": "Working across Mac and Kube means syncing repos, which causes git corruption risk, OS-difference piranha bites, and .arc/ conflicts. Mid-session device switching is impossible with sync-based approaches.", "what": "1. CLI bridge client for Mac terminal 2. Tailscale plumbing (Taildrive, serve for CDP) 3. Remote webctl over Tailscale 4. Image upload protocol extension", "done": "Can start a CC session from Mac terminal via bridge, browse as user via Chrome controlled from Kube, edit files in Sublime via Taildrive mount, and see context gauge at all times. Design doc: docs/kube-brain-mac-body.md"}, "status": "open", "order": 13, "created_at": "2026-02-11T07:49:38Z", "created_by": "spm1001"}
{"id": "gdn-nafazi", "type": "action", "title": "Run full integration tests 1-3 with real CC process", "brief": {"why": "Tests 1-3 in test-bridge.ts spawn a real CC process and test prompt→response, multi-turn, and reconnect. They were updated to use lobby→connectFolder path but haven't been run with a live CC since the ?session= removal. Lobby tests (4-9) pass.", "what": "1. Start bridge 2. Run npx tsx scripts/test-bridge.ts (without --lobby) 3. Verify tests 1-3 pass with real CC spawning 4. Fix any issues", "done": "All 9 integration tests pass against running bridge with real CC processes"}, "status": "open", "parent": "gdn-besuse", "order": 13, "created_at": "2026-02-10T21:06:12Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-nakoko", "type": "action", "title": "AskUserQuestion works natively, not via error-and-workaround", "brief": {"why": "Currently AskUserQuestion errors in -p mode (no TTY). The bridge detects the tool_use event, renders buttons for the human, and the error is suppressed via append-system-prompt. Claude has to be told to ignore the error. This works but it's a hack — Claude's instinct is to apologise for or retry errors.", "what": "1. Investigate CC's AskUserQuestion behaviour in -p stream-json mode 2. Design bridge interception — catch tool_use, render for client, synthesise a successful tool_result back to CC stdin 3. Implement so Claude sees a clean success, not an error followed by a workaround message", "done": "Investigated thoroughly (wt-sleuthing session). CC -p mode has no mechanism to inject synthetic tool_results via stdin — the error-and-workaround via append-system-prompt is the best available approach. AskUserQuestion renders as tappable buttons, user selection flows back as next message. Works reliably."}, "status": "done", "parent": "gdn-zewumo", "order": 2, "created_at": "2026-02-11T07:59:05Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:32:23Z"}
{"id": "gdn-nasahe", "type": "action", "title": "Bridge lobby mode and folder protocol", "brief": {"why": "Currently every WS connection immediately creates a session. The folder chooser needs a pre-session 'lobby' where the browser can list folders and pick one before any CC process is spawned.", "what": "1. Add folder field to Session interface 2. WS connects without ?session= enters lobby mode (no session created) 3. Handle listFolders message — call scanFolders(), return folderList response 4. Handle connectFolder message — create/resume session for chosen folder, send connected with sessionId 5. Reject prompt/abort in lobby mode with error 6. Existing ?session= path unchanged for backwards compat", "done": "WS can connect, send listFolders, get enriched list back, send connectFolder, get session. Prompt before connectFolder returns error. Old ?session= flow still works."}, "status": "done", "parent": "gdn-zovogo", "order": 2, "created_at": "2026-02-09T06:15:19Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add folder field to Session interface", "WS connects without ?session= enters lobby mode (no session created)", "Handle listFolders message — call scanFolders(), return folderList response", "Handle connectFolder message — create/resume session for chosen folder, send connected with sessionId", "Reject prompt/abort in lobby mode with error", "Existing ?session= path unchanged for backwards compat"], "current": 6}, "done_at": "2026-02-09T06:51:15Z"}
{"id": "gdn-neperu", "type": "action", "title": "Deterministic session IDs and resume flow", "brief": {"why": "Currently session IDs are random UUIDs — picking a folder can't find its session. Folder path must deterministically produce a session ID so resume works. The three resume paths (active/paused/closed) each behave differently.", "what": "1. Define deterministic session ID derivation from folder path (e.g. hash or encoded path) 2. Update bridge-logic.ts resolveSessionForFolder to use deterministic IDs 3. Update bridge.ts connectFolder to look up by derived ID 4. Verify resume flow: active → reconnect, paused → resume, closed → fresh session with new ID", "done": "Same folder always produces same session ID. Reconnecting to an active session works. Resuming a paused session works. Closed sessions start fresh."}, "status": "done", "parent": "gdn-hatiho", "order": 4, "created_at": "2026-02-08T22:13:07Z", "created_by": "spm1001", "waiting_for": "Deferred: Resume already works via bridge-logic.ts session resolution. Deterministic IDs are refinement, not prerequisite.", "done_at": "2026-02-10T19:59:40Z"}
{"id": "gdn-nicaju", "type": "action", "title": "Remove legacy ?session= reconnect path — all connections go through lobby", "brief": {"why": "The ?session= URL path bypasses connectFolder, creating sessions with folder:null. This causes: (1) CC spawned with no cwd on bridge restart, (2) session invisible to folder lookup, (3) lost conversation history on return. The speed gain (~200ms) over lobby→connectFolder is negligible — first-load already uses the lobby path without complaint.", "what": "1. Remove ?session= handling from bridge.ts connection handler (lines 688-726) 2. In ws-transport.ts doConnect(), always connect without ?session= — store folder path, re-send connectFolder on reconnect 3. Verify connectFolder finds existing bridge session (multi-WS reconnect path) 4. Update tests 5. Test on kube: kill WS, verify reconnect goes through lobby and replays buffer correctly", "done": "Single connection path: all WS connections start in lobby, reconnects use connectFolder. No folder:null sessions. Reconnect on mobile replays buffer correctly after bridge restart."}, "status": "done", "parent": "gdn-besuse", "order": 12, "created_at": "2026-02-10T20:46:57Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Remove ?session= handling from bridge.ts connection handler", "ws-transport.ts: always connect plain, re-send connectFolder on reconnect", "Update tests for both bridge and transport", "Verify existing multi-WS reconnect path in connectFolder works", "Test end-to-end: disconnect + reconnect replays buffer correctly"], "current": 5}, "done_at": "2026-02-10T20:56:15Z"}
{"id": "gdn-nucafa", "type": "action", "title": "Image upload via bridge protocol", "brief": {"why": "Image input is a revolution (drag to terminal). Both CLI and web clients will want it. Needs a bridge protocol extension since the image lives on the client, not on Kube.", "what": "1. Design protocol message for binary/base64 image data 2. Bridge receives image, injects into CC stdin as content array 3. CLI client: read local file, encode, send 4. Web client: file picker or paste, encode, send", "done": "Can send an image from Mac CLI client or Gueridon web UI, CC receives and processes it. Existing gdn-gukivo covers the CC stdin side."}, "status": "done", "parent": "gdn-musimu", "order": 4, "created_at": "2026-02-11T07:50:12Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create src/image-utils.ts — pure utility functions (resize, base64, validation)", "Create src/image-utils.test.ts — test pure functions", "Wire paperclip button + file input + addFiles in gueridon-interface.ts", "Add thumbnail preview strip to input bar template", "Modify handleSend() to build ContentBlock[] when images pending", "Add clipboard paste handler on textarea", "Add drag-and-drop with overlay on root element", "Show images in user message bubbles (agent displayContent + UserMessage render)", "Update send button state + cleanup in disconnectedCallback", "Add image upload tests to gueridon-interface.test.ts"], "current": 10}, "done_at": "2026-02-12T00:31:29Z"}
{"id": "gdn-nutizi", "type": "action", "title": "Tool use blocks are chunky and intercept scroll", "brief": {"why": "Tool blocks take up too much vertical space on mobile, and touching inside one captures the scroll gesture — scrolling the tool contents instead of the conversation. Users rarely need to see tool contents, just that it happened and whether it succeeded.", "what": "1. Collapse tool blocks by default — show tool name + status (success/error) 2. Tap to expand for full contents 3. Fix scroll capture — tool block contents should not intercept page scroll 4. Error state should be visually distinct (expand automatically on error?)", "done": "Tool blocks collapsed by default, expandable on tap, don't intercept scroll, errors auto-expand"}, "status": "done", "parent": "gdn-situwu", "order": 2, "created_at": "2026-02-10T08:18:44Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:12:36Z"}
{"id": "gdn-paciju", "type": "outcome", "title": "Adapter cleanly translates CC events without workarounds", "brief": {"why": "5 actions in claude-code-agent.ts — isStreaming hack, as-any test casts, unverified gauge, unexplored image input, artifacts mismatch. Each is a workaround or gap in the adapter layer.", "what": "1. Move isStreaming into stream event handlers 2. Export pure helpers to eliminate as-any casts 3. Verify context gauge against /context 4. Investigate image input via content arrays 5. Resolve artifacts tool mismatch", "done": "Adapter has no workarounds, no as-any test casts, gauge is validated, image and artifacts paths are resolved or documented"}, "status": "open", "order": 11, "created_at": "2026-02-10T20:11:41Z", "created_by": "spm1001"}
{"id": "gdn-pahawu", "type": "action", "title": "Code-split heavy deps for mobile data", "brief": {"why": "Bundle is 4.7MB (1.2MB gzip) — fine on WiFi but painful on mobile data. KaTeX, PDF.js, highlight.js are only needed when CC sends math/docs/code.", "what": "1. Audit pi-web-ui imports for lazy-loadable chunks 2. Dynamic import() for KaTeX, PDF.js, highlight.js on first use 3. Consider service worker for offline cache", "done": "First load under 500KB gzip on fresh cache. Heavy deps load on demand."}, "status": "done", "parent": "gdn-cejaba", "order": 11, "created_at": "2026-02-08T21:35:36Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T15:46:38Z"}
{"id": "gdn-patati", "type": "action", "title": "Build CLI bridge client", "brief": {"why": "Need a terminal client on Mac that connects to Gueridon's bridge on Kube. This is the core deliverable — makes Mac a first-class CC viewport without running CC locally.", "what": "1. WebSocket connection to bridge 2. Folder picker (listFolders → select → connectFolder) 3. Prompt input loop 4. Stream CC events and render text/tool calls 5. Always-visible context gauge from result event usage data 6. AskUserQuestion detection and option rendering", "done": "Can run client from Mac terminal, pick a Kube repo, have a full conversation with streaming output and context gauge visible. AskUserQuestion renders as selectable options."}, "status": "done", "parent": "gdn-musimu", "order": 1, "created_at": "2026-02-11T07:49:47Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-pefeva", "type": "action", "title": "Extract bridge IO handlers for testability", "brief": {"why": "handleSessionMessage, handleLobbyMessage, wireProcessToSession are untestable because importing bridge.ts starts a WebSocketServer. The bridge-logic.ts extraction covered pure functions but the IO routing logic — which is where session lifecycle bugs live — still has no tests.", "what": "1. Wrap WebSocketServer creation in bridge.ts behind a factory or lazy init (so import doesn't start server) 2. Extract handleSessionMessage and handleLobbyMessage to accept session/conn as args 3. Write unit tests for lobby→session transition, prompt routing, error on wrong-mode messages 4. Test lobbyQueue error propagation (.catch on chain)", "done": "bridge.ts can be imported in tests without starting a server. handleSessionMessage and handleLobbyMessage have unit tests covering the routing and error paths."}, "status": "open", "parent": "gdn-besuse", "order": 7, "created_at": "2026-02-09T10:15:24Z", "created_by": "spm1001", "waiting_for": "Deferred: Testability improvement, no user impact. Will matter when building buffering/lifecycle features."}
{"id": "gdn-penaki", "type": "action", "title": "Continue UX polish iteration with phone testing harness", "brief": {"why": "Session established the testing loop: mock bridge + Vite HMR + phone screenshots. Two fixes shipped (right-align bubbles, toggle layout shift). Many more UI items queued.", "what": "1. Start harness: sudo systemctl stop gueridon && nohup npx tsx scripts/mock-bridge.ts &, then nohup npx vite --host 0.0.0.0 & 2. Phone connects to kube:5173 3. Screenshots save via Taildrive to ~/Repos/scratch/ (iOS names like IMG_XXXX.PNG) 4. Work through: gdn-mezajo (connection status), gdn-keseho (font sizes), gdn-hugoso (working indicator), gdn-vipita (tap focus) 5. After mock testing, rebuild (npm run build) and restart real bridge (sudo systemctl start gueridon)", "done": "At least 3 more UI issues fixed and verified on phone"}, "status": "done", "parent": "gdn-situwu", "order": 13, "created_at": "2026-02-15T19:32:41Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Start harness: sudo systemctl stop gueridon && nohup npx tsx scripts/mock-bridge.ts &, then nohup npx vite --host 0.0.0.0 &", "Phone connects to kube:5173", "Screenshots save via Taildrive to ~/Repos/scratch/ (iOS names like IMG_XXXX.PNG)", "Work through: gdn-mezajo (connection status), gdn-keseho (font sizes), gdn-hugoso (working indicator), gdn-vipita (tap focus)", "After mock testing, rebuild (npm run build) and restart real bridge (sudo systemctl start gueridon)"], "current": 5, "session": "/home/modha/Repos/gueridon"}, "updated_at": "2026-02-15T19:46:44Z", "done_at": "2026-02-15T19:46:44Z"}
{"id": "gdn-picoki", "type": "action", "title": "Simplify folder lifecycle — two concerns, not three", "brief": {"why": "Three overlapping state models exist: transport ConnectionState (5 states), folder lifecycle FolderPhase (4 phases, ~22 transitions), and the status dot (driven by transport). The folder lifecycle is doing double duty — UI state (picker open/closed) AND transport mechanics (lobby teardown, retries, switching). The real model is two independent things: transport (pipe status, drives the status dot, owns reconnect/retry) and picker (open/closed, which folder tapped). The folder lifecycle state machine in the middle should be eliminated, its transport concerns absorbed by ws-transport and its UI concerns reduced to two booleans.", "what": "1. Move switching/reconnect/retry logic into ws-transport — transport accepts 'connect to folder X' and handles lobby teardown internally. 2. Replace folder-lifecycle.ts with two independent pieces of state: pickerOpen boolean, connectedFolder string|null. 3. Loading state (connecting spinner) is local to the folder row in the picker, not a global phase. 4. Status dot continues to be driven by transport state (already works this way). 5. Update gueridon-interface and main.ts to use the simplified model.", "done": "folder-lifecycle.ts is gone or reduced to trivial picker open/close logic. No knowledge of lobby mode, WS teardown, or retry counting in UI state. Transport layer owns all reconnect mechanics. Two concerns, not three."}, "status": "done", "parent": "gdn-bujove", "order": 5, "created_at": "2026-02-10T22:35:57Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-pomoma", "type": "action", "title": "Production smoke test catches serving regressions", "brief": {"why": "Manual 'open browser and see' verification works but isn't CI-friendly. Build test proves dist/ exists but not that bridge can serve it.", "what": "1. Add test: npm run build, start bridge, curl localhost:3001 returns HTML with expected content 2. Add test: curl /assets/nonexistent returns 404 3. Tear down bridge process in afterAll", "done": "npm test includes a smoke test that builds, starts bridge, verifies HTTP responses, and tears down cleanly"}, "status": "open", "parent": "gdn-besuse", "order": 11, "created_at": "2026-02-10T06:20:33Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-popucu", "type": "action", "title": "Tailscale plumbing — Taildrive and serve", "brief": {"why": "Tailscale replaces three separate tools: SSHFS (for editor file access), SSH tunnels (for CDP), and port forwarding (for dev servers). All already running on both machines.", "what": "1. tailscale drive share repos ~/Repos on Kube 2. Verify drive:share and drive:access ACL attributes 3. Mount Taildrive on Mac via Finder/CLI 4. tailscale serve 9222 on Mac for Chrome CDP 5. Test webctl from Kube reaching Mac's Chrome 6. Fix --accept-routes health warning on Kube", "done": "Sublime on Mac can open and edit files on Kube via Taildrive mount. webctl on Kube can navigate and snapshot Mac's Chrome. No SSH tunnels involved."}, "status": "open", "parent": "gdn-musimu", "order": 2, "created_at": "2026-02-11T07:49:55Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-pudaco", "type": "action", "title": "Unknown CC event types logged, not silently dropped", "brief": {"why": "No default case in handleCCEvent or handleStreamEvent. When CC adds new event types, they vanish without trace. Makes debugging schema drift impossible.", "what": "1. Add default case to handleCCEvent with console.debug for unknown types 2. Add default case to handleStreamEvent 3. Add test: unknown event type emits debug log, doesn't throw", "done": "Unknown CC event types produce console.debug with event type and payload summary"}, "status": "done", "parent": "gdn-cejaba", "order": 19, "created_at": "2026-02-09T15:46:58Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add default case to handleCCEvent", "Add default case to handleStreamEvent", "Add tests"], "current": 3}, "done_at": "2026-02-09T16:17:31Z"}
{"id": "gdn-rawira", "type": "action", "title": "Safari Reader Mode shows stale content after session switch", "brief": {"why": "Safari Reader Mode captures a snapshot of the DOM. Switching sessions changes the underlying content but Reader Mode retains its cached snapshot. Re-entering Reader Mode after a session switch shows the old session's content instead of the current one.", "what": "1. Investigate whether this is a Safari Reader Mode caching behaviour we can influence (meta tags, DOM mutation signals) 2. Check if there's a way to invalidate Reader Mode's cache on session switch (document.title change, significant DOM restructure) 3. If Safari-side and unfixable, document as known limitation", "done": "Re-entering Reader Mode after a session switch shows current session content, OR documented as unfixable Safari behaviour with workaround noted."}, "status": "done", "parent": "gdn-situwu", "order": 7, "created_at": "2026-02-10T08:37:57Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T20:20:54Z"}
{"id": "gdn-refiju", "type": "action", "title": "Audit bridge operations that should work in session mode", "brief": {"why": "listFolders was blocked in session mode causing stale folder picker. Other operations may be similarly over-restricted. As we add dashboard features (gdn-hikosa), more queries will need session-mode access.", "what": "1. List all bridge message types and their current session/lobby restrictions 2. Identify read-only operations that should be allowed in session mode 3. Consider a queue pattern for async session messages (currently uses .catch() band-aid)", "done": "All read-only bridge operations work in session mode, async error handling is consistent"}, "status": "done", "parent": "gdn-besuse", "order": 3, "created_at": "2026-02-09T22:47:56Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:32:24Z"}
{"id": "gdn-rehona", "type": "action", "title": "Adapter unit tests from verified JSONL", "brief": {"why": "The adapter translates CC stream-json events to pi AgentEvents. We have verified JSONL schemas in docs/empirical-verification.md — feeding them through handleCCEvent() and asserting output catches regressions.", "what": "1. Test framework (vitest) 2. Feed verified JSONL sequences through handleCCEvent 3. Assert resulting pi AgentEvents and state changes 4. Cover: text response, tool use, thinking blocks, error, abort", "done": "Tests pass, cover all event types from empirical-verification.md"}, "status": "done", "parent": "gdn-vevoca", "order": 5, "created_at": "2026-02-08T17:57:48Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Test framework (vitest)", "Feed verified JSONL sequences through handleCCEvent", "Assert resulting pi AgentEvents and state changes", "Cover: text response, tool use, thinking blocks, error, abort"], "current": 4}, "done_at": "2026-02-09T09:31:47Z"}
{"id": "gdn-ritise", "type": "action", "title": "Session replay doesn't show user messages", "brief": {"why": "On reconnect/refresh, the bridge replays buffered CC events but user messages are missing from the replayed conversation. User sees Claude's responses without the prompts that triggered them — disorienting context.", "what": "1. Check what messageBuffer captures — does it include the user prompt events or only CC stdout? 2. If user messages aren't in CC's output stream, bridge needs to buffer them separately when received via WS 3. Verify replay includes interleaved user + assistant messages in correct order", "done": "Page refresh shows full conversation: user messages interleaved with Claude responses in correct order."}, "status": "done", "parent": "gdn-besuse", "order": 4, "created_at": "2026-02-10T08:55:46Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T00:14:58Z"}
{"id": "gdn-rizaje", "type": "action", "title": "Visual smoke test before code archaeology", "brief": {"why": "This session spent significant context reading DialogBase/Dialog/bridge source for the flash bug before ever loading the app in a browser. A 2-minute visual check would have revealed 3 issues (layout, close button, blank messages) instantly. Pattern: eyes before brain.", "what": "1. Add a visual smoke test checklist to CLAUDE.md or docs/: start servers, open browser, check layout, send message, verify bubble appears 2. Make this the first step in any UI-related arc action", "done": "Checklist exists, referenced in CLAUDE.md, next Claude follows it"}, "status": "done", "parent": "gdn-cejaba", "order": 16, "created_at": "2026-02-09T13:35:38Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T15:46:40Z"}
{"id": "gdn-ruduzo", "type": "action", "title": "Mobile tab resume reconnects instantly via visibilitychange", "brief": {"why": "No visibilitychange listener. When mobile tab comes back to foreground, WS may be dead but reconnect waits up to 30s for ping timeout. User stares at stale UI.", "what": "1. Add visibilitychange listener in WSTransport 2. On visible: check WS readyState, reconnect immediately if not OPEN 3. Test with fake timers: visibility change triggers immediate reconnect attempt", "done": "Switching back to gueridon tab triggers immediate WS health check and reconnect if needed"}, "status": "done", "parent": "gdn-hatiho", "order": 1, "created_at": "2026-02-09T15:47:05Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add visibilitychange listener in WSTransport", "On visible: check WS readyState, reconnect immediately if not OPEN", "Test with fake timers: visibility change triggers immediate reconnect attempt"], "current": 3}, "done_at": "2026-02-09T22:53:54Z"}
{"id": "gdn-semibe", "type": "action", "title": "Line spacing too wide and gappy in Claude outputs", "brief": {"why": "Mobile screen real estate is precious — gappy line spacing wastes vertical space and makes conversations feel longer than they are", "what": "1. Identify which CSS rules control line-height in assistant message rendering 2. Test tighter spacing (probably 1.4 vs current) 3. Check it doesn't break code blocks or markdown rendering", "done": "Assistant messages have tighter line spacing that feels natural on mobile without cramping code blocks"}, "status": "done", "parent": "gdn-situwu", "order": 1, "created_at": "2026-02-10T08:18:26Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:12:36Z"}
{"id": "gdn-sinefu", "type": "action", "title": "Folder chooser UI with search and session states", "brief": {"why": "User needs to pick a folder before chatting. With tens of repos, a flat list isn't enough — needs search/filter. Each folder shows its session state (active/paused/closed/fresh) so the user knows what they're getting into.", "what": "1. Full-screen chooser shown before chat (replaces empty chat on first load) 2. Scrollable list of folders from bridge API 3. Search/filter input at top (filters as you type) 4. Visual states: green dot (active), amber dot (paused + time ago), handoff purpose line (closed), plain (fresh) 5. 'New folder' option at top with fun auto-generated name 6. Selecting a folder transitions to chat view with CWD in gauge", "done": "Can scroll through 30+ folders, search narrows list instantly, all four states render distinctly, selecting transitions to chat."}, "status": "done", "parent": "gdn-hatiho", "order": 3, "created_at": "2026-02-08T22:12:57Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Full-screen chooser shown before chat (replaces empty chat on first load)", "Scrollable list of folders from bridge API", "Search/filter input at top (filters as you type)", "Visual states: green dot (active), amber dot (paused + time ago), handoff purpose line (closed), plain (fresh)", "'New folder' option at top with fun auto-generated name", "Selecting a folder transitions to chat view with CWD in gauge"], "current": 6}, "done_at": "2026-02-09T07:34:12Z"}
{"id": "gdn-sirila", "type": "action", "title": "Fix test-bridge.ts Test 7 — listFolders in session mode", "brief": {"why": "Test 7 expects listFolders in session mode to return error, but bridge now allows it (returns folderList). Test has been broken since the session-mode listFolders change.", "what": "1. Update Test 7 to expect folderList response instead of error 2. Verify with npm run bridge + npx tsx scripts/test-bridge.ts", "done": "Test 7 passes with the current bridge behaviour"}, "status": "done", "parent": "gdn-besuse", "order": 8, "created_at": "2026-02-10T05:47:12Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T20:57:23Z"}
{"id": "gdn-situwu", "type": "outcome", "title": "Mobile output is readable and navigable", "brief": {"why": "If output isn't comfortable to read on a phone, the whole app fails regardless of how solid the bridge is.", "what": "1. Fix line spacing 2. Collapse tool blocks and fix scroll capture 3. Batch streaming renders 4. Auto-scroll on resume and new messages 5. Jump-to-top/bottom controls 6. Fix pull-to-refresh empty content 7. Investigate Safari Reader Mode", "done": "Claude output reads naturally on mobile — spacing, scroll, tool blocks all feel native."}, "status": "open", "order": 10, "created_at": "2026-02-10T20:11:40Z", "created_by": "spm1001"}
{"id": "gdn-sohadi", "type": "action", "title": "Scaffold project and wire up pi-web-ui", "brief": {"why": "Need working build pipeline before writing adapter code. pi-web-ui packages are on npm, need Vite bundler with Tailwind.", "what": "1. npm init with type:module 2. Install pi-web-ui, pi-agent-core, pi-ai, mini-lit, lit 3. Vite config with Tailwind plugin 4. Minimal index.html + main.ts loading AgentInterface 5. Verify components render", "done": "npm run dev serves a page with pi-web-ui chat interface visible (even if non-functional)"}, "status": "done", "parent": "gdn-cejaba", "order": 4, "created_at": "2026-02-08T10:31:56Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["npm init with type:module", "Install pi-web-ui, pi-agent-core, pi-ai, mini-lit, lit", "Vite config with Tailwind plugin", "Minimal index.html + main.ts loading AgentInterface", "Verify components render"], "current": 5}, "done_at": "2026-02-08T11:10:17Z"}
{"id": "gdn-sosodo", "type": "action", "title": "Move vendor drift section from claude-config to claude-suite", "brief": {"why": "update-all.sh section 7 (vendor drift detection) only exists in ~/.claude/scripts/update-all.sh (claude-config). It's not in claude-suite's scripts/ directory. Reinstalling from claude-suite would lose it.", "what": "1. Move the vendor drift section to claude-suite/scripts/update-all.sh 2. Ensure symlink picks it up 3. Verify drift detection still works after move", "done": "Vendor drift section exists in claude-suite source repo. Fresh install via claude-suite gets it."}, "status": "done", "parent": "gdn-cejaba", "order": 20, "created_at": "2026-02-09T21:05:42Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:59:40Z"}
{"id": "gdn-susuna", "type": "action", "title": "Repeatable mobile test workflow", "brief": {"why": "Every session wastes time rediscovering how to connect Chrome Debug + webctl to the dev server. Without a reliable test recipe, UI fixes and resilience work are blind. This is the foundation — everything else is faster with eyes open.", "what": "1. Document the test recipe (chrome-debug, npm run dev, npm run bridge, webctl start, navigate) 2. Test the recipe works end-to-end from a fresh state 3. Verify core paths on real mobile: fresh load → folder select → chat, mid-session folder switch, phone lock/unlock 4. Write a scripts/test-mobile.sh or npm script that launches everything needed", "done": "A Claude session can reliably open guéridon in Chrome Debug, interact with it via webctl, and take screenshots — without rediscovering the tooling each time."}, "status": "done", "parent": "gdn-cejaba", "order": 1, "created_at": "2026-02-09T17:11:05Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Document the test recipe (chrome-debug, npm run dev, npm run bridge, webctl start, navigate)", "Test the recipe works end-to-end from a fresh state", "Verify core paths on real mobile: fresh load → folder select → chat, mid-session folder switch, phone lock/unlock", "Write a scripts/test-mobile.sh or npm script that launches everything needed"], "current": 4}, "done_at": "2026-02-09T21:25:47Z"}
{"id": "gdn-takubi", "type": "action", "title": "Handoffs don't exist on kube — no session history context", "brief": {"why": "Handoffs are stored locally at ~/.claude/handoffs/ on the Mac. Bridge on kube has no access to them, so the beautiful session resume context (Done/Next/Gotchas) is missing. This breaks the session continuity promise.", "what": "1. Think through options: sync handoffs to kube? Store handoffs server-side? Make bridge write handoffs? 2. Design approach that works for multi-device (Mac + kube + future) 3. Implement chosen approach", "done": "CC sessions on kube have access to handoff context from previous sessions regardless of which machine created them"}, "status": "done", "parent": "gdn-hatiho", "order": 11, "created_at": "2026-02-10T08:18:49Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:59:37Z"}
{"id": "gdn-taleta", "type": "action", "title": "Context gauge unit tests", "brief": {"why": "context-gauge.ts has clean public API (update, setCwd, notifyCompaction, renderStats) and colour threshold logic that's never been verified.", "what": "1. Create src/context-gauge.test.ts with jsdom environment 2. Test colour thresholds (green >20%, amber 10-20%, red <10%) 3. Test CWD shortening (full path → folder name) 4. Test notifyCompaction toast timing with fake timers 5. Test renderStats returns valid Lit templates", "done": "All tests pass. Colour bands verified. Compaction toast appears and auto-dismisses."}, "status": "done", "parent": "gdn-vevoca", "order": 4, "created_at": "2026-02-09T06:39:04Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T09:41:27Z"}
{"id": "gdn-tawica", "type": "action", "title": "Investigate working directory bug in CC child process spawning", "brief": {"why": "Diagnosed: the ?session= reconnect path creates sessions with folder:null. When CC needs spawning on such a session, spawnCC gets no cwd and CC inherits the bridge's working directory. Observed in kube logs — legacy reconnects after DERP disconnects hit this path. Root cause is the dual connection path, not spawnCC itself.", "what": "Investigation complete. Root cause: ?session= sets folder:null on session creation (bridge.ts line 699). Fix filed as gdn-nicaju (remove ?session= path entirely). No separate fix needed — nicaju eliminates the code path that causes this.", "done": "Root cause identified and fix filed as gdn-nicaju."}, "status": "done", "parent": "gdn-besuse", "order": 1, "created_at": "2026-02-10T13:56:22Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T20:48:08Z"}
{"id": "gdn-tetini", "type": "action", "title": "Page refresh doesn't lose the conversation", "brief": {"why": "No client-side message persistence. Mobile tabs get killed by OS — user loses entire conversation on refresh. Biggest UX gap for mobile use.", "what": "Bridge buffer + auto-reconnect (plan: ~/.claude/plans/goofy-mapping-owl.md). 1. Bridge: messageBuffer on Session, buffer CC events inline in wireProcessToSession (serialize once), replay in attachWsToSession with historyStart/historyEnd markers (synchronous — no readline interleave) 2. Adapter: startReplay()/endReplay() with emit suppression + callback guards (onAskUser, onCwdChange, onCompaction). endReplay emits message_update if mid-stream then agent_start for sync 3. Transport: historyStart/historyEnd callbacks in WSTransportOptions 4. Folder lifecycle: auto_connect event (idle→connecting, skips dialog), store_folder/clear_stored_folder effects 5. Main.ts: localStorage helpers, auto-connect dispatch on lobby_entered, wire history callbacks + new effect handlers 6. Tests alongside each step 7. Visual verification", "done": "Refreshing the page (or mobile tab kill/restore) shows previous conversation messages"}, "status": "done", "parent": "gdn-hatiho", "order": 2, "created_at": "2026-02-09T15:47:01Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Bridge: add messageBuffer to Session, buffer CC events in wireProcessToSession, replay in attachWsToSession with historyStart/End markers", "Adapter: add startReplay/endReplay with emit suppression and callback guards", "Transport: add historyStart/historyEnd callbacks in WSTransport", "Folder lifecycle: add auto_connect event, store_folder/clear_stored_folder effects", "Main.ts: localStorage helpers, auto-connect on lobby_entered, wire history callbacks and new effects", "Tests: folder-lifecycle, ws-transport, claude-code-agent replay mode", "Visual verification: refresh page mid-conversation, messages reappear"], "current": 7}, "done_at": "2026-02-09T23:20:13Z"}
{"id": "gdn-tezima", "type": "action", "title": "Add bridge test for content-array prompts through handleSessionMessage", "brief": {"why": "The isExitCommand crash only happened because no test exercised a prompt with content array (no text field) through the full session message handler. bridge-logic tests cover isUserTextEcho but not the prompt dispatch path.", "what": "1. Add test: content-array prompt passes through isExitCommand without crash 2. Add test: content-array prompt reaches writeToStdin with correct envelope 3. Add test: content-array prompt is buffered for replay", "done": "Three tests covering content-array prompts in handleSessionMessage. isExitCommand guard tested explicitly."}, "status": "done", "parent": "gdn-besuse", "order": 20, "created_at": "2026-02-12T08:06:54Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T20:26:05Z"}
{"id": "gdn-togeca", "type": "action", "title": "Context fuel gauge component", "brief": {"why": "Mobile sessions run long without visibility. The adapter already tracks context usage from CC result events — need to surface it as a glanceable UI element.", "what": "1. Thin progress bar component using context % from adapter 2. Color thresholds: green default, yellow >70%, red >90% 3. Compaction detection (input_tokens drop) with notification 4. Position near input area for mobile visibility", "done": "Context bar visible in UI, updates after each turn, color changes at thresholds, compaction notified"}, "status": "done", "parent": "gdn-cejaba", "order": 9, "created_at": "2026-02-08T17:55:10Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Thin progress bar component using context % from adapter", "Color thresholds: green default, yellow >70%, red >90%", "Compaction detection (input_tokens drop) with notification", "Position near input area for mobile visibility"], "current": 4}, "done_at": "2026-02-08T19:55:05Z"}
{"id": "gdn-vadona", "type": "action", "title": "Trim MEMORY.md to 200 lines and update with JSONL history feature", "brief": {"why": "MEMORY.md is 230 lines (over 200-line limit), missing JSONL history feature, 285 test count, and worktree lesson", "what": "1. Trim stale content 2. Add gdn-keduci summary 3. Update test count to 285 4. Add worktree lesson to Design Lessons", "done": "MEMORY.md under 200 lines, new features documented"}, "status": "done", "parent": "gdn-cejaba", "order": 24, "created_at": "2026-02-10T05:47:12Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T07:48:03Z"}
{"id": "gdn-vafifi", "type": "action", "title": "Forward command list to clients via bridge protocol", "brief": {"why": "Client needs to know what commands exist and their categories for future autocomplete and help. The bridge has the registry — needs to send it to connected clients.", "what": "1. Add BridgeCommandList message type to bridge protocol 2. Broadcast commandList to all session clients when registry first built 3. In ws-transport.ts add onCommandList callback and handle the new message type 4. In claude-code-agent.ts store command list and expose via getter 5. In main.ts wire the callback", "done": "Client receives commandList message after session connect, adapter exposes commands property, ws-transport test covers new message type"}, "status": "open", "parent": "gdn-dicire", "order": 3, "created_at": "2026-02-12T06:58:21Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-vahazu", "type": "outcome", "title": "Active sessions survive bridge restarts", "brief": {"why": "Bridge crash or systemd restart kills all active CC subprocesses. User loses in-flight work with no recovery path. claude-go solved this with tmux (processes survive parent death) and KillMode=process in systemd.", "what": "1. On bridge start, scan for orphaned CC processes (by session-id convention or PID file) 2. Reconnect stdout/stdin to orphaned processes OR use --resume to start fresh with conversation intact 3. Persist message buffer to disk so replay works after restart 4. Add KillMode=process (or equivalent) to systemd service so CC children survive restarts", "done": "systemctl restart gueridon does not kill active CC sessions. Bridge reconnects to in-flight sessions within 10 seconds. Message buffer replays correctly on client reconnect."}, "status": "done", "order": 8, "created_at": "2026-02-10T08:52:17Z", "created_by": "spm1001", "done_at": "2026-02-10T20:12:07Z"}
{"id": "gdn-vesefi", "type": "action", "title": "serveStatic has real logic but no tests", "brief": {"why": "Static file serving has path traversal guard, SPA fallback, MIME lookup, cache headers — all untested. Same extraction pattern as bridge-logic.ts proved valuable.", "what": "1. Extract serveStatic + MIME map into bridge-logic.ts (or new static-serving.ts) 2. Unit test: path traversal blocked, SPA fallback, MIME types, cache headers on /assets/, 404 for missing files", "done": "serveStatic logic has unit tests, bridge.ts imports the extracted function"}, "status": "done", "parent": "gdn-cejaba", "order": 27, "created_at": "2026-02-10T06:20:27Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Extract serveStatic + MIME map into bridge-logic.ts (or new static-serving.ts)", "Unit test: path traversal blocked, SPA fallback, MIME types, cache headers on /assets/, 404 for missing files"], "current": 2}, "done_at": "2026-02-10T07:56:53Z"}
{"id": "gdn-vevoca", "type": "outcome", "title": "Automated test coverage for guéridon", "brief": {"why": "Zero test framework, zero automated tests. The adapter (most protocol-sensitive code) has no tests. As bridge refactor and folder chooser add complexity, regressions will compound silently.", "what": "Vitest framework setup, adapter unit tests (from verified JSONL fixtures), folder scan tests (mocked fs), transport tests (mock WebSocket), gauge tests, eventually bridge SessionManager extraction", "done": "npm test runs vitest. Adapter and folder scan have >80% coverage. CI-ready (no manual steps, no running servers needed)."}, "status": "done", "order": 4, "created_at": "2026-02-09T06:38:30Z", "created_by": "spm1001", "done_at": "2026-02-09T09:55:27Z"}
{"id": "gdn-vipebi", "type": "action", "title": "Toast is too generic for mobile error feedback", "brief": {"why": "showToast is the only user feedback mechanism — used for both context compaction notifications and errors. A single transient pill at the bottom isn't enough when errors need different treatment (persistent, actionable, severity-colored). As abort controls and connection error handling improve, the feedback surface needs to grow.", "what": "1. Audit current toast usage (compaction, show_error effect). 2. Design error UX appropriate for mobile — persistent banners for connection issues, transient toasts for info, actionable errors with retry/dismiss. 3. Implement.", "done": "Errors and info notifications are visually distinct. Connection errors persist until resolved. User can act on errors (retry, dismiss)."}, "status": "done", "parent": "gdn-situwu", "order": 8, "created_at": "2026-02-11T13:57:07Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T20:20:48Z"}
{"id": "gdn-vipita", "type": "action", "title": "Tap anywhere in message area gives input focus", "brief": {"why": "Currently must tap precisely on the textarea to focus — easy to miss on mobile", "what": "1. Add click handler on message area that focuses textarea 2. Don't steal focus if user is selecting text", "done": "Tapping empty space in conversation area focuses the input"}, "status": "done", "parent": "gdn-situwu", "order": 11, "created_at": "2026-02-15T19:30:54Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T19:46:10Z"}
{"id": "gdn-vosejo", "type": "action", "title": "prompt() guards against null transport", "brief": {"why": "If transport is null when prompt() called, user message is added to state and streaming set to true, but message silently dropped. UI stuck in streaming state forever.", "what": "1. Guard prompt() — if no transport, show error toast and return early without setting streaming=true 2. Add test case in claude-code-agent.test.ts", "done": "Calling prompt() without transport shows error to user, does not enter streaming state"}, "status": "done", "parent": "gdn-cejaba", "order": 18, "created_at": "2026-02-09T15:46:54Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Guard prompt() — return early with error if no transport", "Add test case"], "current": 2}, "done_at": "2026-02-09T16:16:49Z"}
{"id": "gdn-vupiso", "type": "action", "title": "Review deferred items after test workflow and UI are solid", "brief": {"why": "5 items deferred with 'revisit when core flow is solid' — artifacts, deterministic IDs, close trigger, adapter helpers, bridge extraction. Solid is subjective. Need a concrete trigger.", "what": "After gdn-susuna (test workflow) and gdn-murimo (UI trim) are done: review all waiting items. Unwait what's now relevant, close what's obsolete.", "done": "All 5 deferred items have been reviewed: each is either unwaited, closed, or has a refreshed waiting reason."}, "status": "done", "parent": "gdn-cejaba", "order": 21, "created_at": "2026-02-09T21:05:49Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:59:47Z"}
{"id": "gdn-walaco", "type": "action", "title": "Agent state resets cleanly on folder switch", "brief": {"why": "Singleton ClaudeCodeAgent accumulates messages, toolCallNames, context tokens across folder changes. Old session messages render in new session.", "what": "1. Add reset() method to ClaudeCodeAgent that clears messages, toolCallNames, askUserToolCallIds, usage, state 2. Call reset() in main.ts connectFolder callback before starting new session 3. Test: switch folders, verify no stale messages or token counts", "done": "Switching folders shows clean slate — no messages, no stale gauge, no accumulated tool state from previous session"}, "status": "done", "parent": "gdn-cejaba", "order": 17, "created_at": "2026-02-09T15:46:51Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add reset() method to ClaudeCodeAgent", "Call reset() in main.ts connectFolder callback", "Add tests for reset()", "Verify no stale state after folder switch"], "current": 4}, "done_at": "2026-02-09T16:16:12Z"}
{"id": "gdn-wawoko", "type": "action", "title": "Investigate Safari Reader Mode disappearing", "brief": {"why": "Safari Reader Mode was working at some point but has since disappeared. Title change (gdn-rawira) was a partial fix for stale content, but the bigger issue is Reader Mode not being available at all. May be related to SPA structure, meta tags, or content detection heuristics.", "what": "1. Research Safari Reader Mode availability heuristics (article tag, content length, meta tags) 2. Check if our Lit/SPA structure prevents Reader Mode detection 3. Add appropriate semantic HTML or meta tags to restore Reader Mode availability", "done": "Safari Reader Mode icon appears and shows current session content"}, "status": "open", "parent": "gdn-situwu", "order": 15, "created_at": "2026-02-15T20:29:46Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-wefuto", "type": "outcome", "title": "Local command output renders in the UI", "brief": {"why": "/context and other local commands execute correctly but output never appears on screen — the event reaches state but not the renderer", "what": "1. Add console.log tracing in adapter and GueridonInterface 2. Check message-list rendering path for non-streamed messages 3. Fix the missing message_start lifecycle gap 4. Verify /context output displays", "done": "/context output visible in the UI after execution"}, "status": "open", "order": 17, "created_at": "2026-02-15T15:05:35Z", "created_by": "spm1001"}
{"id": "gdn-weletu", "type": "action", "title": "Connecting and switching can fail gracefully", "brief": {"why": "Two stuck-forever states: connecting (retry loop with no limit) and switching (waits for lobby_entered that may never come). Bridge errors and processExit during connecting don't reach the state machine. No timeout. User is trapped with no escape. See docs/lifecycle-map.md for the full analysis.", "what": "1. Add retry counter to connecting phase (max 3) 2. Add timeout to connecting and switching phases (30s) 3. Wire bridge errors and processExit into state machine as connection_failed event 4. On failure: transition to browsing with error explanation 5. Test all failure paths", "done": "Connecting to a broken folder shows an error and returns to folder picker within 30s. Switching to a folder when bridge is down does the same. No infinite loops, no stuck states."}, "status": "done", "parent": "gdn-cejaba", "order": 3, "created_at": "2026-02-09T17:10:56Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add retry counter to connecting phase (max", "2. Add timeout to connecting and switching phases (30s)", "Wire bridge errors and processExit into state machine as connection_failed event", "On failure: transition to browsing with error explanation", "Test all failure paths"], "current": 5}, "done_at": "2026-02-09T21:47:56Z"}
{"id": "gdn-wezoji", "type": "action", "title": "Test swipe-to-delete gesture and handleDeleteFolder", "brief": {"why": "Swipe-to-delete shipped with no test coverage. The touch gesture in folder-selector.ts and handleDeleteFolder in bridge.ts (including rm -rf path validation) are untested.", "what": "1. Unit test: handleDeleteFolder validates path against SCAN_ROOT 2. Unit test: handleDeleteFolder destroys active session before deleting 3. UI test: swipe gesture state transitions (touch start → move → end → confirm)", "done": "Bridge deletion handler and folder selector swipe have test coverage. Path validation tested explicitly."}, "status": "open", "parent": "gdn-besuse", "order": 21, "created_at": "2026-02-15T20:29:38Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-wicazo", "type": "action", "title": "Context burns fast on kube — skill loading + resume history", "brief": {"why": "Remote Claude sessions via Gueridon run out of context quickly. Two factors: (1) skill loading (arc=15K, open=10K) injects ~25KB into every session, (2) resuming a session with --resume loads the full JSONL history into CC context. A 488KB session history consumes most of the context window before the user types.", "what": "1. Measure actual token consumption at session start (before first user message) 2. Consider whether Gueridon sessions should skip skill loading or use lighter variants 3. For resume: investigate whether CC has a way to compact/summarize history rather than loading full JSONL 4. Document the context budget so users know what they are working with", "done": "Investigated in wt-sleuthing session b535b0c5. Per-turn cost is 11-16 tokens normally. The 14.5K/turn spike was cache prefix invalidation. Created scripts/context-profiler.py for future diagnosis."}, "status": "done", "parent": "gdn-besuse", "order": 6, "created_at": "2026-02-10T13:54:02Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:34:53Z"}
{"id": "gdn-wiruvu", "type": "action", "title": "Hung CC process has no user-facing escape on mobile", "brief": {"why": "If CC hangs mid-turn (API timeout, stuck tool), the client has no abort button. The only escape is closing the tab, which triggers a slow chain: pong timeout (up to 60s) → idle check (5 min) → kill. No feedback to the user that anything is wrong. The bridge detects staleness after 10 min of no stdout, but only when no clients are connected.", "what": "TBD — two approaches: (a) better server-side detection (bridge notices CC is stuck and intervenes), (b) user-facing abort control on mobile, (c) both. Needs design thinking.", "done": "A hung CC process is either detected and killed automatically within a reasonable time, or the user has a way to intervene, or both."}, "status": "open", "parent": "gdn-besuse", "order": 17, "created_at": "2026-02-10T22:07:24Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-wisupe", "type": "action", "title": "Transport unit tests with mock WebSocket", "brief": {"why": "ws-transport.ts handles protocol discrimination, reconnect backoff, and prompt timeout — all testable with mock WebSocket and fake timers. Medium effort but catches real bugs (e.g. processExit not synthesizing result event).", "what": "1. Create src/ws-transport.test.ts 2. Stub global WebSocket with controllable mock 3. Test message dispatch (bridge vs cc source) 4. Test reconnect backoff (1s, 2s, 4s... 30s cap) with fake timers 5. Test prompt timeout (fires after 10s, clears on promptReceived) 6. Test processExit → synthetic result event", "done": "All tests pass with fake timers and mock WebSocket. No real connections needed."}, "status": "done", "parent": "gdn-vevoca", "order": 3, "created_at": "2026-02-09T06:38:56Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create src/ws-transport.test.ts", "Stub global WebSocket with controllable mock", "Test message dispatch (bridge vs cc source)", "Test reconnect backoff (1s, 2s, 4s... 30s cap) with fake timers", "Test prompt timeout (fires after 10s, clears on promptReceived)", "Test processExit → synthetic result event"], "current": 6}, "done_at": "2026-02-09T09:41:13Z"}
{"id": "gdn-wiweka", "type": "action", "title": "Chat output streams character-by-character instead of chunked rendering", "brief": {"why": "StreamingMessageContainer renders every partial update as it arrives from CC, causing a teletype effect that's painful to watch on mobile. Content should appear in readable chunks, not character-by-character.", "what": "1. Profile where the per-character updates originate (CC stdout chunking vs adapter emit frequency vs Lit render batching) 2. Add debounce or requestAnimationFrame batching to streaming updates 3. Verify markdown rendering doesn't re-parse on every character", "done": "Streaming text appears in readable chunks. No visible character-by-character teletype effect."}, "status": "done", "parent": "gdn-cejaba", "order": 28, "created_at": "2026-02-10T08:37:46Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:52:33Z"}
{"id": "gdn-wodefa", "type": "action", "title": "Arc items created on kube don't sync back to Mac", "brief": {"why": "Arc stores items in .arc/items.jsonl inside each repo. Items created during a Gueridon session on kube exist only on kube. Same problem as handoffs — data created on one machine is invisible on the other.", "what": "1. Document as part of infra-sync analysis 2. For arc: git commit + push from kube after session, pull on Mac (or vice versa) 3. Consider whether /close on Gueridon should auto-commit .arc/ changes", "done": "Arc items created on either machine are visible on both within minutes"}, "status": "done", "parent": "gdn-hatiho", "order": 13, "created_at": "2026-02-10T08:47:38Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-10T19:59:38Z"}
{"id": "gdn-womabe", "type": "action", "title": "Set up vitest framework and npm test scripts", "brief": {"why": "No test framework exists. Need vitest (reuses vite.config.ts aliases and esbuild target), npm scripts, and basic config before any tests can be written.", "what": "1. npm install -D vitest 2. Add test and test:watch scripts to package.json 3. Verify vitest inherits vite.config.ts (pi-web-ui alias, es2020 target) 4. Write one trivial test (encodePath) to confirm setup works 5. Add jsdom devDep for future browser-side tests", "done": "npm test runs and passes. vitest picks up vite.config.ts aliases. One test exists and passes."}, "status": "done", "parent": "gdn-vevoca", "order": 1, "created_at": "2026-02-09T06:38:40Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["npm install -D vitest", "Add test and test:watch scripts to package.json", "Verify vitest inherits vite.config.ts (pi-web-ui alias, es2020 target)", "Write one trivial test (encodePath) to confirm setup works", "Add jsdom devDep for future browser-side tests"], "current": 5}, "done_at": "2026-02-09T09:20:14Z"}
{"id": "gdn-wumino", "type": "action", "title": "Fix compaction false positive on session resume", "brief": {"why": "Compaction toaster fires on brand new sessions after resume. _lastInputTokens accumulates during replay (only the callback is suppressed, not the tracking). First live assistant message with lower usage triggers the 20k/15% drop check against replay-inflated tokens. Seen on kube session warm-wolf.", "what": "1. Reset _lastInputTokens to 0 in endReplay() 2. Add test: replay with high-usage events then live message with low usage — verify no compaction callback 3. Verify existing compaction tests still pass", "done": "Resuming a session with replay history does not trigger compaction toaster. Genuine mid-session compaction still detected."}, "status": "done", "parent": "gdn-zewumo", "order": 5, "created_at": "2026-02-12T00:14:50Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:09:48Z"}
{"id": "gdn-zamaju", "type": "action", "title": "deleteFolder guards against deleting real project folders", "brief": {"why": "handleDeleteFolder in bridge.ts does rm -rf on the folder path. Fun-named scratch folders are expendable, but swiping on a real project (e.g. gueridon itself) would destroy it. No guard exists beyond path validation.", "what": "1. Add a safety check: only allow deletion of folders that were created by the bridge (fun-named pattern, or a .gueridon-created marker file) 2. For non-bridge folders, show a stronger warning or refuse 3. Add confirmation text that says 'permanently delete' for clarity", "done": "Cannot accidentally delete a real project folder via swipe-to-delete. Fun-named folders delete cleanly."}, "status": "open", "parent": "gdn-bujove", "order": 7, "created_at": "2026-02-15T20:29:22Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-zaseze", "type": "action", "title": "Add automated replay integration test to test-bridge.ts", "brief": {"why": "The replay path breaks silently. Unit tests prove machinery works but the full send→refresh→replay path needs an integration test. Manual webctl verification catches issues but doesn't prevent regression.", "what": "1. In test-bridge.ts: connect to folder, send prompt, wait for response 2. Disconnect WS, reconnect to same folder 3. Verify historyStart/historyEnd messages received with buffered CC events 4. Verify message count matches pre-disconnect count", "done": "test-bridge.ts has a replay test that connects, prompts, disconnects, reconnects, and verifies buffer replay"}, "status": "open", "parent": "gdn-besuse", "order": 10, "created_at": "2026-02-09T23:23:26Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-zecobi", "type": "action", "title": "Verify image resize works on iOS Safari", "brief": {"why": "OffscreenCanvas and createImageBitmap have spotty support on older iOS Safari. If they fail, resizeImage throws and handleSend shows a toast but the image never sends.", "what": "1. Open kube:3001 on phone 2. Attach a photo from camera roll 3. Verify thumbnail appears 4. Send and confirm CC responds to image content 5. Check console for canvas errors", "done": "Image sent and understood by CC from iOS Safari. No console errors from canvas APIs."}, "status": "open", "parent": "gdn-musimu", "order": 5, "created_at": "2026-02-12T08:06:47Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-zerobu", "type": "action", "title": "Shared CC event interpreter for web and CLI clients", "brief": {"why": "Both the web UI (claude-code-agent.ts) and CLI client (cli/gdn.ts) independently translate raw CC events into their own rendering format. As the CLI matures (tool calls, AskUserQuestion, abort, error handling), it will reimplement the same event interpretation logic. The shared piece is 'CC event → semantic intent' — each client then renders the intent in its own way.", "what": "1. Extract CC event interpretation into a shared module (event types, turn detection, usage extraction, tool call lifecycle). 2. Web adapter consumes shared types, maps to AgentEvent for Lit. 3. CLI adapter consumes shared types, maps to ANSI output. 4. Both clients benefit from bug fixes in one place.", "done": "A shared event interpreter module exists. Both web and CLI clients import it. Adding a new CC event type requires one code change, not two."}, "status": "open", "parent": "gdn-paciju", "order": 6, "created_at": "2026-02-11T13:56:57Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-zewumo", "type": "outcome", "title": "Claude's experience through the bridge is clean and predictable", "brief": {"why": "Claude is a user of the bridge too. Errors, missing signals, and workarounds degrade output quality — Claude wastes tokens retrying, apologising for expected errors, or making conservative choices because it can't see context pressure. The bridge should be as transparent to Claude as it is to the human.", "what": "1. Parallel tool calls don't poison siblings on failure 2. AskUserQuestion works without error-then-workaround 3. Context gauge visible to Claude (not just rendered for human) 4. Typing/composing indicator in protocol 5. Hook errors distinguishable from real failures", "done": "A Claude session through Gueridon produces zero spurious errors in the tool stream. Claude can see context pressure. No workarounds documented in system prompts for expected failures."}, "status": "open", "order": 14, "created_at": "2026-02-11T07:58:46Z", "created_by": "spm1001"}
{"id": "gdn-zibaha", "type": "action", "title": "Folder dialog opens then immediately closes", "brief": {"why": "Dialog flashes then disappears on page load. onSessionId fires right after onFolderList, closing the dialog before user can interact. CWD shows itv-linkedin-analytics without user selection — something is auto-connecting.", "what": "1. Reproduce: open app, observe dialog flash 2. Add event sequence logging to identify which callback closes the dialog 3. If root cause is same as gdn-jebudo, mark as duplicate 4. If different, fix the specific trigger", "done": "Dialog stays open on fresh page load until user selects a folder. No flash."}, "status": "done", "parent": "gdn-hatiho", "order": 6, "created_at": "2026-02-09T09:04:31Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T15:57:00Z"}
{"id": "gdn-zibeji", "type": "action", "title": "Add tests for bridge review fixes", "brief": {"why": "Three fixes landed from bridge review (ping/pong handler removal, double folder scan elimination, lobbyQueue error recovery) — existing tests pass but no new tests cover the fixed behaviour. Regressions could reintroduce the double scan or the missing .catch().", "what": "1. Test that stopPingPong removes pong listener (verify no duplicate registration on hypothetical double-start). 2. Test lobbyQueue error recovery — a failing message doesn't kill subsequent messages. 3. Test connectFolder uses cached session object (no second scan).", "done": "bridge-logic.test.ts or bridge integration tests cover all three fixes."}, "status": "done", "parent": "gdn-besuse", "order": 18, "created_at": "2026-02-11T13:57:16Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-15T20:26:05Z"}
{"id": "gdn-zigepu", "type": "outcome", "title": "Vendored pi-web-ui drift surfaces before it bites us", "brief": {"why": "Vendored 6 files from pi-mono are frozen at commit 41c4157b. Mario's upstream changes (bug fixes, improvements) are invisible to us. We want the good stuff, not the sprawl — but first we need to know when things change.", "what": "Git-based drift detection: provenance file in guéridon records commit + file mapping, update-all.sh HEAVY tier diffs our 6 files against upstream/main daily, reports drift in session-start news.", "done": "When Mario changes any of our 6 vendored files in pi-mono, next session start shows which files changed and how much. No drift = silent."}, "status": "done", "order": 5, "created_at": "2026-02-09T14:59:55Z", "created_by": "spm1001", "done_at": "2026-02-09T20:12:31Z"}
{"id": "gdn-zovogo", "type": "outcome", "title": "Bridge folder awareness — scan, enrich, connect", "brief": {"why": "The folder chooser needs to know: which folders exist, which have active/paused/closed sessions, and what each was working on. The bridge is the only actor with filesystem access. No registry — derive all state from CC session files + handoffs + runtime.", "what": "Folder scan module, bridge lobby mode, folder protocol (listFolders/connectFolder), multi-WS broadcast, transport API", "done": "Bridge returns enriched folder list. Multiple tabs can connect to different folders simultaneously. All state derived from filesystem, no registry file."}, "status": "done", "parent": null, "order": 3, "created_at": "2026-02-08T22:12:47Z", "created_by": "spm1001", "done_at": "2026-02-09T07:20:51Z"}
{"id": "gdn-zuhacu", "type": "action", "title": "GueridonInterface syncs pendingToolCalls on tool execution events", "brief": {"why": "handleAssistantComplete emits message_end BEFORE adding to pendingToolCalls. tool_execution_start/end aren't in the subscription handler, so UI only sees stale pendingToolCalls until the next message_end or agent_end.", "what": "1. Add tool_execution_start and tool_execution_end cases to setupSubscription switch in gueridon-interface.ts 2. Each case calls syncState() to push updated pendingToolCalls to the UI 3. Add test in gueridon-interface.test.ts: emit tool_execution_start, verify _pendingToolCalls updated", "done": "Tool spinner appears immediately when tool_execution_start fires, not delayed until next message_end"}, "status": "done", "parent": "gdn-cejaba", "order": 14, "created_at": "2026-02-09T11:10:10Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add tool_execution_start/end to setupSubscription in gueridon-interface.ts", "Add test in gueridon-interface.test.ts"], "current": 2}, "done_at": "2026-02-09T16:18:22Z"}
{"id": "gdn-zusavu", "type": "action", "title": "Commit compaction false positive WIP or branch it", "brief": {"why": "Stashed changes (test + fix for replay→live compaction false positive) are sitting loose in git stash. Easy to lose or forget. The fix resets _lastInputTokens at endReplay() to prevent spurious compaction detection.", "what": "1. Pop stash 2. Review the test and fix 3. Either commit directly (if complete) or create a branch for further work", "done": "Compaction WIP has a permanent home — either committed to main or on a named branch."}, "status": "done", "parent": "gdn-zewumo", "order": 6, "created_at": "2026-02-12T08:07:02Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-12T19:09:48Z"}
