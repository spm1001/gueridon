*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #1a1a1a;
  --surface: #242424;
  --surface-raised: #2a2a2a;
  --border: #333;
  --text: #e8e8e8;
  --text-dim: #777;
  --text-mid: #aaa;
  --accent: #d97757;
  --accent-dim: #B85A35;
  --green: #788c5d;
  --amber: #fbbf24;
  --blue: #6a9bcc;
  --red: #CE3931;
  --radius: 10px;
  --font: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
  --mono: 'SF Mono', Menlo, Consolas, monospace;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

html {
  font-size: 15px;
  overflow-x: hidden;
  /* scroll-snap disabled — fights iOS keyboard animation, causing ghost input area.
     Auto-follow during streaming handled by JS scrollTo in renderMessages. */
  /* scroll-snap-type: y proximity; */
  /* scroll-padding-bottom: calc(100px + env(safe-area-inset-bottom, 0px)); */
}

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  min-height: 100dvh; /* body grows with content — enables Safari Full Page screenshots */
  display: flex;
  flex-direction: column;
  -webkit-font-smoothing: antialiased;
}

/* === Messages === */
/* Body-scroll layout: messages overflow into the document, not a scroll
   container. Safari Full Page screenshots capture document scroll height.
   flex: 1 0 auto = grow to fill, never shrink, content-sized basis.
   (flex: 1 means 1 1 0 — messages can collapse to zero height.) */
.messages {
  flex: 1 0 auto;
  padding: calc(var(--safe-top) + 12px) 14px 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.messages > * { flex-shrink: 0; }

/* Synthetic system chip — centred, dim, informational */
.msg-system {
  align-self: center;
  font-size: 0.75rem;
  color: var(--text-dim);
  font-style: italic;
  padding: 4px 12px;
  max-width: 85%;
}

/* User bubble — cool blue-grey (scheme A) */
.msg-user {
  align-self: flex-end;
  max-width: 85%;
  background: #2a3a4a;
  color: #d4e4f4;
  padding: 9px 14px;
  border-radius: 18px 18px 4px 18px;
  font-size: 0.93rem;
  line-height: 1.4;
}

/* Assistant text — brand orange (scheme A) */
.msg-assistant {
  align-self: flex-start;
  max-width: 92%;
  font-size: 0.93rem;
  padding: 2px 0;
  color: var(--accent);
  line-height: 1.5;
}

/* Markdown in assistant messages */
.msg-assistant p { margin-bottom: 8px; }
.msg-assistant p:last-child { margin-bottom: 0; }
.msg-assistant strong { font-weight: 600; }
.msg-assistant em { font-style: italic; }
.msg-assistant del { text-decoration: line-through; color: var(--text-dim); }
.msg-assistant a { color: var(--blue); text-decoration: underline; }

.msg-assistant h1, .msg-assistant h2, .msg-assistant h3,
.msg-assistant h4, .msg-assistant h5, .msg-assistant h6 {
  font-weight: 600;
  margin: 12px 0 4px;
}
.msg-assistant h1 { font-size: 1.25rem; }
.msg-assistant h2 { font-size: 1.12rem; }
.msg-assistant h3 { font-size: 1.0rem; }
.msg-assistant h4, .msg-assistant h5, .msg-assistant h6 { font-size: 0.93rem; color: var(--text-mid); }

.msg-assistant .task-list { list-style: none; margin-left: 4px; }
.msg-assistant .task-list li::before { content: none; }
.msg-assistant .task-checkbox { margin-right: 6px; }

.msg-assistant code {
  font-family: var(--mono);
  font-size: 0.82rem;
  background: var(--surface-raised);
  padding: 1px 5px;
  border-radius: 4px;
}

.msg-assistant pre {
  position: relative;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 12px;
  margin: 8px 0;
  overflow-x: auto;
  font-size: 0.78rem;
  line-height: 1.4;
  color: var(--text-mid);
}

.msg-assistant pre code {
  background: none;
  padding: 0;
  border-radius: 0;
  font-size: inherit;
}

.code-copy-btn {
  position: absolute;
  top: 4px;
  right: 4px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text-dim);
  font-size: 0.7rem;
  padding: 2px 8px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.15s;
  z-index: 1;
}

.code-copy-btn:active {
  opacity: 1;
  color: var(--accent);
}

.msg-assistant ul, .msg-assistant ol {
  margin: 4px 0 8px 20px;
}

.msg-assistant li { margin-bottom: 2px; }

.msg-assistant table {
  border-collapse: collapse;
  margin: 8px 0;
  font-size: 0.82rem;
  width: 100%;
  color: var(--text-mid);
}

.msg-assistant th, .msg-assistant td {
  border: 1px solid var(--border);
  padding: 4px 8px;
  text-align: left;
}

.msg-assistant th {
  background: var(--surface-raised);
  font-weight: 600;
}

.msg-assistant blockquote {
  border-left: 3px solid var(--text-dim);
  margin: 8px 0;
  padding: 2px 12px;
  color: var(--text-mid);
}

.msg-assistant hr {
  border: none;
  border-top: 1px solid var(--border);
  margin: 12px 0;
}

/* === Tool calls — pill chips === */
.chip-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  align-self: stretch;
}

.chip {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 4px 10px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 0.65rem;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
  transition: border-color 0.15s;
  max-width: 48%;
}

.chip .c-status { font-size: 0.45rem; flex-shrink: 0; }
.chip .c-status.done { color: var(--green); }
.chip .c-status.err { color: var(--red); }
.chip .c-status.run { color: var(--amber); }
.chip .c-name { font-family: var(--mono); color: var(--text-dim); white-space: nowrap; }
.chip .c-path {
  font-family: var(--mono);
  font-size: 0.58rem;
  color: var(--text-dim);
  opacity: 0.4;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 60px;
}

.chip.error { border-color: var(--red); }

/* Running chip — pulsing amber border */
.chip.running {
  border-color: var(--amber);
  animation: pulse-amber 1.5s ease-in-out infinite;
}
@keyframes pulse-amber {
  0%, 100% { border-color: var(--border); }
  50% { border-color: var(--amber); }
}

/* Expanded chip — full width with detail pane */
.chip.expanded {
  flex-basis: 100%;
  max-width: 100%;
  flex-direction: column;
  align-items: flex-start;
  border-radius: 8px;
  padding: 6px 10px;
  gap: 4px;
}

.chip .c-detail {
  position: relative;
  display: none;
  font-family: var(--mono);
  font-size: 0.6rem;
  color: var(--text-dim);
  white-space: pre-wrap;
  max-height: 150px;
  overflow-y: auto;
  width: 100%;
  padding-top: 4px;
  padding-right: 48px;
  border-top: 1px solid var(--border);
}

.chip .c-detail .code-copy-btn {
  position: absolute;
  top: 4px;
  right: 4px;
}

.chip.expanded .c-detail { display: block; }

/* === Local command chip (reuses .chip, overrides for markdown content) === */
.local-cmd-detail {
  white-space: normal;
  font-family: var(--font);
  font-size: 0.75rem;
  max-height: 300px;
}
.local-cmd-detail table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.7rem;
  margin: 6px 0;
}
.local-cmd-detail th, .local-cmd-detail td {
  padding: 3px 6px;
  border-bottom: 1px solid var(--border);
  text-align: left;
}
.local-cmd-detail th {
  color: var(--text-dim);
  font-weight: 600;
}
.local-cmd-detail h2, .local-cmd-detail h3 {
  font-size: 0.75rem;
  margin: 8px 0 4px;
  color: var(--text);
}

/* Stop button font size */
.btn-send[data-stop="true"] {
  font-size: 0.7rem;
}


/* === Input area === */
/* Sticky: stays at viewport bottom while document scrolls.
   will-change: transform promotes to compositor layer, preventing
   sticky flicker during iOS keyboard animation. */
.input-area {
  flex-shrink: 0;
  position: sticky;
  bottom: 0;
  z-index: 10;
  will-change: transform;
  background: var(--surface);
  border-top: 1px solid var(--border);
  padding: 8px 14px calc(var(--safe-bottom) + 4px);
  display: flex;
  flex-direction: column;
  gap: 8px;
}
/* Solid backdrop behind iOS keyboard accessory bar — the predictive text
   strip is translucent and messages bleed through without this.
   Only when keyboard is open — otherwise it adds to scroll height and
   triggers the iOS standalone viewport "docking" slide on initial load. */
.input-area.keyboard-open::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  top: 100%;
  height: 120px;
  background: var(--surface);
}

/* Standalone PWA: adjust safe-area padding when keyboard is open/closed. */
@media (display-mode: standalone) {
  .input-area {
    padding-bottom: max(env(safe-area-inset-bottom, 0px), 4px);
  }
  .input-area.keyboard-open {
    padding-bottom: 4px;
  }
}

.input-field {
  width: 100%;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 9px 14px;
  color: var(--text);
  font-family: var(--font);
  font-size: 16px; /* Prevents Safari auto-zoom on focus */
  resize: none;
  outline: none;
  min-height: 38px;
  max-height: 40dvh;
  overflow-y: auto;
  field-sizing: content;
}

/* Snap sentinel — kept in DOM for future use, snap disabled for now */
.snap-anchor {
  /* scroll-snap-align: end; */
  height: 0;
}

.input-field:focus { border-color: var(--accent-dim); }
.input-field::placeholder { color: var(--text-dim); }

/* Button bar below textarea */
.btn-bar {
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-circle {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  border: none;
  font-size: 1rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
}

.btn-slash, .btn-file {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text-dim);
}
.btn-slash:active, .btn-file:active { background: var(--surface-raised); }

.btn-send {
  background: var(--text-dim);
  color: var(--bg);
  font-size: 1.1rem;
}
.btn-send[data-active="true"] { background: var(--accent); }
.btn-send[data-stop="true"] { background: var(--red); }

.btn-lozenge {
  height: 34px;
  border-radius: 17px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-dim);
  font-family: var(--font);
  font-size: 0.72rem;
  padding: 0 12px;
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  white-space: nowrap;
  overflow: hidden;
}
.btn-lozenge:active { background: var(--surface-raised); }
.btn-lozenge.folder { flex: 1; min-width: 0; }
.btn-lozenge .label { overflow: hidden; text-overflow: ellipsis; }
.btn-lozenge.folder .label:empty::before { content: 'Guéridon'; color: var(--text-dim); }
.btn-lozenge .pct { font-family: var(--mono); font-size: 0.7rem; }
.btn-lozenge.context .pct:empty::before { content: '0%'; color: var(--text-dim); }
.btn-lozenge[data-level="low"] { border-color: var(--amber); color: var(--amber); }
.btn-lozenge[data-level="critical"] { border-color: var(--red); color: var(--red); }

.push-denied {
  font-size: 0.65rem;
  display: none;
  cursor: pointer;
}
.push-denied.visible { display: inline; }

/* Hide non-essential buttons until a folder is connected */
.btn-slash, .btn-file { display: none; }
.btn-slash.visible, .btn-file.visible { display: flex; }

/* CSS-drawn button symbols — geometrically centred, no font metrics */
.btn-file, .btn-slash {
  position: relative;
  font-size: 0;
}
/* + : horizontal bar */
.btn-file::before {
  content: '';
  position: absolute;
  width: 14px; height: 1.5px;
  background: currentColor;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
}
/* + : vertical bar */
.btn-file::after {
  content: '';
  position: absolute;
  width: 1.5px; height: 14px;
  background: currentColor;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
}
/* / : diagonal stroke */
.btn-slash::before {
  content: '';
  position: absolute;
  width: 1.5px; height: 14px;
  background: currentColor;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) rotate(20deg);
}

/* Staged deposit pills — between textarea and button bar */
.staged-deposits {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.staged-deposits:empty { display: none; }

.staged-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 3px 6px 3px 10px;
  font-size: 0.75rem;
  color: var(--text-dim);
  max-width: 200px;
}

.staged-name {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.staged-x {
  background: none;
  border: none;
  color: var(--text-dim);
  font-size: 0.9rem;
  padding: 0 2px;
  cursor: pointer;
  min-width: 24px;
  min-height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Spinner on + button during upload */
.btn-file.uploading {
  position: relative;
  color: transparent;
}
.btn-file.uploading::after {
  content: '';
  position: absolute;
  width: 16px;
  height: 16px;
  border: 2px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: staged-spin 0.6s linear infinite;
}
@keyframes staged-spin {
  to { transform: rotate(360deg); }
}

/* Inline error below textarea, auto-fades */
.staged-error {
  font-size: 0.75rem;
  color: var(--red);
  padding: 2px 0;
  animation: staged-fade 3s forwards;
}
@keyframes staged-fade {
  0%, 80% { opacity: 1; }
  100% { opacity: 0; }
}

/* File reference in user bubbles */
.msg-files {
  font-size: 0.8rem;
  color: var(--text-dim);
  margin-bottom: 4px;
}

/* Slash command sheet */
.slash-sheet-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 100;
}
.slash-sheet-overlay.open { display: block; }

.slash-sheet {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--surface);
  border-radius: 14px 14px 0 0;
  max-height: 60vh;
  display: flex;
  flex-direction: column;
  padding: 12px 0 calc(var(--safe-bottom) + 12px);
}
.slash-sheet-handle {
  width: 36px;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  margin: 0 auto 10px;
  cursor: pointer;
  touch-action: none;
}
.slash-sheet-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px 8px;
  touch-action: none;
}
.slash-sheet-title {
  font-size: 0.8rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.slash-close {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-size: 1.1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.slash-search {
  display: block;
  width: calc(100% - 32px);
  margin: 0 16px 8px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 9px 14px;
  color: var(--text);
  font-family: var(--font);
  font-size: 16px; /* >=16px prevents iOS auto-zoom on focus */
  outline: none;
}
.slash-search:focus { border-color: var(--accent-dim); }
.slash-search::placeholder { color: var(--text-dim); }
#slashList {
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain;
}
.slash-cmd {
  display: flex;
  align-items: baseline;
  gap: 10px;
  padding: 11px 16px;
  cursor: pointer;
}
.slash-cmd:active { background: var(--surface-raised); }
.slash-cmd-name {
  font-family: var(--mono);
  font-size: 0.9rem;
  color: var(--accent);
  white-space: nowrap;
}
.slash-cmd-desc {
  font-size: 0.8rem;
  color: var(--text-dim);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.slash-cmd-local {
  font-size: 0.65rem;
  color: var(--amber);
  background: rgba(245,158,11,0.15);
  padding: 1px 5px;
  border-radius: 3px;
  white-space: nowrap;
}

/* Disconnected state: desaturated + dimmed — clearly "wrong" like Mac deep-sleep resume */
body[data-connection="disconnected"] .messages {
  opacity: 0.5;
  filter: grayscale(0.8);
}

body[data-connection="disconnected"] .input-field {
  opacity: 0.4;
  pointer-events: none;
}

body[data-connection="disconnected"] .btn-send {
  opacity: 0.3;
  pointer-events: none;
}

body[data-connection="disconnected"] .btn-slash,
body[data-connection="disconnected"] .btn-file {
  opacity: 0.3;
  pointer-events: none;
}

/* Thinking chip — coral pulsing border */
.chip.thinking {
  border-color: var(--accent);
  animation: pulse-coral 1.5s ease-in-out infinite;
  color: var(--accent);
}
.chip.thinking .c-name { color: var(--accent); }
@keyframes pulse-coral {
  0%, 100% { border-color: var(--border); opacity: 0.5; }
  50% { border-color: var(--accent); opacity: 1; }
}

/* Completed thinking chip — static coral accent */
.chip.thinking-done {
  border-color: var(--border);
  color: var(--accent);
}
.chip.thinking-done .c-name { color: var(--accent); }
.chip.thinking-done .c-detail {
  color: var(--text-dim);
  line-height: 1.45;
}

/* Writing chip — green pulsing border */
.chip.writing {
  border-color: var(--green);
  animation: pulse-green 1.5s ease-in-out infinite;
  color: var(--green);
}
.chip.writing .c-name { color: var(--green); }
@keyframes pulse-green {
  0%, 100% { border-color: var(--border); opacity: 0.5; }
  50% { border-color: var(--green); opacity: 1; }
}

/* === Session switcher — bottom sheet === */
.switcher-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 99;
  display: none;
  touch-action: manipulation; /* Prevent iOS double-tap-to-zoom */
}

.switcher-backdrop[data-open="true"] {
  display: block;
}

.switcher {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  height: 82vh;
  background: var(--surface);
  border-radius: 14px 14px 0 0;
  z-index: 100;
  display: flex;
  flex-direction: column;
  transform: translateY(100%);
  visibility: hidden;
  transition: transform 0.25s ease, visibility 0s 0.25s;
  overscroll-behavior: none; /* Prevent pull-to-refresh hijacking */
  touch-action: pan-y; /* Allow scroll but prevent other gestures */
}

.switcher[data-open="true"] {
  transform: translateY(0) !important;
  visibility: visible;
  transition: transform 0.25s ease, visibility 0s;
}

.switcher-handle {
  width: 100%;
  padding: 12px 0;
  display: flex;
  justify-content: center;
  cursor: pointer;
  touch-action: none; /* We handle swipe manually */
}

/* Lock body scroll when switcher is open */
body[data-switcher-open] {
  overflow: hidden;
}

.switcher-handle::after {
  content: '';
  width: 36px;
  height: 4px;
  background: var(--text-dim);
  border-radius: 2px;
  opacity: 0.4;
}

.switcher-header {
  padding: 12px 14px 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}

.switcher-search {
  flex: 1;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 9px 14px;
  color: var(--text);
  font-family: var(--font);
  font-size: 16px; /* >=16px prevents iOS auto-zoom on focus */
  outline: none;
}

.switcher-search:focus { border-color: var(--accent-dim); }
.switcher-search::placeholder { color: var(--text-dim); }

.switcher-close {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-size: 1.1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.switcher-list {
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain; /* Don't chain scroll to body when list hits boundary */
  padding: 4px 14px 20px;
}

.switcher-item {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0;
  padding: 12px 10px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
}

.switcher-item:active {
  background: var(--surface);
}

.switcher-item[data-current="true"] {
  background: var(--surface);
  border-radius: 8px;
  border-bottom-color: transparent;
  margin-bottom: 2px;
}

.switcher-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.switcher-dot[data-status="active"] { background: var(--green); }
.switcher-dot[data-status="paused"] { background: var(--amber); }
.switcher-dot[data-status="closed"] { background: var(--text-dim); opacity: 0.5; }
.switcher-dot[data-status="fresh"]  { background: var(--border); }

.switcher-info {
  flex: 1;
  min-width: 0;
}

.switcher-project {
  font-weight: 600;
  font-size: 0.93rem;
}

.switcher-item[data-status="closed"] .switcher-project,
.switcher-item[data-status="fresh"] .switcher-project {
  color: var(--text-dim);
}

.switcher-last-msg {
  color: var(--text-dim);
  font-size: 0.78rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.switcher-meta {
  text-align: right;
  flex-shrink: 0;
}

.switcher-context {
  font-family: var(--mono);
  font-size: 0.72rem;
  color: var(--text-dim);
}

.switcher-context[data-level="low"] { color: var(--amber); }
.switcher-context[data-level="critical"] { color: var(--red); }

.switcher-time {
  font-size: 0.68rem;
  color: var(--text-dim);
}

.switcher-section {
  font-size: 0.68rem;
  font-weight: 600;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 12px 10px 4px;
}

/* -- Session expansion within folder row -- */
.switcher-item-row {
  display: flex;
  align-items: center;
  width: 100%;
  gap: 10px;
}

.switcher-item-body {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
  cursor: pointer;
}

.switcher-chevron {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
  color: var(--text-dim);
  font-size: 0.8rem;
  transition: transform 0.15s ease;
}

.switcher-chevron[data-expanded="true"] {
  transform: rotate(90deg);
}

.switcher-session-count {
  font-family: var(--mono);
  font-size: 0.65rem;
  color: var(--text-dim);
  background: var(--border);
  border-radius: 8px;
  padding: 1px 5px;
  flex-shrink: 0;
}

.switcher-sessions {
  width: 100%;
  padding-left: 28px;
  margin-top: 4px;
}

.switcher-session-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  cursor: pointer;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.switcher-session-row:last-child {
  border-bottom: none;
}

.switcher-session-row:active {
  background: var(--surface);
}

.switcher-session-id {
  font-family: var(--mono);
  font-size: 0.72rem;
  color: var(--text-mid);
  flex: 1;
}

.switcher-session-model {
  font-family: var(--mono);
  font-size: 0.62rem;
  color: var(--text-dim);
}

.switcher-new-session {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 10px;
  cursor: pointer;
  color: var(--accent);
  font-size: 0.78rem;
}

.switcher-new-session:active {
  opacity: 0.7;
}

.switcher-create {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 12px 16px;
  cursor: pointer;
  color: var(--accent);
  font-size: 0.85rem;
  border-top: 1px solid var(--border);
}

.switcher-create:active {
  opacity: 0.7;
}

.switcher-create-icon {
  font-size: 1.1rem;
  font-weight: bold;
}

/* === Drop overlay === */
.drop-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(3px);
  -webkit-backdrop-filter: blur(3px);
  z-index: 300;
  display: none;
  align-items: center;
  justify-content: center;
  pointer-events: none;
}
.drop-overlay.active {
  display: flex;
}
.drop-overlay-label {
  font-size: 1.125rem;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.7);
  padding: 1rem 2rem;
  border: 2px dashed rgba(255, 255, 255, 0.3);
  border-radius: 12px;
}

/* === Ask User overlay — bottom sheet === */
.ask-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  z-index: 200;
  display: none;
  touch-action: manipulation;
}
.ask-backdrop[data-open="true"] { display: block; }

.ask-sheet {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  max-height: 70vh;
  background: var(--surface);
  border-radius: 14px 14px 0 0;
  z-index: 201;
  display: flex;
  flex-direction: column;
  transform: translateY(100%);
  visibility: hidden;
  transition: transform 0.25s ease, visibility 0s 0.25s;
  padding-bottom: env(safe-area-inset-bottom, 0px);
  overscroll-behavior: none;
}
.ask-sheet[data-open="true"] {
  transform: translateY(0);
  visibility: visible;
  transition: transform 0.25s ease, visibility 0s;
}

.ask-handle {
  width: 36px;
  height: 4px;
  background: var(--text-dim);
  border-radius: 2px;
  margin: 8px auto 4px;
  opacity: 0.4;
}

.ask-question {
  padding: 8px 16px 4px;
  font-size: 0.85rem;
  color: var(--text);
  font-weight: 500;
}

.ask-header {
  padding: 0 16px;
  font-size: 0.65rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.ask-options {
  padding: 8px 12px 12px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  overflow-y: auto;
}

.ask-option {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 14px;
  min-height: 44px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
  transition: background 0.1s;
}
.ask-option:active { background: var(--surface-raised); }
.ask-option[data-selected="true"] {
  border-color: var(--accent);
  background: var(--surface-raised);
}

.ask-option-label {
  font-size: 0.85rem;
  color: var(--text);
  font-weight: 500;
}

.ask-option-desc {
  font-size: 0.72rem;
  color: var(--text-dim);
  margin-top: 2px;
}

.ask-option-check {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 2px solid var(--border);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  color: transparent;
}
.ask-option[data-selected="true"] .ask-option-check {
  border-color: var(--accent);
  color: var(--accent);
}

.ask-confirm {
  margin: 4px 12px 8px;
  padding: 12px;
  min-height: 44px;
  background: var(--accent);
  color: var(--bg);
  border: none;
  border-radius: 10px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  display: none;
}
.ask-confirm[data-visible="true"] { display: block; }
.ask-confirm:active { opacity: 0.8; }

.ask-custom {
  padding: 8px 12px 12px;
  text-align: center;
  font-size: 0.72rem;
  color: var(--text-dim);
  cursor: pointer;
}
