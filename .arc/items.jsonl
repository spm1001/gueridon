{"id": "gdn-cejaba", "type": "outcome", "title": "Access Claude Code from mobile with full harness", "brief": {"why": "Claude Code is terminal-only. Full experience (MCPs, CLAUDE.md, skills, tools) needs to be accessible from phone/tablet on home network, using MAX subscription instead of API billing.", "what": "1. ClaudeCodeAgent adapter implementing pi-web-ui Agent interface 2. JSONL event mapper (CC events → pi AgentEvents) 3. Node.js bridge server (WebSocket ↔ stdio) 4. Web app shell with pi-web-ui components 5. Directory picker for session launch 6. Tool execution viewer 7. AskUserQuestion mobile rendering", "done": "Can open browser on phone, pick a project directory, chat with Claude Code, see streaming responses and tool executions, tap AskUserQuestion options, and resume sessions after disconnect"}, "status": "open", "order": 1, "created_at": "2026-02-08T10:31:43Z", "created_by": "spm1001"}
{"id": "gdn-sohadi", "type": "action", "title": "Scaffold project and wire up pi-web-ui", "brief": {"why": "Need working build pipeline before writing adapter code. pi-web-ui packages are on npm, need Vite bundler with Tailwind.", "what": "1. npm init with type:module 2. Install pi-web-ui, pi-agent-core, pi-ai, mini-lit, lit 3. Vite config with Tailwind plugin 4. Minimal index.html + main.ts loading AgentInterface 5. Verify components render", "done": "npm run dev serves a page with pi-web-ui chat interface visible (even if non-functional)"}, "status": "done", "parent": "gdn-cejaba", "order": 1, "created_at": "2026-02-08T10:31:56Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["npm init with type:module", "Install pi-web-ui, pi-agent-core, pi-ai, mini-lit, lit", "Vite config with Tailwind plugin", "Minimal index.html + main.ts loading AgentInterface", "Verify components render"], "current": 5}, "done_at": "2026-02-08T11:10:17Z"}
{"id": "gdn-cawuge", "type": "action", "title": "Context fuel gauge and compaction visibility", "brief": {"why": "Mobile sessions run long without visibility into context usage. Users need a glanceable indicator (not a command to type) and notification when compaction happens, so they can manage session length.", "what": "1. Track usage from CC result events in adapter (input_tokens / contextWindow = percent) 2. Build context gauge component with color thresholds (>70% yellow, >90% red) 3. Detect compaction (input_tokens drop between turns) and surface as notification 4. Use hybrid estimation from pi-mono: last known usage + chars/4 for trailing messages", "done": "Context percentage visible in mobile UI, updates after each turn, yellow/red thresholds work, compaction events shown as notifications"}, "status": "done", "parent": "gdn-cejaba", "order": 2, "created_at": "2026-02-08T10:31:56Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-08T17:57:19Z"}
{"id": "gdn-lenuge", "type": "action", "title": "Build ClaudeCodeAgent adapter", "brief": {"why": "The adapter is the core translation layer between CC stream-json events and pi-web-ui's Agent interface. All context about the Agent contract and event mapping is warm in this session.", "what": "1. Subclass Agent from pi-agent-core 2. Override prompt() to send via transport (WebSocket later) 3. Build CC event handler that translates stream-json events to pi AgentEvents and state changes 4. Wire into main.ts replacing stub Agent 5. Verify ChatPanel still renders with adapter", "done": "ClaudeCodeAgent class exists, handles all CC event types from event-mapping.md, ChatPanel renders with it (non-functional until bridge exists)"}, "status": "done", "parent": "gdn-cejaba", "order": 3, "created_at": "2026-02-08T11:22:57Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Subclass Agent from pi-agent-core", "Override prompt() to send via transport (WebSocket later)", "Build CC event handler that translates stream-json events to pi AgentEvents and state changes", "Wire into main.ts replacing stub Agent", "Verify ChatPanel still renders with adapter"], "current": 5}, "done_at": "2026-02-08T11:25:39Z"}
{"id": "gdn-jiwize", "type": "action", "title": "Build bridge server", "brief": {"why": "The bridge server is what makes the adapter functional — it spawns and manages claude -p processes, pipes stdin/stdout as JSONL, and exposes a WebSocket endpoint for the browser.", "what": "1. Node.js WebSocket server (ws package) 2. Process-per-session: spawn claude -p with required flags on WS connect 3. Pipe WS messages to CC stdin as stream-json input format 4. Parse CC stdout JSONL and forward events over WS 5. Session management: idle timeout, kill, --resume on reconnect 6. Handle process lifecycle (exit, crash, restart)", "done": "Bridge server runs, browser can connect via WS, typing in ChatPanel sends to CC and streamed response renders in the UI"}, "status": "done", "parent": "gdn-cejaba", "order": 4, "created_at": "2026-02-08T17:54:50Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Node.js WebSocket server (ws package)", "Process-per-session: spawn claude -p with required flags on WS connect", "Pipe WS messages to CC stdin as stream-json input format", "Parse CC stdout JSONL and forward events over WS", "Session management: idle timeout, kill, --resume on reconnect", "Handle process lifecycle (exit, crash, restart)"], "current": 6}, "done_at": "2026-02-08T18:17:48Z"}
{"id": "gdn-lihibi", "type": "action", "title": "Build WebSocket transport for browser", "brief": {"why": "The adapter has a CCTransport interface but no implementation. The browser needs a WebSocket client that connects to the bridge and satisfies CCTransport.", "what": "1. Implement CCTransport over WebSocket 2. Auto-reconnect with exponential backoff 3. Wire into ClaudeCodeAgent.connectTransport() in main.ts 4. Connection status indicator in UI", "done": "Browser connects to bridge on page load, messages flow both directions, reconnects after disconnect"}, "status": "done", "parent": "gdn-cejaba", "order": 5, "created_at": "2026-02-08T17:55:00Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Implement CCTransport over WebSocket", "Auto-reconnect with exponential backoff", "Wire into ClaudeCodeAgent.connectTransport() in main.ts", "Connection status indicator in UI"], "current": 4}, "done_at": "2026-02-08T18:41:59Z"}
{"id": "gdn-togeca", "type": "action", "title": "Context fuel gauge component", "brief": {"why": "Mobile sessions run long without visibility. The adapter already tracks context usage from CC result events — need to surface it as a glanceable UI element.", "what": "1. Thin progress bar component using context % from adapter 2. Color thresholds: green default, yellow >70%, red >90% 3. Compaction detection (input_tokens drop) with notification 4. Position near input area for mobile visibility", "done": "Context bar visible in UI, updates after each turn, color changes at thresholds, compaction notified"}, "status": "done", "parent": "gdn-cejaba", "order": 6, "created_at": "2026-02-08T17:55:10Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Thin progress bar component using context % from adapter", "Color thresholds: green default, yellow >70%, red >90%", "Compaction detection (input_tokens drop) with notification", "Position near input area for mobile visibility"], "current": 4}, "done_at": "2026-02-08T19:55:05Z"}
{"id": "gdn-rehona", "type": "action", "title": "Adapter unit tests from verified JSONL", "brief": {"why": "The adapter translates CC stream-json events to pi AgentEvents. We have verified JSONL schemas in docs/empirical-verification.md — feeding them through handleCCEvent() and asserting output catches regressions.", "what": "1. Test framework (vitest) 2. Feed verified JSONL sequences through handleCCEvent 3. Assert resulting pi AgentEvents and state changes 4. Cover: text response, tool use, thinking blocks, error, abort", "done": "Tests pass, cover all event types from empirical-verification.md"}, "status": "done", "parent": "gdn-vevoca", "order": 5, "created_at": "2026-02-08T17:57:48Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Test framework (vitest)", "Feed verified JSONL sequences through handleCCEvent", "Assert resulting pi AgentEvents and state changes", "Cover: text response, tool use, thinking blocks, error, abort"], "current": 4}, "done_at": "2026-02-09T09:31:47Z"}
{"id": "gdn-guruno", "type": "action", "title": "AskUserQuestion mobile interception", "brief": {"why": "In -p mode, AskUserQuestion fires as a tool_use event with full question/options structure BEFORE the error result. Bridge should intercept this, render as tappable buttons on mobile, and send the user's answer as the next message.", "what": "1. Bridge detects tool_use with name AskUserQuestion 2. Forward question/options to browser as a special event 3. Render as tappable button UI (not in chat flow) 4. User tap sends answer as next prompt 5. Coach CC via --append-system-prompt that AskUserQuestion errors are expected", "done": "AskUserQuestion renders as tappable buttons on mobile, user's selection flows back as a message"}, "status": "done", "parent": "gdn-cejaba", "order": 7, "created_at": "2026-02-08T17:57:57Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Bridge detects tool_use with name AskUserQuestion", "Forward question/options to browser as a special event", "Render as tappable button UI (not in chat flow)", "User tap sends answer as next prompt", "Coach CC via --append-system-prompt that AskUserQuestion errors are expected"], "current": 5}, "done_at": "2026-02-08T19:24:07Z"}
{"id": "gdn-celuko", "type": "action", "title": "Resolve artifacts tool mismatch", "brief": {"why": "ChatPanel.setAgent() injects an artifacts tool via toolsFactory. CC doesn't know about this tool — it uses Write for artifacts. The artifacts panel will show UI that doesn't map to CC's capabilities.", "what": "1. Check if CC supports an artifacts-equivalent tool or if Write is the only path 2. If CC handles artifacts differently, map to appropriate UI rendering 3. If no CC artifacts support, remove artifacts tool injection and document why", "done": "Artifacts either render correctly through CC's tool output, or the artifacts path is cleanly removed with a note explaining CC's approach"}, "status": "open", "parent": "gdn-cejaba", "order": 8, "created_at": "2026-02-08T17:58:07Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-gukivo", "type": "action", "title": "Investigate image input via CC stdin content arrays", "brief": {"why": "ChatPanel lets users attach images but adapter strips them to text-only. CC stdin format uses string content — unknown whether content arrays with image blocks work.", "what": "1. Test CC stdin with content array containing image_url block (base64 data URI) 2. If CC accepts it, add image encoding in WSTransport.send() or agent.prompt() 3. Wire paperclip button to file picker → base64 → content array 4. Test round-trip: attach image, verify CC receives and responds to it", "done": "User can tap paperclip, select an image, and CC receives it as input. Response references image content."}, "status": "open", "parent": "gdn-cejaba", "order": 9, "created_at": "2026-02-08T19:04:28Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-hatiho", "type": "outcome", "title": "Sessions feel natural on mobile — open, switch, close without losing work", "brief": {"why": "Mobile sessions currently have no identity (random UUIDs), no closure ritual, and no handoff. When a session dies the next Claude starts blind. Desktop rituals (/open, /close, arc, handoffs) need mobile equivalents so sessions survive the context boundary.", "what": "1. Bridge session registry + folder list endpoint 2. Folder chooser UI with search 3. Deterministic session IDs from folder path 4. Handoff/paused state display in chooser 5. Resume flow (paused → unfreeze, closed → fresh with handoff) 6. New folder creation with fun names 7. Mobile /close trigger 8. Closure nudge from fuel gauge", "done": "User can pick a folder, resume where they left off, get nudged to close when context is full, and the next session in that folder picks up the handoff"}, "status": "open", "order": 2, "created_at": "2026-02-08T19:50:33Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-pahawu", "type": "action", "title": "Code-split heavy deps for mobile data", "brief": {"why": "Bundle is 4.7MB (1.2MB gzip) — fine on WiFi but painful on mobile data. KaTeX, PDF.js, highlight.js are only needed when CC sends math/docs/code.", "what": "1. Audit pi-web-ui imports for lazy-loadable chunks 2. Dynamic import() for KaTeX, PDF.js, highlight.js on first use 3. Consider service worker for offline cache", "done": "First load under 500KB gzip on fresh cache. Heavy deps load on demand."}, "status": "done", "parent": "gdn-cejaba", "order": 10, "created_at": "2026-02-08T21:35:36Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T15:46:38Z"}
{"id": "gdn-zovogo", "type": "outcome", "title": "Bridge folder awareness — scan, enrich, connect", "brief": {"why": "The folder chooser needs to know: which folders exist, which have active/paused/closed sessions, and what each was working on. The bridge is the only actor with filesystem access. No registry — derive all state from CC session files + handoffs + runtime.", "what": "Folder scan module, bridge lobby mode, folder protocol (listFolders/connectFolder), multi-WS broadcast, transport API", "done": "Bridge returns enriched folder list. Multiple tabs can connect to different folders simultaneously. All state derived from filesystem, no registry file."}, "status": "done", "parent": null, "order": 3, "created_at": "2026-02-08T22:12:47Z", "created_by": "spm1001", "done_at": "2026-02-09T07:20:51Z"}
{"id": "gdn-sinefu", "type": "action", "title": "Folder chooser UI with search and session states", "brief": {"why": "User needs to pick a folder before chatting. With tens of repos, a flat list isn't enough — needs search/filter. Each folder shows its session state (active/paused/closed/fresh) so the user knows what they're getting into.", "what": "1. Full-screen chooser shown before chat (replaces empty chat on first load) 2. Scrollable list of folders from bridge API 3. Search/filter input at top (filters as you type) 4. Visual states: green dot (active), amber dot (paused + time ago), handoff purpose line (closed), plain (fresh) 5. 'New folder' option at top with fun auto-generated name 6. Selecting a folder transitions to chat view with CWD in gauge", "done": "Can scroll through 30+ folders, search narrows list instantly, all four states render distinctly, selecting transitions to chat."}, "status": "done", "parent": "gdn-hatiho", "order": 1, "created_at": "2026-02-08T22:12:57Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Full-screen chooser shown before chat (replaces empty chat on first load)", "Scrollable list of folders from bridge API", "Search/filter input at top (filters as you type)", "Visual states: green dot (active), amber dot (paused + time ago), handoff purpose line (closed), plain (fresh)", "'New folder' option at top with fun auto-generated name", "Selecting a folder transitions to chat view with CWD in gauge"], "current": 6}, "done_at": "2026-02-09T07:34:12Z"}
{"id": "gdn-neperu", "type": "action", "title": "Deterministic session IDs and resume flow", "brief": {"why": "Currently session IDs are random UUIDs — picking a folder can't find its session. Folder path must deterministically produce a session ID so resume works. The three resume paths (active/paused/closed) each behave differently.", "what": "1. Define deterministic session ID derivation from folder path (e.g. hash or encoded path) 2. Update bridge-logic.ts resolveSessionForFolder to use deterministic IDs 3. Update bridge.ts connectFolder to look up by derived ID 4. Verify resume flow: active → reconnect, paused → resume, closed → fresh session with new ID", "done": "Same folder always produces same session ID. Reconnecting to an active session works. Resuming a paused session works. Closed sessions start fresh."}, "status": "open", "parent": "gdn-hatiho", "order": 2, "created_at": "2026-02-08T22:13:07Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-cahato", "type": "action", "title": "New folder creation with fun names", "brief": {"why": "Sometimes you start fresh — new project, new experiment. 'New folder' creates ~/Repos/<name>, git inits it, and starts a session there. Auto-naming removes friction and adds character.", "what": "1. Add 'New folder' option to folder selector 2. Generate fun name (adjective-noun, alliterative, or similar) 3. mkdir ~/Repos/<name> && git init 4. Connect to new folder automatically", "done": "Tapping 'New folder' creates a git-initialised directory with a fun auto-generated name and starts a session in it."}, "status": "open", "parent": "gdn-hatiho", "order": 3, "created_at": "2026-02-08T22:13:16Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-cofuci", "type": "action", "title": "Mobile close trigger and closure nudge", "brief": {"why": "Desktop /close is typed. Mobile needs a tap-friendly equivalent. The fuel gauge already tracks context — when it hits amber/red, nudge the user to wrap up rather than letting the session die ungracefully.", "what": "1. Add close/wrap-up button in UI (perhaps in gauge area when amber/red) 2. On tap, send a close-session prompt to CC (e.g. '/close' or structured close request) 3. When gauge hits amber, show nudge toast: 'Context getting low — consider wrapping up' 4. On explicit close, write handoff and return to lobby", "done": "User can tap to close a session. Amber gauge shows closure nudge. Closing writes a handoff and returns to folder list."}, "status": "open", "parent": "gdn-hatiho", "order": 4, "created_at": "2026-02-08T22:13:27Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-laneve", "type": "action", "title": "Verify double-render fix visually", "brief": {"why": "Patched AgentInterface to clear streaming container on message_end (not just agent_end) to fix duplicate message display. Committed but never tested live.", "what": "1. Start bridge + dev server 2. Send a multi-turn conversation 3. Watch for duplicate messages during turn transitions 4. Verify streaming container clears when message completes", "done": "No visible duplicate messages during streaming→complete transition across 3+ turns."}, "status": "done", "parent": "gdn-cejaba", "order": 11, "created_at": "2026-02-08T22:19:14Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Start bridge + dev server", "Send a multi-turn conversation", "Watch for duplicate messages during turn transitions", "Verify streaming container clears when message completes"], "current": 4}, "done_at": "2026-02-08T22:45:12Z"}
{"id": "gdn-murimo", "type": "action", "title": "Trim desktop chrome for mobile — keep useful controls", "brief": {"why": "Pi-web-ui's button row has desktop-oriented controls (thinking toggle, model selector, attachment button, Anthropic logo) that eat vertical space on mobile. Some are useful to wire up (attachment for image input?), model selector is irrelevant (CC handles model selection server-side).", "what": "1. Audit which pi-web-ui button-row controls are still relevant after owning the shell 2. Remove irrelevant controls (model selector, Anthropic logo) 3. Keep/adapt useful ones (attachment → paperclip already exists) 4. Ensure input area is optimised for mobile viewport", "done": "Input area uses only mobile-relevant controls. No desktop-only chrome consuming vertical space."}, "status": "open", "parent": "gdn-cejaba", "order": 12, "created_at": "2026-02-08T22:19:25Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-fuhola", "type": "action", "title": "Folder scan module with filesystem state derivation", "brief": {"why": "The bridge needs to enumerate ~/Repos/ folders and determine each one's session state (active/paused/closed/fresh) without maintaining a registry. CC already stores session files at ~/.claude/projects/<encoded>/ and handoffs at ~/.claude/handoffs/<encoded>/.", "what": "1. Create server/folders.ts with encodePath(), getLatestSession(), getLatestHandoff(), scanFolders() 2. Scan ~/Repos/ dirs, stat each for type 3. For each: check CC projects dir for .jsonl files (paused), check handoffs for .md files (closed) 4. State logic: active from runtime map, paused wins over closed, fresh if neither 5. Sort: active > paused > closed > fresh 6. Test standalone with a script that logs the enriched list", "done": "scanFolders() returns correct state for guéridon (paused), a fresh repo (fresh), and folders with handoffs (closed). Standalone test script verifies."}, "status": "done", "parent": "gdn-zovogo", "order": 1, "created_at": "2026-02-09T06:15:11Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create server/folders.ts with encodePath(), getLatestSession(), getLatestHandoff(), scanFolders()", "Scan ~/Repos/ dirs, stat each for type", "For each: check CC projects dir for .jsonl files (paused), check handoffs for .md files (closed)", "State logic: active from runtime map, paused wins over closed, fresh if neither", "Sort: active > paused > closed > fresh", "Test standalone with a script that logs the enriched list"], "current": 6}, "done_at": "2026-02-09T06:17:17Z"}
{"id": "gdn-nasahe", "type": "action", "title": "Bridge lobby mode and folder protocol", "brief": {"why": "Currently every WS connection immediately creates a session. The folder chooser needs a pre-session 'lobby' where the browser can list folders and pick one before any CC process is spawned.", "what": "1. Add folder field to Session interface 2. WS connects without ?session= enters lobby mode (no session created) 3. Handle listFolders message — call scanFolders(), return folderList response 4. Handle connectFolder message — create/resume session for chosen folder, send connected with sessionId 5. Reject prompt/abort in lobby mode with error 6. Existing ?session= path unchanged for backwards compat", "done": "WS can connect, send listFolders, get enriched list back, send connectFolder, get session. Prompt before connectFolder returns error. Old ?session= flow still works."}, "status": "done", "parent": "gdn-zovogo", "order": 2, "created_at": "2026-02-09T06:15:19Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add folder field to Session interface", "WS connects without ?session= enters lobby mode (no session created)", "Handle listFolders message — call scanFolders(), return folderList response", "Handle connectFolder message — create/resume session for chosen folder, send connected with sessionId", "Reject prompt/abort in lobby mode with error", "Existing ?session= path unchanged for backwards compat"], "current": 6}, "done_at": "2026-02-09T06:51:15Z"}
{"id": "gdn-figina", "type": "action", "title": "Multi-WS sessions with broadcast", "brief": {"why": "Multiple browser tabs can connect to the same folder. They should share a CC process and all receive events. Currently Session.ws is a single WebSocket.", "what": "1. Change Session.ws from WebSocket|null to Set<WebSocket> 2. Add reverse map ws→sessionId for disconnect lookups 3. All sendToClient calls become broadcast to Set 4. Idle timer starts when Set empties (all tabs gone) 5. Ping/pong remains per-WebSocket 6. connectFolder checks activeByFolder — if session exists, join it", "done": "Two WS connections to same folder share one CC process. Both receive streamed events. Disconnecting one doesn't kill the session. Disconnecting both starts idle timer."}, "status": "done", "parent": "gdn-zovogo", "order": 3, "created_at": "2026-02-09T06:15:26Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Change Session.ws from WebSocket|null to Set<WebSocket>", "Add reverse map ws→sessionId for disconnect lookups", "All sendToClient calls become broadcast to Set", "Idle timer starts when Set empties (all tabs gone)", "Ping/pong remains per-WebSocket", "connectFolder checks activeByFolder — if session exists, join it"], "current": 6}, "done_at": "2026-02-09T07:17:19Z"}
{"id": "gdn-likira", "type": "action", "title": "Transport folder API and lobby handling", "brief": {"why": "The browser-side WSTransport needs methods to request the folder list and connect to a folder. It also needs to handle the lobby state where no session exists yet.", "what": "1. Add listFolders() and connectFolder(path) methods to WSTransport 2. Add onFolderList callback in options 3. Handle folderList message type in handleMessage 4. Handle connected with null sessionId (lobby mode) — don't fire onSessionId until connectFolder completes 5. Update docs/bridge-protocol.md with new message types and lobby flow", "done": "Transport can request folder list and receive it via callback. connectFolder triggers session establishment. Protocol docs updated."}, "status": "done", "parent": "gdn-zovogo", "order": 4, "created_at": "2026-02-09T06:15:34Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add listFolders() and connectFolder(path) methods to WSTransport", "Add onFolderList callback in options", "Handle folderList message type in handleMessage", "Handle connected with null sessionId (lobby mode) — don't fire onSessionId until connectFolder completes", "Update docs/bridge-protocol.md with new message types and lobby flow"], "current": 5}, "done_at": "2026-02-09T07:19:52Z"}
{"id": "gdn-hemute", "type": "action", "title": "Integration test for listFolders protocol", "brief": {"why": "The folder list API (listFolders/folderList) needs an integration test that verifies the WS protocol end-to-end. Currently test-bridge.ts covers prompt/abort but nothing folder-related.", "what": "1. Add listFolders test to scripts/test-bridge.ts (or new script) 2. Connect WS without ?session= (lobby mode) 3. Send listFolders, verify folderList response shape 4. Verify known folders appear with correct states 5. Send connectFolder, verify connected response with sessionId", "done": "Test script passes: connects, lists folders, gets enriched list back, connects to a folder. Can run against live bridge."}, "status": "done", "parent": "gdn-zovogo", "order": 5, "created_at": "2026-02-09T06:22:37Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T07:20:15Z"}
{"id": "gdn-vevoca", "type": "outcome", "title": "Automated test coverage for guéridon", "brief": {"why": "Zero test framework, zero automated tests. The adapter (most protocol-sensitive code) has no tests. As bridge refactor and folder chooser add complexity, regressions will compound silently.", "what": "Vitest framework setup, adapter unit tests (from verified JSONL fixtures), folder scan tests (mocked fs), transport tests (mock WebSocket), gauge tests, eventually bridge SessionManager extraction", "done": "npm test runs vitest. Adapter and folder scan have >80% coverage. CI-ready (no manual steps, no running servers needed)."}, "status": "done", "order": 4, "created_at": "2026-02-09T06:38:30Z", "created_by": "spm1001", "done_at": "2026-02-09T09:55:27Z"}
{"id": "gdn-womabe", "type": "action", "title": "Set up vitest framework and npm test scripts", "brief": {"why": "No test framework exists. Need vitest (reuses vite.config.ts aliases and esbuild target), npm scripts, and basic config before any tests can be written.", "what": "1. npm install -D vitest 2. Add test and test:watch scripts to package.json 3. Verify vitest inherits vite.config.ts (pi-web-ui alias, es2020 target) 4. Write one trivial test (encodePath) to confirm setup works 5. Add jsdom devDep for future browser-side tests", "done": "npm test runs and passes. vitest picks up vite.config.ts aliases. One test exists and passes."}, "status": "done", "parent": "gdn-vevoca", "order": 1, "created_at": "2026-02-09T06:38:40Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["npm install -D vitest", "Add test and test:watch scripts to package.json", "Verify vitest inherits vite.config.ts (pi-web-ui alias, es2020 target)", "Write one trivial test (encodePath) to confirm setup works", "Add jsdom devDep for future browser-side tests"], "current": 5}, "done_at": "2026-02-09T09:20:14Z"}
{"id": "gdn-muloda", "type": "action", "title": "Folder scan unit tests with mocked fs", "brief": {"why": "server/folders.ts has pure functions and mockable fs calls — high value, low effort. The regex-based handoff parsing is fragile and untested against edge cases.", "what": "1. Create server/folders.test.ts 2. Test encodePath edge cases (slashes, dots, spaces, root) 3. Test getLatestSession with vi.mock('node:fs/promises') — ENOENT, empty dir, picks newest, ignores non-jsonl 4. Test getLatestHandoff — well-formed, malformed, missing dir 5. Test scanFolders — state derivation for all four states, sort order, hidden dirs skipped, activeProcesses map", "done": "All tests pass. Covers encodePath, getLatestSession, getLatestHandoff, scanFolders with mocked filesystem."}, "status": "done", "parent": "gdn-vevoca", "order": 2, "created_at": "2026-02-09T06:38:47Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create server/folders.test.ts", "Test encodePath edge cases (slashes, dots, spaces, root)", "Test getLatestSession with vi.mock('node:fs/promises') — ENOENT, empty dir, picks newest, ignores non-jsonl", "Test getLatestHandoff — well-formed, malformed, missing dir", "Test scanFolders — state derivation for all four states, sort order, hidden dirs skipped, activeProcesses map"], "current": 5}, "done_at": "2026-02-09T09:24:47Z"}
{"id": "gdn-wisupe", "type": "action", "title": "Transport unit tests with mock WebSocket", "brief": {"why": "ws-transport.ts handles protocol discrimination, reconnect backoff, and prompt timeout — all testable with mock WebSocket and fake timers. Medium effort but catches real bugs (e.g. processExit not synthesizing result event).", "what": "1. Create src/ws-transport.test.ts 2. Stub global WebSocket with controllable mock 3. Test message dispatch (bridge vs cc source) 4. Test reconnect backoff (1s, 2s, 4s... 30s cap) with fake timers 5. Test prompt timeout (fires after 10s, clears on promptReceived) 6. Test processExit → synthetic result event", "done": "All tests pass with fake timers and mock WebSocket. No real connections needed."}, "status": "done", "parent": "gdn-vevoca", "order": 3, "created_at": "2026-02-09T06:38:56Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create src/ws-transport.test.ts", "Stub global WebSocket with controllable mock", "Test message dispatch (bridge vs cc source)", "Test reconnect backoff (1s, 2s, 4s... 30s cap) with fake timers", "Test prompt timeout (fires after 10s, clears on promptReceived)", "Test processExit → synthetic result event"], "current": 6}, "done_at": "2026-02-09T09:41:13Z"}
{"id": "gdn-taleta", "type": "action", "title": "Context gauge unit tests", "brief": {"why": "context-gauge.ts has clean public API (update, setCwd, notifyCompaction, renderStats) and colour threshold logic that's never been verified.", "what": "1. Create src/context-gauge.test.ts with jsdom environment 2. Test colour thresholds (green >20%, amber 10-20%, red <10%) 3. Test CWD shortening (full path → folder name) 4. Test notifyCompaction toast timing with fake timers 5. Test renderStats returns valid Lit templates", "done": "All tests pass. Colour bands verified. Compaction toast appears and auto-dismisses."}, "status": "done", "parent": "gdn-vevoca", "order": 4, "created_at": "2026-02-09T06:39:04Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T09:41:27Z"}
{"id": "gdn-mazeni", "type": "action", "title": "Folder selector dialog replaces model chooser", "brief": {"why": "pi-web-ui orchestration layer (ChatPanel, AgentInterface, MessageEditor) is full of abstractions we don't need (model selector, thinking level, cost tracking) and blocks input area customisation. Own the orchestration, consume the rendering (MessageList, StreamingMessageContainer) — the seam is clean (12 props + 1 imperative method).", "what": "1. Write GueridonInterface skeleton — Lit component rendering message-list + streaming-container + basic textarea, event translation loop, replace ChatPanel in main.ts 2. Build custom input bar — image upload placeholder, folder button with CWD display (truncated), inline context gauge %, send/abort button 3. Write FolderSelector dialog — centered modal with search and state dots, reuse folder-chooser rendering 4. Wire folder button to dialog to transport, auto-open on first load 5. Move connection status below chat input 6. Remove old code — ChatPanel/AppStorage setup, context-gauge.ts, full-screen folder-chooser.ts", "done": "GueridonInterface renders messages correctly. Custom input bar has folder button + gauge + send. Folder dialog opens from button and auto-opens on first load. Connection status at bottom. No ChatPanel/AgentInterface/MessageEditor dependency. No as-any casts for customStats."}, "status": "done", "parent": "gdn-hatiho", "order": 5, "created_at": "2026-02-09T07:54:25Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Write GueridonInterface skeleton — Lit component rendering message-list + streaming-container + basic textarea, event translation loop, replace ChatPanel in main.ts", "Build custom input bar — image upload placeholder, folder button with CWD display (truncated), inline context gauge %, send/abort button", "Write FolderSelector dialog — centered modal with search and state dots, reuse folder-chooser rendering", "Wire folder button to dialog to transport, auto-open on first load", "Move connection status below chat input", "Remove old code — ChatPanel/AppStorage setup, context-gauge.ts, full-screen folder-chooser.ts"], "current": 6}, "done_at": "2026-02-09T08:38:20Z"}
{"id": "gdn-kurato", "type": "action", "title": "State derivation unit test — closed wins over paused", "brief": {"why": "The closed-wins-over-paused logic and resume guard are regression-prone. Someone reading the code might think 'paused should win' without understanding session files persist forever. The resume bug (resuming closed sessions) was found by the user in live use.", "what": "1. Mock fs for folders with: both session+handoff (closed), session only (paused), handoff only (closed), neither (fresh) 2. Assert state derivation correctness 3. Test connectFolder: closed folder gets fresh UUID, paused folder reuses session ID", "done": "Tests cover all state derivation paths and the resume guard. Regression on closed-wins-over-paused would fail a test."}, "status": "done", "parent": "gdn-vevoca", "order": 6, "created_at": "2026-02-09T08:03:34Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T09:43:56Z"}
{"id": "gdn-zibaha", "type": "action", "title": "Folder dialog opens then immediately closes", "brief": {"why": "Dialog flashes then disappears on page load. onSessionId fires right after onFolderList, closing the dialog before user can interact. CWD shows itv-linkedin-analytics without user selection — something is auto-connecting.", "what": "1. Reproduce: open app, observe dialog flash 2. Add event sequence logging to identify which callback closes the dialog 3. If root cause is same as gdn-jebudo, mark as duplicate 4. If different, fix the specific trigger", "done": "Dialog stays open on fresh page load until user selects a folder. No flash."}, "status": "done", "parent": "gdn-hatiho", "order": 6, "created_at": "2026-02-09T09:04:31Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T15:57:00Z"}
{"id": "gdn-dacega", "type": "action", "title": "Build test catches transitive dependency failures", "brief": {"why": "npm run build would have caught the @smithy import failure from session 3. Currently no build-time test exists — transitive dependency issues only surface when someone manually runs a production build.", "what": "1. Add a vitest test that runs npm run build and asserts exit code 0 2. Consider adding to a pre-commit hook or CI", "done": "npm test includes a build check. Transitive import failures are caught automatically."}, "status": "done", "parent": "gdn-vevoca", "order": 7, "created_at": "2026-02-09T09:44:44Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add a vitest test that runs npm run build and asserts exit code 0", "Consider adding to a pre-commit hook or CI"], "current": 2}, "done_at": "2026-02-09T09:55:09Z"}
{"id": "gdn-jimozo", "type": "action", "title": "End-to-end adapter sequence test", "brief": {"why": "Individual event handlers are tested but the full composition isn't. A prompt→stream→tool_use→tool_result→text_response→result sequence through handleCCEvent would catch ordering bugs and state leaks between phases.", "what": "1. Create a test that feeds a complete multi-turn CC event sequence 2. Assert intermediate state at each phase (isStreaming, pendingToolCalls, messages array) 3. Cover: text-only turn, tool-use turn, AskUserQuestion turn", "done": "At least one full-sequence test exercises the adapter from prompt to result, verifying state at each transition."}, "status": "done", "parent": "gdn-vevoca", "order": 8, "created_at": "2026-02-09T09:44:52Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Create a test that feeds a complete multi-turn CC event sequence", "Assert intermediate state at each phase (isStreaming, pendingToolCalls, messages array)", "Cover: text-only turn, tool-use turn, AskUserQuestion turn"], "current": 3}, "done_at": "2026-02-09T09:55:18Z"}
{"id": "gdn-judonu", "type": "action", "title": "Export adapter pure helpers to eliminate as-any test casts", "brief": {"why": "49 adapter tests access mapContentBlocks/mapUsage/mapStopReason via (agent as any). TypeScript can't see through the cast — rename a method and tests break at runtime with 'undefined is not a function' instead of a compile error.", "what": "1. Extract mapContentBlocks, mapUsage, mapStopReason, emptyUsage as exported pure functions (not class methods) 2. Update ClaudeCodeAgent to call the exported functions 3. Update 49 tests to import functions directly instead of (agent as any).methodName 4. Verify all tests pass with no as-any casts on these helpers", "done": "Zero as-any casts for adapter helper access in test files. Renaming a helper function causes a compile error, not a runtime mystery."}, "status": "open", "parent": "gdn-cejaba", "order": 13, "created_at": "2026-02-09T10:15:08Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-geduzo", "type": "action", "title": "Lit component smoke tests for GueridonInterface", "brief": {"why": "Nothing tests that the UI actually renders. A future Claude could break prop passing to message-list or streaming-message-container and every test would pass green. jsdom is already installed but unused.", "what": "1. Set up Lit test helpers with jsdom environment in vitest 2. Test GueridonInterface: create element, feed a text CC event sequence, assert assistant-message element exists in DOM 3. Test connection status rendering (connected/disconnected) 4. Test error state rendering", "done": "At least one test creates GueridonInterface in jsdom and verifies rendered output after feeding CC events. Catches wiring bugs between adapter state and Lit templates."}, "status": "done", "parent": "gdn-cejaba", "order": 14, "created_at": "2026-02-09T10:15:18Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Set up Lit test helpers with jsdom environment in vitest", "Test GueridonInterface: create element, feed a text CC event sequence, assert assistant-message element exists in DOM", "Test connection status rendering (connected/disconnected)", "Test error state rendering"], "current": 4}, "done_at": "2026-02-09T10:39:19Z"}
{"id": "gdn-pefeva", "type": "action", "title": "Extract bridge IO handlers for testability", "brief": {"why": "handleSessionMessage, handleLobbyMessage, wireProcessToSession are untestable because importing bridge.ts starts a WebSocketServer. The bridge-logic.ts extraction covered pure functions but the IO routing logic — which is where session lifecycle bugs live — still has no tests.", "what": "1. Wrap WebSocketServer creation in bridge.ts behind a factory or lazy init (so import doesn't start server) 2. Extract handleSessionMessage and handleLobbyMessage to accept session/conn as args 3. Write unit tests for lobby→session transition, prompt routing, error on wrong-mode messages 4. Test lobbyQueue error propagation (.catch on chain)", "done": "bridge.ts can be imported in tests without starting a server. handleSessionMessage and handleLobbyMessage have unit tests covering the routing and error paths."}, "status": "open", "parent": "gdn-cejaba", "order": 15, "created_at": "2026-02-09T10:15:24Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-zuhacu", "type": "action", "title": "GueridonInterface syncs pendingToolCalls on tool execution events", "brief": {"why": "handleAssistantComplete emits message_end BEFORE adding to pendingToolCalls. tool_execution_start/end aren't in the subscription handler, so UI only sees stale pendingToolCalls until the next message_end or agent_end.", "what": "1. Add tool_execution_start and tool_execution_end cases to setupSubscription switch in gueridon-interface.ts 2. Each case calls syncState() to push updated pendingToolCalls to the UI 3. Add test in gueridon-interface.test.ts: emit tool_execution_start, verify _pendingToolCalls updated", "done": "Tool spinner appears immediately when tool_execution_start fires, not delayed until next message_end"}, "status": "done", "parent": "gdn-cejaba", "order": 16, "created_at": "2026-02-09T11:10:10Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add tool_execution_start/end to setupSubscription in gueridon-interface.ts", "Add test in gueridon-interface.test.ts"], "current": 2}, "done_at": "2026-02-09T16:18:22Z"}
{"id": "gdn-kopiki", "type": "action", "title": "pi-web-ui element dependency tree is mapped and all needed elements registered", "brief": {"why": "MessageList renders <user-message>, <assistant-message> etc. as custom elements. Each may render further elements (e.g. <markdown-block>). If ANY element in the chain isn't imported/registered, content is invisible. Currently playing whack-a-mole with missing registrations.", "what": "1. Grep all @customElement and customElements.define in pi-mono/packages/web-ui/src 2. Build dependency tree: which elements create which other elements in their render() 3. Import all needed elements in gueridon-interface.ts (or a dedicated registrations file) 4. Verify with browser DevTools that all elements upgrade", "done": "Send a message in browser, user bubble appears with text, assistant response streams and renders"}, "status": "done", "parent": "gdn-cejaba", "order": 17, "created_at": "2026-02-09T13:35:29Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Grep all @customElement and customElements.define in pi-mono/packages/web-ui/src", "Build dependency tree: which elements create which other elements in their render()", "Import all needed elements in gueridon-interface.ts (or a dedicated registrations file)", "Verify with browser DevTools that all elements upgrade"], "current": 4}, "done_at": "2026-02-09T14:42:23Z"}
{"id": "gdn-rizaje", "type": "action", "title": "Visual smoke test before code archaeology", "brief": {"why": "This session spent significant context reading DialogBase/Dialog/bridge source for the flash bug before ever loading the app in a browser. A 2-minute visual check would have revealed 3 issues (layout, close button, blank messages) instantly. Pattern: eyes before brain.", "what": "1. Add a visual smoke test checklist to CLAUDE.md or docs/: start servers, open browser, check layout, send message, verify bubble appears 2. Make this the first step in any UI-related arc action", "done": "Checklist exists, referenced in CLAUDE.md, next Claude follows it"}, "status": "done", "parent": "gdn-cejaba", "order": 18, "created_at": "2026-02-09T13:35:38Z", "created_by": "spm1001", "waiting_for": null, "done_at": "2026-02-09T15:46:40Z"}
{"id": "gdn-zigepu", "type": "outcome", "title": "Vendored container prop contract test", "brief": {"why": "Vendored MessageList/StreamingMessageContainer have implicit prop interface. Upstream changes silently break us. Need a test that imports upstream types and asserts our vendored files match.", "what": "1. Create src/vendor/contract.test.ts 2. Import upstream MessageList and StreamingMessageContainer type definitions from pi-agent-core or pi-web-ui types 3. Assert our vendored versions accept the same props (messages, tools, pendingToolCalls, isStreaming, toolResultsById, setMessage) 4. Test renders with sample data to catch runtime breaks", "done": "A type-level and runtime contract test that fails when vendored props diverge from upstream expectations"}, "status": "open", "order": 5, "created_at": "2026-02-09T14:59:55Z", "created_by": "spm1001"}
{"id": "gdn-jebudo", "type": "outcome", "title": "Folder dialog flash — find and fix root cause", "brief": {"why": "Dialog flashes open then immediately closes on page load. onSessionId fires right after onFolderList, closing the dialog before user can interact. Guarded with pendingFolderConnect flag (symptom suppressed) but root cause unknown. console.trace debug instrumentation still in folder-selector.ts.", "what": "1. Add instrumentation logging to trace exact sequence: WS open → lobbyConnected → folderList → connectFolder → connected → onSessionId 2. Reproduce the flash by opening the app fresh 3. Identify which event fires the spurious dialog close 4. Fix root cause (likely: remove the guard, fix the event ordering) 5. Remove console.trace debug instrumentation from folder-selector.ts", "done": "Opening the app shows folder dialog and it stays open until user selects. No flash. console.trace removed."}, "status": "done", "order": 6, "created_at": "2026-02-09T15:00:04Z", "created_by": "spm1001", "done_at": "2026-02-09T16:49:21Z"}
{"id": "gdn-dozosa", "type": "outcome", "title": "returnToLobby unit test in ws-transport.test.ts", "brief": {"why": "returnToLobby had a WS onclose race that created duplicate connections. Fixed by detaching handlers before close. Without a test, this could regress.", "what": "Add test: returnToLobby detaches old WS handlers, creates single new connection, deferred connectFolder fires on lobby", "done": "ws-transport.test.ts covers returnToLobby lifecycle including handler detach"}, "status": "done", "order": 7, "created_at": "2026-02-09T15:00:11Z", "created_by": "spm1001", "done_at": "2026-02-09T15:46:40Z"}
{"id": "gdn-walaco", "type": "action", "title": "Agent state resets cleanly on folder switch", "brief": {"why": "Singleton ClaudeCodeAgent accumulates messages, toolCallNames, context tokens across folder changes. Old session messages render in new session.", "what": "1. Add reset() method to ClaudeCodeAgent that clears messages, toolCallNames, askUserToolCallIds, usage, state 2. Call reset() in main.ts connectFolder callback before starting new session 3. Test: switch folders, verify no stale messages or token counts", "done": "Switching folders shows clean slate — no messages, no stale gauge, no accumulated tool state from previous session"}, "status": "done", "parent": "gdn-cejaba", "order": 19, "created_at": "2026-02-09T15:46:51Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add reset() method to ClaudeCodeAgent", "Call reset() in main.ts connectFolder callback", "Add tests for reset()", "Verify no stale state after folder switch"], "current": 4}, "done_at": "2026-02-09T16:16:12Z"}
{"id": "gdn-vosejo", "type": "action", "title": "prompt() guards against null transport", "brief": {"why": "If transport is null when prompt() called, user message is added to state and streaming set to true, but message silently dropped. UI stuck in streaming state forever.", "what": "1. Guard prompt() — if no transport, show error toast and return early without setting streaming=true 2. Add test case in claude-code-agent.test.ts", "done": "Calling prompt() without transport shows error to user, does not enter streaming state"}, "status": "done", "parent": "gdn-cejaba", "order": 20, "created_at": "2026-02-09T15:46:54Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Guard prompt() — return early with error if no transport", "Add test case"], "current": 2}, "done_at": "2026-02-09T16:16:49Z"}
{"id": "gdn-pudaco", "type": "action", "title": "Unknown CC event types logged, not silently dropped", "brief": {"why": "No default case in handleCCEvent or handleStreamEvent. When CC adds new event types, they vanish without trace. Makes debugging schema drift impossible.", "what": "1. Add default case to handleCCEvent with console.debug for unknown types 2. Add default case to handleStreamEvent 3. Add test: unknown event type emits debug log, doesn't throw", "done": "Unknown CC event types produce console.debug with event type and payload summary"}, "status": "done", "parent": "gdn-cejaba", "order": 21, "created_at": "2026-02-09T15:46:58Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Add default case to handleCCEvent", "Add default case to handleStreamEvent", "Add tests"], "current": 3}, "done_at": "2026-02-09T16:17:31Z"}
{"id": "gdn-tetini", "type": "action", "title": "Page refresh doesn't lose the conversation", "brief": {"why": "No client-side message persistence. Mobile tabs get killed by OS — user loses entire conversation on refresh. Biggest UX gap for mobile use.", "what": "1. Evaluate approaches: IndexedDB persistence vs CC session replay vs hybrid 2. Implement chosen approach 3. Test: refresh page mid-conversation, messages reappear", "done": "Refreshing the page (or mobile tab kill/restore) shows previous conversation messages"}, "status": "open", "parent": "gdn-hatiho", "order": 7, "created_at": "2026-02-09T15:47:01Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-ruduzo", "type": "action", "title": "Mobile tab resume reconnects instantly via visibilitychange", "brief": {"why": "No visibilitychange listener. When mobile tab comes back to foreground, WS may be dead but reconnect waits up to 30s for ping timeout. User stares at stale UI.", "what": "1. Add visibilitychange listener in WSTransport 2. On visible: check WS readyState, reconnect immediately if not OPEN 3. Test with fake timers: visibility change triggers immediate reconnect attempt", "done": "Switching back to gueridon tab triggers immediate WS health check and reconnect if needed"}, "status": "open", "parent": "gdn-hatiho", "order": 8, "created_at": "2026-02-09T15:47:05Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-jegosi", "type": "action", "title": "Folder lifecycle in main.ts is an explicit state machine, not callback soup", "brief": {"why": "main.ts folder switching uses shared mutable flags (pendingFolderConnect, deferredFolderPath) across multiple callbacks. The deferred connect pattern — detect mid-session, returnToLobby, wait for lobby callback, connect folder — is a three-step dance across two callbacks. This is where the dialog flash bug lives and where the returnToLobby WS race lived. Both were fixed with guards but the shape invites the next bug.", "what": "1. Define folder lifecycle states (idle, selecting, switching, connecting, connected) as a union type 2. Extract folder state machine from main.ts — transitions replace the pendingFolderConnect/deferredFolderPath flags 3. Each transition has a single handler — no split logic across onSessionId/onLobbyConnected/onFolderList callbacks 4. Unit test the state machine: transitions, guards, edge cases (double-click, rapid switch)", "done": "main.ts folder lifecycle uses typed states and transitions. pendingFolderConnect and deferredFolderPath flags are gone. State machine has unit tests."}, "status": "done", "parent": "gdn-hatiho", "order": 9, "created_at": "2026-02-09T16:04:03Z", "created_by": "spm1001", "waiting_for": null, "tactical": {"steps": ["Write folder-lifecycle.ts — types + initial() + transition()", "Write folder-lifecycle.test.ts — pure function tests for all transitions", "Rewrite main.ts to use dispatch/executeEffect pattern", "Remove console.trace from folder-selector.ts (line 53)", "Run full test suite + build, verify jebudo flash is structurally prevented"], "current": 5}, "done_at": "2026-02-09T16:49:10Z"}
{"id": "gdn-weletu", "type": "action", "title": "Connecting retry loop has a circuit breaker", "brief": {"why": "connecting + lobby_entered retries connect_folder indefinitely. On flaky mobile with a deleted/broken folder path, this loops forever with no user feedback.", "what": "1. Add retry counter to connecting phase (max 3 attempts) 2. On exhaustion, transition to browsing with error toast 3. Test the exhaustion path", "done": "After 3 failed connect attempts, user sees folder selector again with an error message. Test covers the retry→exhaustion→browsing path."}, "status": "open", "parent": "gdn-cejaba", "order": 22, "created_at": "2026-02-09T17:10:56Z", "created_by": "spm1001", "waiting_for": null}
{"id": "gdn-susuna", "type": "action", "title": "State machine wiring verified on real mobile", "brief": {"why": "folder-lifecycle.ts is pure-function tested but the dialog/transport interaction (open_dialog, close_dialog, dispatch queue re-entrancy) has only been verified in unit tests. Real mobile has tap timing, WS flakiness, and Safari quirks that unit tests can't catch.", "what": "1. Start bridge + dev server 2. Open on phone (or responsive Chrome DevTools) 3. Test: fresh load → folder select → session. Test: mid-session folder switch. Test: escape during connecting. Test: WS drop during connecting (toggle airplane mode).", "done": "All four paths work on real mobile Safari/Chrome. No flash, no stuck states, no console errors."}, "status": "open", "parent": "gdn-cejaba", "order": 23, "created_at": "2026-02-09T17:11:05Z", "created_by": "spm1001", "waiting_for": null}
